!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="0815cd4f-177b-4f4c-9038-ebc4f37b8ea0",e._sentryDebugIdIdentifier="sentry-dbid-0815cd4f-177b-4f4c-9038-ebc4f37b8ea0")}catch(e){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[49972],{2376:(e,t,s)=>{s.d(t,{ru:()=>y,_c:()=>f,sS:()=>I,v5:()=>p});var o=s(28245),n=s(38541),i=s.n(n),r=s(88382),a=s(65146),l=s(6132),d=s(75500);let c=l.z.object({personaId:l.z.string(),prompt:l.z.string().optional()}),u=l.z.object({personaPresets:l.z.array(c)}),m=l.z.union([l.z.literal("imageGen"),l.z.literal("search"),l.z.literal("think"),l.z.literal("deepsearch")]),h=l.z.object({personaId:l.z.string(),name:l.z.string(),systemPromptName:l.z.string(),disclaimer:l.z.string().optional(),disabledTools:m.array(),prompt:l.z.string().optional()});function p(){let{stage:e}=(0,o.Sf)(),{t}=(0,a.Bd)("base"),s=function(){let e=(0,d.h)();return(0,r.useMemo)(()=>{var t;let s=null==(t=e.PERSONAS)?void 0:t.value;if(!s)return{personaPresets:[]};let o=u.safeParse(s);return o.success?o.data:{personaPresets:[]}},[e.PERSONAS])}(),n=(0,r.useMemo)(()=>({news:t("persona-name.news","Latest News"),romance:t("persona-name.romance","Companion"),unhinged:t("persona-name.unhinged","Unhinged Comedian"),friend:t("persona-name.friend","Loyal Friend"),tutor:t("persona-name.tutor","Homework Helper"),doctor:t("persona-name.doctor_with_quotes",'Grok "Doc"'),therapist:t("persona-name.therapist_with_quotes",'"Therapist"'),scientist:t("persona-name.scientist","Scientist"),coder:t("persona-name.coder","Coder")}),[t]),l=(0,r.useMemo)(()=>g.map(e=>({personaId:e,name:n[e],systemPromptName:v[e],disabledTools:[],prompt:function(e,t){let s=t.personaPresets.find(t=>t.personaId===e);return(null==s?void 0:s.prompt)||""}(e,s)})).filter(t=>!y.includes(t.personaId)||"nopass"!==e).map(e=>h.safeParse(e)).filter(e=>e.success).map(e=>e.data),[e,n,s]),c=(0,r.useMemo)(()=>i().keyBy(l,e=>e.personaId),[l]),m=(0,r.useCallback)(e=>{if(!g.includes(e))return;let t=c[e];if(t)return t},[c]),p=(0,r.useCallback)(e=>{if(!e||!e.personaId||!g.includes(e.personaId))return;let t=c[e.personaId];if(t)return t},[c]);return{personas:l,personaById:c,getPersonaForConversation:p,getPersonaFromId:m}}let g=["news","romance","unhinged","friend","tutor","doctor","therapist"],v={doctor:"grok3_personality_medical_advisor",news:"grok3_personality_latest_news",friend:"grok3_personality_loyal_friend",tutor:"grok3_personality_homework_helper",romance:"grok3_personality_romance_me",unhinged:"grok3_personality_unhinged_comedian",therapist:"grok3_personality_trusted_therapist",scientist:"grok3_personality_science_geek",coder:"grok3_personality_cracked_coder"};function f(e){if(!e)return;let t=i().invert(v)[e];if(I(t))return t}function I(e){return!!e&&g.includes(e)}let y=["romance","unhinged"]},4295:(e,t,s)=>{s.d(t,{c:()=>n,f:()=>i});var o=s(88382);function n(){let[e,t]=(0,o.useState)(!1);return(0,o.useEffect)(()=>{let e=()=>{let e=navigator.userAgent||navigator.vendor;t(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile|mobile|CriOS/i.test(e))};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]),e}function i(){let e=navigator.userAgent||navigator.vendor;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile|mobile|CriOS/i.test(e)}},13103:(e,t,s)=>{s.d(t,{Cf:()=>u,Es:()=>h,L3:()=>p,ZJ:()=>d,c7:()=>m,eB:()=>i,lG:()=>a,rr:()=>g,zM:()=>l});var o=s(79342),n=s(61312),i=s(53592),r=s(88382);let a=i.bL,l=i.l9,d=i.ZL;i.bm;let c=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,o.jsx)(i.hJ,{ref:t,className:(0,n.cn)("fixed inset-0 z-[100] bg-overlay backdrop-blur-[2px] duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...r})});c.displayName=i.hJ.displayName;let u=r.forwardRef((e,t)=>{let{className:s,overlayClassname:r,children:a,...l}=e;return(0,o.jsxs)(d,{children:[(0,o.jsx)(c,{className:r}),(0,o.jsx)(i.UC,{ref:t,className:(0,n.cn)("fixed left-[50%] top-[50%] z-[100] grid translate-x-[-50%] translate-y-[-50%] gap-4 bg-surface-base dark:border dark:border-border-l1 duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%]",s),onCloseAutoFocus:e=>{e.preventDefault(),document.body.style.pointerEvents=""},...l,children:a})]})});u.displayName=i.UC.displayName;let m=e=>{let{className:t,...s}=e;return(0,o.jsx)("div",{className:(0,n.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...s})};m.displayName="DialogHeader";let h=e=>{let{className:t,...s}=e;return(0,o.jsx)("div",{className:(0,n.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s})};h.displayName="DialogFooter";let p=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,o.jsx)(i.hE,{ref:t,className:(0,n.cn)("text-lg font-semibold leading-none tracking-tight",s),...r})});p.displayName=i.hE.displayName;let g=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,o.jsx)(i.VY,{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",s),...r})});g.displayName=i.VY.displayName},17014:(e,t,s)=>{s.d(t,{Oj5:()=>b,Qtr:()=>c,c11:()=>m,nfr:()=>p,VAL:()=>v,id:()=>I,vjv:()=>w});var o=s(79342),n=s(40409),i=s(37953);function r(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,i.QP)((0,n.$)(t))}var a=s(88382);let l=e=>(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",...e,children:(0,o.jsx)("path",{d:"m10.828 12 4.95 4.95-1.414 1.415L8 12l6.364-6.364 1.414 1.414z"})}),d=e=>(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 33 33",...e,children:(0,o.jsx)("path",{fill:"currentColor",d:"m13.237 21.04 11.082-8.19c.543-.4 1.32-.244 1.578.38 1.363 3.288.754 7.241-1.957 9.955-2.71 2.714-6.482 3.31-9.93 1.954l-3.765 1.745c5.401 3.697 11.96 2.782 16.059-1.324 3.251-3.255 4.258-7.692 3.317-11.693l.008.009c-1.365-5.878.336-8.227 3.82-13.031q.123-.17.247-.345l-4.585 4.59v-.014L13.234 21.044M10.95 23.031c-3.877-3.707-3.208-9.446.1-12.755 2.446-2.449 6.454-3.448 9.952-1.979L24.76 6.56c-.677-.49-1.545-1.017-2.54-1.387A12.465 12.465 0 0 0 8.675 7.901c-3.519 3.523-4.625 8.94-2.725 13.561 1.42 3.454-.907 5.898-3.251 8.364-.83.874-1.664 1.749-2.335 2.674l10.583-9.466"})}),c=e=>{let{"aria-label":t,className:s,color:n,size:i="medium"}=e,a="number"==typeof i?{height:i,width:i}:void 0;return(0,o.jsx)("span",{className:r("inline-flex items-center justify-center p-0 m-0",{"w-4 h-4":"x-small"===i,"w-5 h-5":"small"===i,"w-6 h-6":"medium"===i,"w-8 h-8":"large"===i,"w-full h-full":"fill"===i},s),"data-namespace":"@xai/icons","data-slot":"icon",style:{color:n,...a},children:(0,o.jsx)(d,{"aria-hidden":!t,"aria-label":t,className:r({"w-4 h-4":"x-small"===i,"w-5 h-5":"small"===i,"w-6 h-6":"medium"===i,"w-8 h-8":"large"===i,"w-full h-full":"fill"===i}),focusable:"false",style:{fill:"currentColor",...a}})})};c.displayName="GrokLogoIcon";let u=e=>(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",...e,children:(0,o.jsx)("path",{d:"M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z"})}),m=e=>{let{"aria-label":t,className:s,color:n,size:i="medium"}=e,a="number"==typeof i?{height:i,width:i}:void 0;return(0,o.jsx)("span",{className:r("inline-flex items-center justify-center p-0 m-0",{"w-4 h-4":"x-small"===i,"w-5 h-5":"small"===i,"w-6 h-6":"medium"===i,"w-8 h-8":"large"===i,"w-full h-full":"fill"===i},s),"data-namespace":"@xai/icons","data-slot":"icon",style:{color:n,...a},children:(0,o.jsx)(u,{"aria-hidden":!t,"aria-label":t,className:r({"w-4 h-4":"x-small"===i,"w-5 h-5":"small"===i,"w-6 h-6":"medium"===i,"w-8 h-8":"large"===i,"w-full h-full":"fill"===i}),focusable:"false",style:{fill:"currentColor",...a}})})};m.displayName="PlusIcon";let h=e=>(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",style:{height:24,width:24,marginRight:0},viewBox:"0 0 122.8 122.8",...e,children:(0,o.jsx)("path",{fill:"currentColor",d:"M25.8 77.6c0 7.1-5.8 12.9-12.9 12.9S0 84.7 0 77.6s5.8-12.9 12.9-12.9h12.9zm6.5 0c0-7.1 5.8-12.9 12.9-12.9s12.9 5.8 12.9 12.9v32.3c0 7.1-5.8 12.9-12.9 12.9s-12.9-5.8-12.9-12.9zM45.2 25.8c-7.1 0-12.9-5.8-12.9-12.9S38.1 0 45.2 0s12.9 5.8 12.9 12.9v12.9zm0 6.5c7.1 0 12.9 5.8 12.9 12.9s-5.8 12.9-12.9 12.9H12.9C5.8 58.1 0 52.3 0 45.2s5.8-12.9 12.9-12.9zM97 45.2c0-7.1 5.8-12.9 12.9-12.9s12.9 5.8 12.9 12.9-5.8 12.9-12.9 12.9H97zm-6.5 0c0 7.1-5.8 12.9-12.9 12.9s-12.9-5.8-12.9-12.9V12.9C64.7 5.8 70.5 0 77.6 0s12.9 5.8 12.9 12.9zM77.6 97c7.1 0 12.9 5.8 12.9 12.9s-5.8 12.9-12.9 12.9-12.9-5.8-12.9-12.9V97zm0-6.5c-7.1 0-12.9-5.8-12.9-12.9s5.8-12.9 12.9-12.9h32.3c7.1 0 12.9 5.8 12.9 12.9s-5.8 12.9-12.9 12.9z"})}),p=e=>{let{"aria-label":t,className:s,color:n,size:i="medium"}=e,a="number"==typeof i?{height:i,width:i}:void 0;return(0,o.jsx)("span",{className:r("inline-flex items-center justify-center p-0 m-0",{"w-4 h-4":"x-small"===i,"w-5 h-5":"small"===i,"w-6 h-6":"medium"===i,"w-8 h-8":"large"===i,"w-full h-full":"fill"===i},s),"data-namespace":"@xai/icons","data-slot":"icon",style:{color:n,...a},children:(0,o.jsx)(h,{"aria-hidden":!t,"aria-label":t,className:r({"w-4 h-4":"x-small"===i,"w-5 h-5":"small"===i,"w-6 h-6":"medium"===i,"w-8 h-8":"large"===i,"w-full h-full":"fill"===i}),focusable:"false",style:{fill:"currentColor",...a}})})};p.displayName="SlackLogoIcon";let g=e=>(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",strokeWidth:1.5,viewBox:"0 0 24 24",...e,children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.712 4.33a9 9 0 0 1 1.652 1.306c.51.51.944 1.064 1.306 1.652M16.712 4.33l-3.448 4.138m3.448-4.138a9.01 9.01 0 0 0-9.424 0M19.67 7.288l-4.138 3.448m4.138-3.448a9.01 9.01 0 0 1 0 9.424m-4.138-5.976a3.7 3.7 0 0 0-.88-1.388 3.7 3.7 0 0 0-1.388-.88m2.268 2.268a3.77 3.77 0 0 1 0 2.528m-2.268-4.796a3.77 3.77 0 0 0-2.528 0m4.796 4.796a3.75 3.75 0 0 1-.88 1.388 3.7 3.7 0 0 1-1.388.88m2.268-2.268 4.138 3.448m0 0a9 9 0 0 1-1.306 1.652c-.51.51-1.064.944-1.652 1.306m0 0-3.448-4.138m3.448 4.138a9.01 9.01 0 0 1-9.424 0m5.976-4.138a3.77 3.77 0 0 1-2.528 0m0 0a3.7 3.7 0 0 1-1.388-.88 3.7 3.7 0 0 1-.88-1.388m2.268 2.268L7.288 19.67m0 0a9 9 0 0 1-1.652-1.306 9 9 0 0 1-1.306-1.652m0 0 4.138-3.448M4.33 16.712a9.01 9.01 0 0 1 0-9.424m4.138 5.976a3.77 3.77 0 0 1 0-2.528m0 0c.181-.506.475-.982.88-1.388a3.7 3.7 0 0 1 1.388-.88m-2.268 2.268L4.33 7.288m6.406 1.18L7.288 4.33m0 0a9 9 0 0 0-1.652 1.306A9 9 0 0 0 4.33 7.288"})}),v=e=>{let{"aria-label":t,className:s,color:n,size:i="medium"}=e,a="number"==typeof i?{height:i,width:i}:void 0;return(0,o.jsx)("span",{className:r("inline-flex items-center justify-center p-0 m-0",{"w-4 h-4":"x-small"===i,"w-5 h-5":"small"===i,"w-6 h-6":"medium"===i,"w-8 h-8":"large"===i,"w-full h-full":"fill"===i},s),"data-namespace":"@xai/icons","data-slot":"icon",style:{color:n,...a},children:(0,o.jsx)(g,{"aria-hidden":!t,"aria-label":t,className:r({"w-4 h-4":"x-small"===i,"w-5 h-5":"small"===i,"w-6 h-6":"medium"===i,"w-8 h-8":"large"===i,"w-full h-full":"fill"===i}),focusable:"false",style:{fill:"currentColor",...a}})})};v.displayName="SupportIcon";let f=e=>(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",...e,children:(0,o.jsx)("path",{d:"M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10m0-2a8 8 0 1 0 0-16 8 8 0 0 0 0 16m-1-5h2v2h-2zm0-8h2v6h-2z"})}),I=e=>{let{"aria-label":t,className:s,color:n,size:i="medium"}=e,a="number"==typeof i?{height:i,width:i}:void 0;return(0,o.jsx)("span",{className:r("inline-flex items-center justify-center p-0 m-0",{"w-4 h-4":"x-small"===i,"w-5 h-5":"small"===i,"w-6 h-6":"medium"===i,"w-8 h-8":"large"===i,"w-full h-full":"fill"===i},s),"data-namespace":"@xai/icons","data-slot":"icon",style:{color:n,...a},children:(0,o.jsx)(f,{"aria-hidden":!t,"aria-label":t,className:r({"w-4 h-4":"x-small"===i,"w-5 h-5":"small"===i,"w-6 h-6":"medium"===i,"w-8 h-8":"large"===i,"w-full h-full":"fill"===i}),focusable:"false",style:{fill:"currentColor",...a}})})};I.displayName="WarningIcon";let y=e=>(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",...e,children:(0,o.jsx)("path",{d:"M8 2H1l8.26 11.015L1.45 22H4.1l6.388-7.349L16 22h7l-8.608-11.478L21.8 2h-2.65l-5.986 6.886zm9 18L5 4h2l12 16z"})}),w=e=>{let{"aria-label":t,className:s,color:n,size:i="medium"}=e,a="number"==typeof i?{height:i,width:i}:void 0;return(0,o.jsx)("span",{className:r("inline-flex items-center justify-center p-0 m-0",{"w-4 h-4":"x-small"===i,"w-5 h-5":"small"===i,"w-6 h-6":"medium"===i,"w-8 h-8":"large"===i,"w-full h-full":"fill"===i},s),"data-namespace":"@xai/icons","data-slot":"icon",style:{color:n,...a},children:(0,o.jsx)(y,{"aria-hidden":!t,"aria-label":t,className:r({"w-4 h-4":"x-small"===i,"w-5 h-5":"small"===i,"w-6 h-6":"medium"===i,"w-8 h-8":"large"===i,"w-full h-full":"fill"===i}),focusable:"false",style:{fill:"currentColor",...a}})})};w.displayName="XLogoIcon";let b=e=>{let{"aria-label":t,className:s,color:n,disabled:i,size:d="medium",type:c="button",...u}=e,m=(0,a.useRef)(null),h=null!=i?!!i:!t,p="number"==typeof d?{height:d,width:d}:void 0;return(0,o.jsx)("button",{...u,type:c,"aria-disabled":i,"aria-hidden":h,"aria-label":t,className:r("inline-flex items-center justify-center border-none bg-transparent hover:bg-muted/50 rounded-full p-0 m-0 appearance-none disabled:opacity-30",{"w-4 h-4":"x-small"===d,"w-5 h-5":"small"===d,"w-6 h-6":"medium"===d,"w-8 h-8":"large"===d,"w-full h-full":"fill"===d},s),"data-namespace":"@xai/icons","data-slot":"icon",disabled:i,ref:m,style:{color:n,...p},children:(0,o.jsx)(l,{className:r({"w-[1.125rem] h-[1.125rem]":"medium"===d,"w-[1.375rem] h-[1.375rem]":"large"===d,"w-3.5 h-3.5":"x-small"===d,"w-4 h-4":"small"===d,"w-full h-full":"fill"===d}),focusable:"false",style:{fill:"currentColor",...p}})})};b.displayName="ArrowLeftIconButton"},24994:(e,t,s)=>{s.d(t,{R:()=>d});var o=s(79342);s(88382);var n=s(13103),i=s(34500),r=s(41320),a=s(61312),l=s(65146);function d(e){let{open:t,setOpen:s,trigger:d,title:c,description:u,footer:m,children:h,contentClassName:p,headerClassName:g,footerClassName:v,titleClassName:f,descriptionClassName:I,blurBackground:y}=e,{t:w}=(0,l.Bd)();return!(0,r.Di)()&&t?(0,o.jsxs)(n.lG,{open:t,onOpenChange:s,children:[d&&(0,o.jsx)(n.zM,{asChild:!0,children:d}),(0,o.jsxs)(n.Cf,{className:(0,a.cn)("focus:outline-none rounded-none",p),overlayClassname:(0,a.cn)(y&&"backdrop-blur-lg"),"aria-describedby":void 0,children:[(0,o.jsxs)(n.c7,{className:(0,a.cn)(!c&&!u&&"sr-only",g),children:[(0,o.jsx)(n.L3,{className:f,children:null!=c?c:w("dialog.title","Dialog")}),u?(0,o.jsx)(n.rr,{className:I,children:u}):null]}),h,m?(0,o.jsx)(n.Es,{className:v,children:m}):null]})]}):(0,o.jsxs)(i._s,{open:t,onOpenChange:s,dismissible:!!s,children:[d&&(0,o.jsx)(i.Uz,{asChild:!0,children:d}),(0,o.jsxs)(i.zj,{className:(0,a.cn)("focus:outline-none",p,"max-w-none !rounded-b-none"),overlayClassName:(0,a.cn)(y&&"backdrop-blur-lg"),"aria-describedby":void 0,children:[(0,o.jsxs)(i.BE,{className:(0,a.cn)(!c&&!u&&"sr-only","p-0 text-left",g),children:[(0,o.jsx)(i.gk,{className:f,children:null!=c?c:w("dialog.title","Dialog")}),u?(0,o.jsx)(i.I6,{className:I,children:u}):null]}),h,m?(0,o.jsx)(i.tb,{className:(0,a.cn)("pt-2",v),children:m}):null]})]})}},28245:(e,t,s)=>{s.d(t,{Sf:()=>y,TL:()=>w});var o=s(79342),n=s(56691),i=s(24994);s(37931);var r=s(61312),a=s(20337),l=s(38541),d=s.n(l),c=s(32171),u=s.n(c),m=s(68332),h=s(44347),p=s(88382),g=s(65146),v=s(4890),f=s(17823),I=s(69648);d().range(1900,new Date().getFullYear()).map(e=>e.toString()).reverse();let y=(0,v.v)()((0,f.Zr)(e=>({stage:"start",setStage:t=>e({stage:t})}),{name:"age-verif"}));function w(e){let{onPass:t}=e,{t:s}=(0,g.Bd)("base"),{stage:l,setStage:d}=y(),{routeToConversation:c}=(0,m.o)(),{client:v}=(0,a.useStatsigClient)(),f=(0,p.useCallback)(()=>{v.logEvent("clicked_signin",void 0,{location:"age-verification"})},[v]),w=(0,p.useCallback)(()=>{d("pass"),null==t||t(),v.logEvent("selected_over_18","pass",{location:"over-18-verification"})},[t,v,d]),b=(0,p.useCallback)(()=>{d("nopass"),v.logEvent("selected_over_18","nopass",{location:"over-18-verification"})},[v,d]),S=(0,p.useCallback)(()=>{let{setShowAgeVerification:e}=h.C$.getState();e(!1),c(void 0)},[c]);return(0,o.jsxs)(i.R,{open:"pass"!==l,contentClassName:(0,r.cn)("focus:outline-0 focus-within:outline-0 gap-2","bg-background rounded-3xl","w-full md:w-5/6 lg:w-3/5 max-w-sm","flex flex-col","md:overflow-hidden","px-6 py-6"),blurBackground:!0,headerClassName:(0,r.cn)("nopass"===l&&"mb-4"),titleClassName:(0,r.cn)("nopass"===l&&"mb-1"),title:"nopass"===l?s("Restricted","Restricted"):"start"===l?s("Please confirm your age","Please confirm your age"):null,description:"nopass"===l?s("Restricted.description","Based on the information you provided you cannot use Grok image generation or 18+ personas."):"start"===l?s("Please confirm your age.description","In order to continue using Grok we need to confirm your age."):null,children:["start"===l&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"flex items-center justify-center gap-4 p-1",children:[(0,o.jsx)(n.$n,{className:"w-full",variant:"secondary",onClick:b,tabIndex:-1,children:s("I am not over 18","I am not over 18")}),(0,o.jsx)(n.$n,{className:"w-full",variant:"primary",onClick:w,children:s("I am 18 or older","I am 18 or older")})]}),(0,o.jsxs)("div",{className:"relative flex items-center justify-center w-full",children:[(0,o.jsx)(I.w,{className:"absolute -translate-x-1/2 -translate-y-1/2 top-1/2 left-1/2"}),(0,o.jsx)("p",{className:"relative px-2 py-1 mx-auto text-xs bg-background text-secondary",children:s("Or","Or")})]}),(0,o.jsx)(n.$n,{asChild:!0,variant:"secondary",size:"lg",onClick:f,children:(0,o.jsx)(u(),{href:"sign-in",children:s("Sign in or create an account","Sign in or create an account")})})]}),"nopass"===l&&(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(n.$n,{className:"w-full mt-2",variant:"primary",size:"lg",onClick:S,children:s("Start a new chat","Start a new chat")})})]})}},29938:(e,t,s)=>{s.d(t,{Uk:()=>c,X4:()=>d,jN:()=>p,yo:()=>g});var o=s(65258),n=s(38541),i=s.n(n),r=s(6132),a=s(64389);let l="custom_personality_id",d={personalityId:l,name:"Custom",prompt:"",description:"Responds to you as you please.",isPreset:!1};function c(e){return!!e&&(e===l||36===e.length)}function u(e){return{name:e.name,content:[{text:e.prompt}]}}function m(e){var t,s;return{personalityId:e.systemPromptId||"",name:e.name||d.name,prompt:(null==(s=e.content)||null==(t=s[0])?void 0:t.text)||"",description:d.description,isPreset:!1}}class h{constructor(e,t){this.set=e,this.get=t,this.promiseById={},this.byId={},this.list=[],this.draftPromptById={},this.upsertPersonality=(0,o.el)(this.set,"byId","personalityId"),this.appendPersonalities=(0,o.BC)(this.set,"byId","personalityId"),this.removePersonality=(0,o.TF)(this.set,"byId"),this.idsertPersonalityPromise=(0,o.q5)(this.set,"promiseById"),this.removePersonalityPromise=(0,o.TF)(this.set,"promiseById"),this.upsertDraftPrompt=(0,o.q5)(this.set,"draftPromptById"),this.fetchCreatePersonality=e=>{let t=this.get(),s=a.eb.systemPromptRepositoryCreateSystemPrompt({body:u(e)}).then(e=>{let t=m(e);return t.description=d.description,t}).then(e=>(t.upsertPersonality(e),t.idsertPersonalityPromise(s,e.personalityId),e));return s},this.fetchUpdatePersonality=e=>{let t=this.get(),s=a.eb.systemPromptRepositoryUpdateSystemPrompt({systemPromptId:e.personalityId,body:u(e)}).then(e=>m(e)).then(e=>(t.upsertPersonality(e),e));return t.idsertPersonalityPromise(s,e.personalityId),s},this.fetchDeletePersonality=e=>(this.get().removePersonality(e.personalityId),a.eb.systemPromptRepositoryDeleteSystemPrompt({systemPromptId:e.personalityId})),this.fetchListPersonalities=()=>{let e=this.get();return a.eb.systemPromptRepositoryListSystemPrompts({body:{pageSize:100}}).then(e=>{var t;return(null==(t=e.assets)?void 0:t.map(m))||[]}).then(t=>(e.appendPersonalities(t),e.set(e=>({promiseById:{...e.promiseById,...i().mapValues(i().keyBy(t,"personalityId"),e=>Promise.resolve(e))}})),t))},this.fetchGetPersonality=e=>{let t=this.get(),s=e.personalityId;if(s in t.promiseById)return t.promiseById[s];let o=a.eb.systemPromptRepositoryGetSystemPrompt({systemPromptId:s}).then(e=>m(e)).then(e=>(t.upsertPersonality(e),t.idsertPersonalityPromise(o,e.personalityId),e));return o}}}let p=(0,o.y$)(h,"usePersonalityStore");(0,o.lB)(p,"byId","list",Object.values);let g=r.z.object({personalityId:r.z.string(),name:r.z.string(),prompt:r.z.string(),description:r.z.string(),isPreset:r.z.boolean()});r.z.array(g)},34500:(e,t,s)=>{s.d(t,{BE:()=>m,I6:()=>g,Uz:()=>l,_s:()=>a,gk:()=>p,tb:()=>h,zj:()=>u});var o=s(79342),n=s(88382),i=s(49872),r=s(61312);let a=e=>{let{shouldScaleBackground:t=!0,...s}=e;return(0,o.jsx)(i._.Root,{shouldScaleBackground:t,...s})};a.displayName="Drawer";let l=i._.Trigger,d=i._.Portal;i._.Close;let c=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,o.jsx)(i._.Overlay,{ref:t,className:(0,r.cn)("fixed inset-0 z-50 bg-black/20 dark:bg-black/80",s),...n})});c.displayName=i._.Overlay.displayName;let u=n.forwardRef((e,t)=>{let{className:s,overlayClassName:n,disableDrag:a,children:l,...u}=e;return(0,o.jsxs)(d,{children:[(0,o.jsx)(c,{className:n}),(0,o.jsxs)(i._.Content,{ref:t,className:(0,r.cn)("fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[24px] bg-surface-base dark:border dark:border-border-l1",s),onCloseAutoFocus:e=>{e.preventDefault(),document.body.style.pointerEvents=""},...u,children:[a?null:(0,o.jsx)("div",{className:"flex-shrink-0 w-12 h-1 mx-auto mt-3 mb-0 rounded-full bg-secondary/80"}),l]})]})});u.displayName="DrawerContent";let m=e=>{let{className:t,...s}=e;return(0,o.jsx)("div",{className:(0,r.cn)("grid gap-1.5 p-4 text-center sm:text-left",t),...s})};m.displayName="DrawerHeader";let h=e=>{let{className:t,...s}=e;return(0,o.jsx)("div",{className:(0,r.cn)("mt-auto flex flex-col gap-2 p-4",t),...s})};h.displayName="DrawerFooter";let p=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,o.jsx)(i._.Title,{ref:t,className:(0,r.cn)("text-lg font-semibold leading-none tracking-tight",s),...n})});p.displayName=i._.Title.displayName;let g=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,o.jsx)(i._.Description,{ref:t,className:(0,r.cn)("text-sm text-muted-foreground",s),...n})});g.displayName=i._.Description.displayName},36936:(e,t,s)=>{s.d(t,{V:()=>i});var o=s(65258);class n{constructor(e,t){this.set=e,this.get=t,this.models=[],this.unavailableModels=[],this.defaultAnonModelId="",this.defaultFreeModelId="",this.defaultProModelId="",this.modelById={},this.isPending=!1}}let i=(0,o.y$)(n,"useModelsStore")},37931:(e,t,s)=>{s.d(t,{bq:()=>u,eb:()=>h,gC:()=>m,l6:()=>d,yv:()=>c});var o=s(79342),n=s(30479),i=s(67811),r=s(82263),a=s(59346);s(88382);var l=s(61312);function d(e){let{...t}=e;return(0,o.jsx)(n.bL,{"data-slot":"select",...t})}function c(e){let{...t}=e;return(0,o.jsx)(n.WT,{"data-slot":"select-value",...t})}function u(e){let{className:t,size:s="default",children:r,...a}=e;return(0,o.jsxs)(n.l9,{"data-slot":"select-trigger","data-size":s,className:(0,l.cn)("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...a,children:[r,(0,o.jsx)(n.In,{asChild:!0,children:(0,o.jsx)(i.A,{className:"size-4 opacity-50"})})]})}function m(e){let{className:t,children:s,position:i="popper",...r}=e;return(0,o.jsxs)(n.UC,{"data-slot":"select-content",className:(0,l.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md","popper"===i&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:i,...r,children:[(0,o.jsx)(p,{}),(0,o.jsx)(n.LM,{className:(0,l.cn)("p-1","popper"===i&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:s}),(0,o.jsx)(g,{})]})}function h(e){let{className:t,children:s,...i}=e;return(0,o.jsxs)(n.q7,{"data-slot":"select-item",className:(0,l.cn)("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",t),...i,children:[(0,o.jsx)("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:(0,o.jsx)(n.VF,{children:(0,o.jsx)(r.A,{className:"size-4"})})}),(0,o.jsx)(n.p4,{children:s})]})}function p(e){let{className:t,...s}=e;return(0,o.jsx)(n.PP,{"data-slot":"select-scroll-up-button",className:(0,l.cn)("flex cursor-default items-center justify-center py-1",t),...s,children:(0,o.jsx)(a.A,{className:"size-4"})})}function g(e){let{className:t,...s}=e;return(0,o.jsx)(n.wn,{"data-slot":"select-scroll-down-button",className:(0,l.cn)("flex cursor-default items-center justify-center py-1",t),...s,children:(0,o.jsx)(i.A,{className:"size-4"})})}},41320:(e,t,s)=>{s.d(t,{Di:()=>n,Iu:()=>i});var o=s(88382);function n(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:768,[t,s]=o.useState(void 0);return o.useEffect(()=>{let t=window.matchMedia("(max-width: ".concat(e-1,"px)")),o=()=>{s(window.innerWidth<e)};return t.addEventListener("change",o),s(window.innerWidth<e),()=>t.removeEventListener("change",o)},[e]),!!t}function i(){let e=n();return{isMobileSize:function(){return e},isTouchDevice:function(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}}}},41739:(e,t,s)=>{s.d(t,{a:()=>d});var o=s(65258),n=s(38541),i=s.n(n),r=s(4890),a=s(17823);class l{constructor(e,t){var s=this;this.set=e,this.get=t,this.drawerOpen=!1,this.menuFixed=!0,this.menuHidden=!0,this.tabByConversationId={},this.inEditId=void 0,this.upsertConversationAsTab=function(e,t){let o=!(arguments.length>2)||void 0===arguments[2]||arguments[2],n=s.get(),r=t?n.tabByConversationId[t]:void 0;r&&t&&n.removeTab(t);let a=r||n.tabByConversationId[e.conversationId];if(a)return void n.upsertTab({isTemporary:e.temporary,title:e.title,index:a.index,conversationId:e.conversationId,isPreserved:a.isPreserved});n.setTabByConversationId({...i().mapValues(n.tabByConversationId,e=>({...e,index:e.index+1})),[e.conversationId]:{isTemporary:e.temporary,title:e.title,index:0,conversationId:e.conversationId,isPreserved:o}})},this.upsertTab=(0,o.el)(this.set,"tabByConversationId","conversationId"),this.removeTab=(0,o.TF)(this.set,"tabByConversationId"),this.appendTabByConversationId=(0,o.BC)(this.set,"tabByConversationId","conversationId"),this.setTabByConversationId=(0,o.kp)(this.set,"tabByConversationId"),this.setDrawerOpen=(0,o.kp)(this.set,"drawerOpen"),this.toggleMenuFixed=(0,o.L$)(this.set,"menuFixed"),this.setMenuFixed=(0,o.kp)(this.set,"menuFixed"),this.setMenuHidden=(0,o.kp)(this.set,"menuHidden"),this.setInEditId=(0,o.kp)(this.set,"inEditId")}}let d=(0,r.v)()((0,a.eh)((0,a.Zr)((e,t)=>new l(e,t),{name:"active-chat-tabs",storage:(0,a.KU)(()=>localStorage),partialize:e=>({tabByConversationId:i().omitBy(e.tabByConversationId,e=>!e.isTemporary&&e.isPreserved)}),version:2})))},43893:(e,t,s)=>{s.d(t,{Jg:()=>E,Ko:()=>L,dr:()=>B,A3:()=>P});var o=s(4295),n=s(98100),i=s(44845),r=s(48992),a=s(17703),l=s(33960),d=s(35021),c=s(65258),u=s(64389),m=s(5129);async function*h(e){if(null===e.body)throw Error("Cannot process response chunks of a response without body.");let t=e.body.getReader(),s=new TextDecoder,o="";for(;;){let{done:e,value:n}=await t.read();if(e)break;let[i,r]=p(o+=s.decode(n,{stream:!0}));for(let e of i)yield e;o=r}let[n,i]=p(o);for(let e of n)yield e;i.length>0&&(yield i)}function p(e){let t=e.split("\n"),s=t.pop();return[t,s]}async function*g(e){for await(let t of h(e))try{let s=JSON.parse(t);(0,m.YM)(s,e),yield s}catch(t){(0,m.YM)(t,e)}}var v=s(44347),f=s(13511),I=s(99452),y=s.n(I),w=s(38541),b=s.n(w),S=s(81353),C=s(6132),x=s(49972),R=s(56096);let T=C.z.object({memoryReferences:C.z.array(C.z.object({conversationId:C.z.string()})).optional().catch(void 0),deepsearchPreset:C.z.string().optional().catch(void 0),ui_layout:C.z.object({reasoningUiLayout:C.z.enum(["UNIFIED","SPLIT"]).optional().catch(void 0)}).optional().catch(void 0),artifactAction:C.z.enum(["ask","explain"]).optional().catch(void 0),agenticWorkspace:C.z.object({workspaceId:C.z.string()}).optional().catch(void 0),requestModelDetails:C.z.object({modelId:C.z.string().nullish(),name:C.z.string().nullish(),description:C.z.string().nullish()}).optional().catch(void 0),modelConfigOverride:v.DC.optional().catch(void 0),isMozart:C.z.boolean().optional().catch(void 0),parentQuotedText:C.z.string().optional().catch(void 0)}),_={nodesPromisesByConversationId:{},nodesByConversationId:{},initialResponsesPromisesByConversationId:{},loadMoreResponsesPromisesByConversationId:{},previewResponsesPromisesByConversationIdResponseId:{},conversationImageResponsesPromisesByConversationId:{},byId:{},byConversationId:{},imageIdByUrl:{},inflightPromisesByConversationId:{}};class k{constructor(e,t){var s=this;this.set=e,this.get=t,this.nodesPromisesByConversationId=_.nodesPromisesByConversationId,this.nodesByConversationId=_.nodesByConversationId,this.initialResponsesPromisesByConversationId=_.initialResponsesPromisesByConversationId,this.loadMoreResponsesPromisesByConversationId=_.loadMoreResponsesPromisesByConversationId,this.previewResponsesPromisesByConversationIdResponseId=_.previewResponsesPromisesByConversationIdResponseId,this.conversationImageResponsesPromisesByConversationId=_.conversationImageResponsesPromisesByConversationId,this.byId=_.byId,this.byConversationId=_.byConversationId,this.imageIdByUrl=_.imageIdByUrl,this.inflightPromisesByConversationId=_.inflightPromisesByConversationId,this.upsertResponse=(0,c.el)(this.set,"byId","responseId"),this.appendResponses=(0,c.BC)(this.set,"byId","responseId"),this.removeResponse=(0,c.TF)(this.set,"byId"),this.idsertInitialResponsesPromisesByConversationId=(0,c.q5)(this.set,"initialResponsesPromisesByConversationId"),this.removeInitialResponsesPromiseByConversationId=(0,c.TF)(this.set,"initialResponsesPromisesByConversationId"),this.idsertLoadMoreResponsesPromisesByConversationId=(0,c.q5)(this.set,"loadMoreResponsesPromisesByConversationId"),this.removeLoadMoreResponsesPromiseByConversationId=(0,c.TF)(this.set,"loadMoreResponsesPromisesByConversationId"),this.idsertPreviewResponsesPromisesByConversationIdResponseId=(0,c.q5)(this.set,"previewResponsesPromisesByConversationIdResponseId"),this.removePreviewResponsesPromiseByConversationIdResponseId=(0,c.TF)(this.set,"previewResponsesPromisesByConversationIdResponseId"),this.idsertConversationImageResponsesPromisesByConversationId=(0,c.q5)(this.set,"conversationImageResponsesPromisesByConversationId"),this.removeConversationImageResponsesPromiseByConversationId=(0,c.TF)(this.set,"conversationImageResponsesPromisesByConversationId"),this.setOneImageIdByUrl=(0,c.q5)(this.set,"imageIdByUrl"),this.idsertInflightPromisesByConversationId=(0,c.q5)(this.set,"inflightPromisesByConversationId"),this.idsertNodesByConversationId=(0,c.q5)(this.set,"nodesByConversationId"),this.idsertNodesPromisesByConversationId=(0,c.q5)(this.set,"nodesPromisesByConversationId"),this.removeNodesPromise=(0,c.TF)(this.set,"nodesPromisesByConversationId"),this.fetchListResponseNodes=async e=>{let t=this.get();if(t.nodesByConversationId[e])return t.nodesByConversationId[e];if(e in t.nodesPromisesByConversationId)return t.nodesPromisesByConversationId[e];let s=u.chatApi.chatListResponseNodes({conversationId:e}).then(e=>{let{responseNodes:t=[]}=e;return t});return t.idsertNodesPromisesByConversationId(s,e),s.then(s=>{t.idsertNodesByConversationId(s,e)}).catch(console.error).finally(()=>{t.removeNodesPromise(e)}),s},this.fetchListInflightResponses=async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=s.get();if(!t&&e in o.inflightPromisesByConversationId)return o.inflightPromisesByConversationId[e];let n=u.chatApi.chatListResponseNodes({conversationId:e}).then(e=>{let{inflightResponses:t=[]}=e;return t});return o.idsertInflightPromisesByConversationId(n,e),n.then(o.appendResponses).catch(console.error),n},this.loadResponses=async(e,t)=>{let s=this.get(),o=t.filter(e=>!s.byId[e]);if(o.length){var n;let t=((null==(n=await u.chatApi.chatLoadResponses({conversationId:e,body:{responseIds:o}}))?void 0:n.responses)||[]).map(t=>{let s=T.optional().parse(t.metadata),{toolUsageResultById:o,traceSteps:n}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t={},s=[];for(let o of e){if(o.toolUsageResults)for(let e of o.toolUsageResults)e.toolUsageCardId&&(t[e.toolUsageCardId]=e);o.text&&o.tags&&b()(o.tags).zip(o.text).sortBy(e=>{var t;return null!=(t=j[e[0]||""])?t:3}).forEach(e=>{let[t,o]=e;if(o)switch(t){case"summary":{let e=o.match(/(- .*)|(<xai:tool_usage_card>[\s\S]*<\/xai:tool_usage_card>)/g);null==e||e.forEach(e=>{e.startsWith("-")?s.push({type:"summary",text:e}):s.push({type:"tool",text:e})});break}case"header":s.push({type:"header",text:o})}})}return{toolUsageResultById:t,traceSteps:s}}(t.steps);return{...t,conversationId:e,memoryReferences:null==s?void 0:s.memoryReferences,deepsearchPreset:null==s?void 0:s.deepsearchPreset,parentQuotedText:null==s?void 0:s.parentQuotedText,toolUsageResultById:o,traceSteps:n}});s.appendResponses(t)}return t.map(e=>this.get().byId[e]).sort((e,t)=>new Date(e.createTime).getTime()-new Date(t.createTime).getTime())},this.loadInitialResponses=async e=>{let t=this.get(),s=t.initialResponsesPromisesByConversationId[e];if(s)return s;let o=t.nodesPromisesByConversationId[e];return o||(o=this.fetchListResponseNodes(e)),s=(async()=>{try{let s=await o;if(!s.length)return[];let n=s[s.length-1],i=(0,r.d7)(n.responseId||"",s,30).filter(e=>!!e.responseId).map(e=>e.responseId);return t.loadResponses(e,i)}catch(e){return console.error(e),[]}})().finally(()=>{t.removeInitialResponsesPromiseByConversationId(e)}),t.idsertInitialResponsesPromisesByConversationId(s,e),s},this.loadMoreResponses=async(e,t)=>{let s=this.get(),o=s.nodesByConversationId[e];if(!o.length)return[];if(e in s.initialResponsesPromisesByConversationId)return s.initialResponsesPromisesByConversationId[e];let n=s.loadMoreResponsesPromisesByConversationId[e];return n||(n=(async()=>{try{let n=s.byConversationId[e]||[],i=(0,r.d7)(t,o),a=(0,r.m$)(i,n),l=i.findIndex(e=>e.responseId===(null==a?void 0:a.responseId)),d=i.slice(l+1,l+30+1).filter(e=>!!e.responseId).map(e=>e.responseId);return s.loadResponses(e,d)}catch(e){return console.error(e),[]}})().finally(()=>{s.removeLoadMoreResponsesPromiseByConversationId(e)}),s.idsertLoadMoreResponsesPromisesByConversationId(n,e)),n},this.loadPreviewResponses=async(e,t)=>{let s=this.get(),o=s.nodesPromisesByConversationId[e];o||(o=this.fetchListResponseNodes(e));let n=s.previewResponsesPromisesByConversationIdResponseId[e+t];return n||(n=(async()=>{try{let n=await o,i=(0,r.d7)(n[n.length-1].responseId,n);if(!i.length)return{responses:[],hasOlderResponses:!1,hasNewerResponses:!1};let a=[];if(t&&i.some(e=>e.responseId===t)){let e=i.findIndex(e=>e.responseId===t),s=Math.max(0,e-5);a=i.slice(s,e+5+1).map(e=>e.responseId)}else a=i.slice(0,10).map(e=>e.responseId);let l=i[i.length-1],d=i[0],c=await s.loadResponses(e,a);return{responses:c,hasOlderResponses:!(null==c?void 0:c.some(e=>e.responseId===l.responseId)),hasNewerResponses:!(null==c?void 0:c.some(e=>e.responseId===d.responseId))}}catch(e){return console.error(e),{responses:[],hasOlderResponses:!1,hasNewerResponses:!1}}})(),s.idsertPreviewResponsesPromisesByConversationIdResponseId(n,e+t)),n},this.loadConversationBranch=async(e,t,s)=>{let o=this.get(),n=o.nodesByConversationId[e];if(!n.length)return[];let i=(0,r.d7)(t,n),a=i.slice(0,i.findIndex(e=>e.responseId===s)+1).filter(e=>!!e.responseId).map(e=>e.responseId);return o.loadResponses(e,a)},this.loadConversationImageResponses=async e=>{let t=this.get(),s=t.nodesPromisesByConversationId[e];s||(s=this.fetchListResponseNodes(e));let o=t.conversationImageResponsesPromisesByConversationId[e];return o||(o=(async()=>{try{let o=(await s).map(e=>e.responseId);return await t.loadResponses(e,o)}catch(e){return console.error(e),[]}})().finally(()=>{t.removeConversationImageResponsesPromiseByConversationId(e)}),t.idsertConversationImageResponsesPromisesByConversationId(o,e)),o},this.processResponseChunk=e=>{var t,s,o,n,i,r,a,l,d;let{currentStreamResponse:c,responseChunk:u,onCitations:m,onHasImage:h,onDisclaimer:p,onFollowUpSuggestedMode:g,onUiLayout:v}=e,f=this.get(),{responseId:I,token:y,modelResponse:w,webSearchResults:S,citedWebSearchResults:C,xSearchResults:x,queryAction:R,cachedImageGenerationResponse:T,followUpSuggestions:_,cardAttachment:k,streamingImageGenerationResponse:M,finalMetadata:P,isThinking:B,messageTag:E,messageStepId:N,bannerMessage:A,disclaimer:z,imageAttachmentInfo:L,progressReport:U,memoryReferences:j,imageDimensions:V,followUpSuggestedMode:D,uiLayout:O,authNotification:F,toolUsageCardId:q}=u;if(void 0!=N&&c.steps.length<=N&&(c.steps=[...c.steps,...b().map(Array(N-c.steps.length+1),()=>({text:[],tags:[],webSearchResults:[],xpostIds:[],xposts:[],toolUsageResults:[]}))]),I&&c.inflightResponseId!==I&&(c.inflightResponseId=I),R&&(("aurora"===R.type||"flux"===R.type)&&(c.hasImages=!0,h()),"x"===R.type&&(c.hasSearches=!0)),L&&L.imageAttachmentCount&&(c.imageAttachmentCount=L.imageAttachmentCount),V&&(V.height&&(c.generatedImageHeight=V.height),V.width&&(c.generatedImageWidth=V.width)),null==S?void 0:S.results)if(void 0!=N){let e=c.steps[N];if(e.webSearchResults=S.results||[],q){let t={toolUsageCardId:q,webSearchResults:{results:S.results}};e.toolUsageResults=[...e.toolUsageResults||[],t]}}else 0===c.steps.length&&(c.webSearchResults=[...c.webSearchResults||[],...S.results||[]],m());if(null==x?void 0:x.results)if(void 0!=N){let e=c.steps[N];if(e){if(e.xposts=x.results||[],e.xpostIds=b().compact(e.xposts.map(e=>e.postId)),q){let t={toolUsageCardId:q,xSearchResults:{results:x.results}};e.toolUsageResults=[...e.toolUsageResults||[],t]}}else c.steps.push({text:[],tags:[],webSearchResults:[],xpostIds:b().compact(x.results.map(e=>e.postId)),xposts:x.results||[],toolUsageResults:q?[{toolUsageCardId:q,xSearchResults:{results:x.results}}]:[]})}else 0===c.steps.length&&(c.xposts=[...c.xposts||[],...x.results||[]],c.xpostIds=b().compact(c.xposts.map(e=>e.postId)),m());if((null==C?void 0:C.results)&&(c.citedWebSearchResults=[...c.citedWebSearchResults||[],...C.results||[]],m()),T&&T.imageUrl&&(c.generatedImageUrls=c.generatedImageUrls.concat([T.imageUrl])),k&&k.jsonData&&(c.cardAttachmentsJson=c.cardAttachmentsJson.concat([k.jsonData])),j&&(null==(t=j.references)?void 0:t.length)&&(c.memoryReferences=j.references),B&&!c.liveThinkingStartTime&&(c.liveThinkingStartTime=new Date(c.createTime).getTime()),"summary"===E?(y&&(y.includes("xai:tool_usage_card")?c.traceSteps.push({type:"tool",text:y}):c.traceSteps.push({type:"summary",text:y})),q&&(S&&(null!=(s=c.toolUsageResultById)[q]||(s[q]={}),c.toolUsageResultById={...c.toolUsageResultById,[q]:{...c.toolUsageResultById[q],webSearchResults:S}}),x&&(null!=(n=c.toolUsageResultById)[q]||(n[q]={}),c.toolUsageResultById={...c.toolUsageResultById,[q]:{...c.toolUsageResultById[q],xSearchResults:x}}))):"header"===E&&y&&c.traceSteps.push({type:"header",text:y}),y)if(E&&"UNSET"!==E.toUpperCase()){if(c.searchingStartTime||(c.searchingStartTime=new Date(c.createTime).getTime()),"FINAL"===E.toUpperCase())c.searchingStartTime&&!c.searchingEndTime&&(c.searchingEndTime=Date.now()),c.message+=y;else if(null!=N){let e=c.steps[N];if(e)if(e.tags.includes(E)){let t=e.tags.indexOf(E);t>=0&&(e.text[t]+=y)}else e.text.push(y),e.tags.push(E)}}else B?c.thinkingTrace+=y:c.message+=y;if(c.liveThinkingStartTime&&!c.liveThinkingEndTime&&!B&&y&&(c.liveThinkingEndTime=Date.now()),_&&_.suggestions&&(c.suggestions=_.suggestions),D&&(c.followUpSuggestedMode=D,g(D)),P&&(P.followUpSuggestions&&(c.suggestions=P.followUpSuggestions),P.disclaimer&&p(P.disclaimer,c.conversationId)),M){let{imageId:e,imageUrl:t}=M;if(e&&t){let s=null!=(r=c.streamingImageById)?r:{};M.progress&&(c.streamingImageById={...s,[e]:{...null!=(a=s[e])?a:{},[M.progress]:M}}),f.setOneImageIdByUrl(e,t)}}return A&&A.message&&p(A.message,c.conversationId),z&&z.message&&p(z.message,c.conversationId),U&&(c.progressReport=U),O&&(c.uiLayout={...null!=(l=c.uiLayout)?l:{},...O},null==v||v(c.uiLayout)),F&&(c.authNotification={...null!=(d=c.authNotification)?d:{},...F}),w&&(c={...c,...w,state:c.authNotification?"streaming":"closed"}),c},this.processSideBySide=e=>{let{responseChunk:t,toggledExperiment:s,conversationId:o,parentResponseId:n,userResponseId:i,modelName:r}=e,{sideBySideIndex:a,responseId:l}=t;if(null!=a&&!s){let e="streaming_in_progress_".concat(a,"_").concat(y()());return A({conversationId:o,responseId:l||e,parentResponseId:i||n,sender:r})}},this.processSoftStop=e=>{let{currentStreamResponse:t,responseChunk:s,startTimeMs:o}=e;return t.liveThinkingStartTime&&!t.liveThinkingEndTime&&(t.liveThinkingEndTime=Date.now()),t.generationTimeMs=Date.now()-o,t.state="closed",s.responseId&&(t.responseId=s.responseId),t.partial=!1,t},this.streamResponse=e=>{var t,s,c;let m,{message:h,metadata:p={},parentResponseId:I,parentQuotedText:b,conversationId:S,modelName:C,fileAttachmentIds:T,webpageUrls:_,toolOverrides:k,customInstructions:P,customPersonality:B,deepsearchPreset:L,systemPromptName:j,isReasoning:V,imageEditUri:D,followUpType:O,enableRetries:F,disableArtifactDiff:q,onOptimisticUserResponse:G,onOptimisticModelResponse:Q,onStart:$,onUserResponse:W,onStartExperiment:H,onCitations:K,onDisclaimer:J,onHasImage:X,onClose:Z,onWke:Y,onError:ee,isFromGrokFiles:et,resumeResponseId:es,disableToolComposer:eo=!1,disableMemory:en=!1,ff:ei}=e,er=x.w.getState(),ea=this.get(),el=(0,o.f)(),ed=new AbortController;er.idsertAbortControllerById(ed,S);let ec=R.x.getState().bestSubscription,eu=[],em=!h;if(em||(m=N({conversationId:S,responseId:"optimistic_query_".concat(y()()),parentResponseId:I,message:h,parentQuotedText:b,fileAttachments:T,webpageUrls:_,state:"optimistic"}),ea.upsertResponse(m),G(m)),!em&&(0,w.isEmpty)(I)){let e=null==(t=ea.byConversationId[S])?void 0:t.length,s=(0,r.Po)(ea.byConversationId[S]);(0,d.$s)("root_pivot",s,{conversationId:S,totalResponses:String(e),longestBranchLength:String(s)})}let eh="streaming_in_progress_".concat(y()()),ep="",eg="";if(es&&ea.byId[es]){let e=ea.byId[es];ep=e.message,eg=e.thinkingTrace}let ev=A({conversationId:S,responseId:eh,parentResponseId:em?I:null==m?void 0:m.responseId,sender:C,state:"optimistic",message:ep,thinkingTrace:eg},L,V);eu.push(ev),ea.upsertResponse(ev),Q(ev);let{modelConfigOverrideByModel:ef,isToolComposer2:eI,sideBySideMode:ey}=v.C$.getState(),ew=null!=(s=ef[C||"undefined"])?s:{};if((0,v.Qy)(ew)){let e={...ew};e.useToolOverrides||delete e.tools,p.modelConfigOverride=e}!eo&&(null!=eI?eI:ei.DEFAULT_USE_TOOL_COMPOSER2)&&(p.isMozart=!0);let eb=(c={parentResponseId:I,parentQuotedText:b,message:h,metadata:{...p,requestModelDetails:(0,n.I2)(C,ei)},modelName:C,fileAttachments:T,webpageUrls:_,toolOverrides:k,enableSideBySide:"never"!==ey&&!el,forceSideBySide:"always"===ey,systemPromptName:j,customInstructions:P,customPersonality:B,deepsearchPreset:L,disableArtifactDiff:q,isReasoning:V,imageEditUri:D,followUpType:O,isFromGrokFiles:et,resumeResponseId:es,disableMemory:en},{message:"",modelName:"",parentResponseId:"",parentQuotedText:void 0,systemPromptName:void 0,disableSearch:!1,imageAttachments:[],returnImageBytes:!1,returnRawGrokInXaiRequest:!1,fileAttachments:[],enableImageGeneration:!0,forceConcise:!1,enableImageStreaming:!0,enableSideBySide:!0,sendFinalMetadata:!0,imageGenerationCount:E,deepsearchPreset:"",isReasoning:!1,disableTextFollowUps:!0,followUpType:"",disableMemory:!1,...c}),eS=!1,eC=!1,ex=!1,eR=Date.now(),[eT,e_]=z(),{log:ek,stop:eM,resetTime:eP}=(0,a.Pp)("streamResponse",{type:"milliseconds_per_token",subscriptionTier:ec||"unknown",modelId:C,modelMode:(0,i.yv)({isReasoning:V,deepsearchPreset:L}),millisecondsPerTokenList:[]}),eB=(0,a.wl)("streamResponse",{type:"time_to_first_token",modelId:C,subscriptionTier:ec||"unknown",modelMode:(0,i.yv)({isReasoning:V,deepsearchPreset:L}),timeToFirstTokenMs:0},e=>{eu.forEach(t=>{t.liveTimeToFirstTokenMs=e})}),eE=(0,a.hl)("streamResponse",{type:"time_to_first_chunk",modelId:C,subscriptionTier:ec||"unknown",modelMode:(0,i.yv)({isReasoning:V,deepsearchPreset:L}),timeToFirstChunkMs:0},e=>{eu.forEach(t=>{t.liveTimeToFirstChunkMs=e})});return u.chatApi.chatAddResponseRaw({conversationId:S,body:eb}).then(async e=>{for await(let r of(m&&(m.state="streaming",e_(m)),(eu=eu.map(e=>({...e,state:"streaming"}))).forEach(e_),$(eu),(0,a.N8)("streamResponse",{type:"send_query_stream_start",subscriptionTier:ec||"unknown",modelId:C,modelMode:(0,i.yv)({isReasoning:V,deepsearchPreset:L})}),eP(),g(e.raw))){var t,s,o,n;if(eE(),ek(),r.error){let e=Error(r.error.message);throw Y(e),e}if(!r.result)continue;let e=r.result,{userResponse:i,sideBySideIndex:l,isSoftStop:c,modelResponse:u,authNotification:h}=e;if(null==i?void 0:i.error)throw m&&(m.state="error",m.error=i.error,e_(m)),(0,a.vV)("response-store:streamResponse:userResponseChunk",i.error),Error(i.error);if(null==u?void 0:u.error)throw(eu=eu.map(e=>({...e,state:"error",error:u.error}))).forEach(e_),(0,a.vV)("response-store:streamResponse:modelResponseChunk",u.error),Error(u.error);let p=this.processSideBySide({responseChunk:e,toggledExperiment:eS,conversationId:S,parentResponseId:I,userResponseId:null==m?void 0:m.responseId,modelName:C});if(p&&(eS=!0,p.uiLayout=null==(t=eu[0])?void 0:t.uiLayout,eu.push(p),e_(p),H(eu.map(e=>e.responseId))),i){eT(m={...i,conversationId:S,state:"closed",parentQuotedText:b}),W(m),eC=!0,(eu=eu.map(e=>({...e,parentResponseId:null==m?void 0:m.responseId}))).forEach(e_);continue}let g=null!=l?l:0,v=eu[g];if(!v)return;v=this.processResponseChunk({currentStreamResponse:v,responseChunk:e,onCitations:()=>K(v),onHasImage:X,onDisclaimer:J,onFollowUpSuggestedMode:e=>{var t;(0,d.$s)("follow_up_suggested_mode_button_shown",e.mode,{responseId:v.responseId,followUpSuggestedMode:null!=(t=e.mode)?t:"UNKNOWN"})},onUiLayout:e=>{eu=eu.map(t=>{var s;return{...t,uiLayout:{...null!=(s=t.uiLayout)?s:{},...e}}})}}),(e.token||e.messageTag)&&eB(),eT(v),eu[g]=v,c&&(v=this.processSoftStop({currentStreamResponse:v,responseChunk:e,startTimeMs:eR}),(0,d.$s)("generation_time_ms",v.generationTimeMs,{conversationId:S,responseId:v.responseId}),e_(v),eu.every(e=>"closed"===e.state)&&((0,d.$s)("finished_query",null==(s=eu[0])?void 0:s.responseId,{conversationId:S,toggledExperiment:eS.toString(),secondResponse:(null==(o=eu[1])?void 0:o.responseId)||"",isReasoning:V?V.toString():"",deepsearchPreset:L||""}),eu.forEach(e_),Z(eu,eu.map(e=>e.responseId)),ex=!0)),h&&((0,d.$s)("auth_notification_received",null==(n=eu[0])?void 0:n.responseId,{conversationId:S}),ex=!0)}if(eC||em||(this.ensureUserResponseSaved({conversationId:S,message:h,userResponse:m,onUserResponse:W,forceUpsertResponse:e_}).then(U(eu)).then(e=>eu=e).catch((0,a.HX)("response-store:useResponseStore:streamResponse")),eC=!0),!ex){let e=Error(f.CZ);(0,a.vV)("response-store:useResponseStore:streamResponse:closedStream",e)}(0,a.N8)("streamResponse",{type:"send_query_stream_success",subscriptionTier:ec||"unknown",modelId:C,modelMode:(0,i.yv)({isReasoning:V,deepsearchPreset:L})})}).catch(e=>{(0,l.GQ)(e)&&((0,a.vV)("response-store:useResponseStore:streamResponse",e),(0,a.N8)("streamResponse",{type:"send_query_stream_error",subscriptionTier:ec||"unknown",modelId:C,modelMode:(0,i.yv)({isReasoning:V,deepsearchPreset:L})}));let t=ee(e);if(F&&t)M(C,S,eu,V,L,$,K,J,X,Z,Y).catch(e=>{throw(0,a.vV)("response-store:useResponseStore:streamResponse:handleStreamError",e),e});else throw(eu=eu.map(e=>({...e,state:"error",compoutedThinkingEndTime:e.liveThinkingStartTime&&!e.liveThinkingEndTime?Date.now():e.liveThinkingEndTime,searchingEndTime:e.searchingStartTime&&!e.searchingEndTime?Date.now():e.searchingEndTime}))).forEach(e_),e}).finally(()=>{eM()})},this.reconnectToResponse=e=>{let{inflightResponse:t,conversationId:s,modelName:o,parentResponseId:n,enableRetries:r,isReasoning:l,deepsearchPreset:c,onStart:m,onCitations:h,onDisclaimer:p,onHasImage:v,onClose:I,onWke:w,onError:b}=e,S=this.get(),C=x.w.getState(),T=new AbortController,_=R.x.getState().bestSubscription,k=!1;if(!t.responseId)throw Error("Inflight response missing responseId");let P=[],B={type:"milliseconds_per_token",subscriptionTier:_||"unknown",modelId:o,modelMode:(0,i.yv)({isReasoning:l,deepsearchPreset:c}),millisecondsPerTokenList:[]},{log:E,stop:N,resetTime:L}=(0,a.Pp)("reconnectToResponse",B);return u.chatApi.chatReconnectResponseV2Raw({responseId:t.responseId}).then(async e=>{var u,y,b,x,R,M,B,N,U,j,V,D,O,F,q,G,Q,$,W,H,K;(0,a.N8)("reconnectToResponse",{type:"send_query_stream_reconnect_start",subscriptionTier:_||"unknown",modelId:o,modelMode:(0,i.yv)({isReasoning:l,deepsearchPreset:c})}),L();let J=g(e.raw);E();let X=await J.next();if(!(null==(u=X.value)?void 0:u.result)||!(null==(x=X.value)||null==(b=x.result)||null==(y=b.response)?void 0:y.modelResponse))throw Error("No initial state received from reconnect");let{title:Z,response:Y}=X.value.result;if(Z){let e=C.byId[s];C.upsertAndCacheConversation({...e,title:Z.newTitle})}let ee=A({...Y.modelResponse,responseId:t.responseId,inflightResponseId:t.responseId,conversationId:s,parentResponseId:n,sender:o,state:"streaming",...t.createTime&&{createTime:t.createTime}});if(((null==(R=Y.queryAction)?void 0:R.type)==="aurora"||(null==(M=Y.queryAction)?void 0:M.type)==="flux")&&(ee.hasImages=!0,v()),(null==(B=Y.queryAction)?void 0:B.type)==="x"&&(ee.hasSearches=!0),(null==(N=Y.followUpSuggestions)?void 0:N.suggestions)&&(ee.suggestions=Y.followUpSuggestions.suggestions),Y.followUpSuggestedMode&&(ee.followUpSuggestedMode=Y.followUpSuggestedMode),Y.finalMetadata&&(Y.finalMetadata.followUpSuggestions&&(ee.suggestions=Y.finalMetadata.followUpSuggestions),Y.finalMetadata.disclaimer&&p(Y.finalMetadata.disclaimer,ee.conversationId)),Y.cachedImageGenerationResponse&&Y.cachedImageGenerationResponse.imageUrl&&(ee.generatedImageUrls=ee.generatedImageUrls.concat([Y.cachedImageGenerationResponse.imageUrl])),Y.cardAttachment&&Y.cardAttachment.jsonData&&(ee.cardAttachmentsJson=ee.cardAttachmentsJson.concat([Y.cardAttachment.jsonData])),(null==(j=Y.modelResponse)||null==(U=j.steps)?void 0:U.length)&&(ee.searchingStartTime=new Date(ee.createTime).getTime(),(null==(G=Y.modelResponse)?void 0:G.message)&&(ee.searchingEndTime=Date.now())),(null==(V=Y.modelResponse)?void 0:V.thinkingTrace)&&(ee.liveThinkingStartTime=new Date(ee.createTime).getTime(),Y.isThinking||ee.liveThinkingEndTime||(ee.liveThinkingEndTime=Date.now())),Y.bannerMessage&&Y.bannerMessage.message&&p(Y.bannerMessage.message,ee.conversationId),Y.disclaimer&&Y.disclaimer.message&&p(Y.disclaimer.message,ee.conversationId),(null==(D=Y.modelResponse)?void 0:D.uiLayout)&&(ee.uiLayout=null==(Q=Y.modelResponse)?void 0:Q.uiLayout),P=[ee],C.idsertAbortControllerById(T,s),S.upsertResponse(ee),m(P),Y.streamingImageGenerationResponse){let{imageId:e,imageUrl:t}=Y.streamingImageGenerationResponse;if(e&&t){let s=null!=($=ee.streamingImageById)?$:{};Y.streamingImageGenerationResponse.progress&&(ee.streamingImageById={...s,[e]:{...null!=(W=s[e])?W:{},[Y.streamingImageGenerationResponse.progress]:Y.streamingImageGenerationResponse}}),S.setOneImageIdByUrl(e,t)}}((null==(O=ee.webSearchResults)?void 0:O.length)||(null==(F=ee.citedWebSearchResults)?void 0:F.length)||(null==(q=ee.xposts)?void 0:q.length))&&h(ee);let[et,es]=z(),eo=new Date(ee.createTime).getTime();try{for await(let e of J){if(E(),e.error){let t=Error(e.error.message);throw w(t),t}if(!e.result)continue;let{title:t,response:o}=e.result;if(null==t?void 0:t.newTitle){let e=C.byId[s];C.upsertAndCacheConversation({...e,title:t.newTitle})}if(o){if(null==(H=o.modelResponse)?void 0:H.error)throw(0,a.vV)("response-store:reconnectToResponse:modelResponse",o.modelResponse.error),Error(o.modelResponse.error);ee={...this.processResponseChunk({currentStreamResponse:ee,responseChunk:o,onCitations:()=>h(ee),onHasImage:v,onDisclaimer:p,onFollowUpSuggestedMode:e=>{var t;(0,d.$s)("follow_up_suggested_mode_button_shown",e.mode,{responseId:ee.responseId,followUpSuggestedMode:null!=(t=e.mode)?t:"UNKNOWN"})}}),parentResponseId:n},et(ee),P[0]=ee,o.isSoftStop&&(ee=this.processSoftStop({currentStreamResponse:ee,responseChunk:o,startTimeMs:eo}),(0,d.$s)("generation_time_ms",ee.generationTimeMs,{conversationId:s,responseId:ee.responseId}),es(ee),P.every(e=>"closed"===e.state)&&((0,d.$s)("finished_query",null==(K=P[0])?void 0:K.responseId,{conversationId:s,isReasoning:l?l.toString():"",deepsearchPreset:c||""}),P.forEach(es),I(P,P.map(e=>e.responseId)),k=!0)),o.authNotification&&(k=!0)}}if(!k){let e=Error(f.CZ);(0,a.vV)("response-store:useResponseStore:reconnectToResponse:closedStream",e)}(0,a.N8)("reconnectToResponse",{type:"send_query_stream_reconnect_success",subscriptionTier:_||"unknown",modelId:o,modelMode:(0,i.yv)({isReasoning:l,deepsearchPreset:c})})}catch(e){throw r||(ee={...ee,state:"error",liveThinkingEndTime:ee.liveThinkingStartTime&&!ee.liveThinkingEndTime?Date.now():ee.liveThinkingEndTime,searchingEndTime:ee.searchingStartTime&&!ee.searchingEndTime?Date.now():ee.searchingEndTime},P[0]=ee,es(ee)),e}}).catch(e=>{(0,a.vV)("response-store:reconnectToResponse",e),(0,a.N8)("reconnectToResponse",{type:"send_query_stream_reconnect_error",subscriptionTier:_||"unknown",modelId:o,modelMode:(0,i.yv)({isReasoning:l,deepsearchPreset:c})});let t=b(e);if(r&&t)M(o,s,P,l,c,m,h,p,v,I,w).catch(e=>{throw(0,a.vV)("response-store:reconnectToResponse:handleStreamError",e),e});else{if(0===P.length){let e=A({conversationId:s,responseId:"streaming_in_progress_".concat(y()()),parentResponseId:n,sender:o,state:"error"});P=[e],S.upsertResponse(e)}throw e}}).finally(()=>{C.removeAbortControllerById(s),N()})},this.streamCreateAndRespond=async e=>{var t,s;let{temporary:r,message:c,modelName:m,fileAttachmentIds:h,webpageUrls:p,systemPromptName:I,personaId:w,toolOverrides:b,isPreset:S,customInstructions:C,customPersonality:T,deepsearchPreset:_,isReasoning:k,imageEditUri:P,enableRetries:B,disableArtifactDiff:L,onOptimisticConversation:j,onOptimisticResponse:V,onStart:D,onConversation:O,onUserResponse:F,onStartExperiment:q,onCitations:G,onDisclaimer:Q,onHasImage:$,onClose:W,onWke:H,onError:K,workspaceIds:J,responseMetadata:X={},isFromGrokFiles:Z,disableToolComposer:Y=!1,disableMemory:ee=!1,ff:et}=e,es=this.get(),eo=x.w.getState(),en=(0,o.f)(),ei=R.x.getState().bestSubscription,er="optimistic_conversation_".concat(y()()),ea=(0,x.b)({conversationId:er,personaId:w,temporary:r});eo.upsertAndCacheConversation(ea),j(ea);let el="optimistic_response_".concat(y()()),ed=N({conversationId:ea.conversationId,responseId:el,message:c,fileAttachments:h,webpageUrls:p});es.upsertResponse(ed),V(ed);let ec="streaming_in_progress_".concat(y()()),eu=A({conversationId:ea.conversationId,responseId:ec,parentResponseId:ed.responseId,sender:m},_,k),em=[eu];es.upsertResponse(eu);let{modelConfigOverrideByModel:eh,isToolComposer2:ep,sideBySideMode:eg}=v.C$.getState(),ev=null!=(t=eh[m||"undefined"])?t:{};if((0,v.Qy)(ev)){let e={...ev};e.useToolOverrides||delete e.tools,X.modelConfigOverride=e}!Y&&(null!=ep?ep:et.DEFAULT_USE_TOOL_COMPOSER2)&&(X.isMozart=!0);let ef=(s={temporary:r,message:c,modelName:m,fileAttachments:h,webpageUrls:p,systemPromptName:null!=I?I:w,toolOverrides:b,enableSideBySide:"never"!==eg&&!en,forceSideBySide:"always"===eg,customInstructions:C,customPersonality:T,deepsearchPreset:_,isReasoning:k,disableArtifactDiff:L,imageEditUri:P,workspaceIds:J,isFromGrokFiles:Z,responseMetadata:{...X,requestModelDetails:(0,n.I2)(m,et)},disableMemory:ee},{systemPromptName:"",temporary:!1,message:"",modelName:"",fileAttachments:[],imageAttachments:[],disableSearch:!1,enableImageGeneration:!0,returnImageBytes:!1,returnRawGrokInXaiRequest:!1,enableImageStreaming:!0,imageGenerationCount:E,forceConcise:!1,enableSideBySide:!0,sendFinalMetadata:!0,disableTextFollowUps:!0,...s}),eI=new AbortController;eo.idsertAbortControllerById(eI,er);let ey=!1,ew=!1,eb=!1,eS=Date.now(),[eC,ex]=z(),{log:eR,stop:eT,resetTime:e_}=(0,a.Pp)("streamCreateAndRespond",{type:"milliseconds_per_token",subscriptionTier:ei||"unknown",modelId:m,modelMode:(0,i.yv)({isReasoning:k,deepsearchPreset:_}),millisecondsPerTokenList:[]}),ek=(0,a.wl)("streamCreateAndRespond",{type:"time_to_first_token",modelId:m,subscriptionTier:ei||"unknown",modelMode:(0,i.yv)({isReasoning:k,deepsearchPreset:_}),timeToFirstTokenMs:0},e=>{em.forEach(t=>{t.liveTimeToFirstTokenMs=e})}),eM=(0,a.hl)("streamCreateAndRespond",{type:"time_to_first_chunk",modelId:m,subscriptionTier:ei||"unknown",modelMode:(0,i.yv)({isReasoning:k,deepsearchPreset:_}),timeToFirstChunkMs:0},e=>{em.forEach(t=>{t.liveTimeToFirstChunkMs=e})});return u.chatApi.chatCreateConversationAndRespondRaw({body:ef}).then(async e=>{for await(let n of(ed={...ed,state:"streaming"},em=em.map(e=>({...e,state:"streaming"})),ex(ed),em.forEach(ex),D(em),(0,a.N8)("streamCreateAndRespond",{type:"send_query_stream_start",subscriptionTier:ei||"unknown",modelId:m,modelMode:(0,i.yv)({isReasoning:k,deepsearchPreset:_})}),e_(),g(e.raw))){if(eM(),eR(),n.error){let e=Error(n.error.message);throw H(e),e}if(!n.result)continue;let{response:e,conversation:i,title:r}=n.result;if(i){let e=ea.conversationId;ea={...ea,isNew:!0,fromPreset:S,state:"closed",systemPromptName:"",...i},eo.upsertAndCacheConversation(ea,e),eo.idsertAbortControllerById(eI,ea.conversationId),ed={...ed,conversationId:ea.conversationId},em=em.map(e=>({...e,parentResponseId:ed.responseId,conversationId:ea.conversationId})),eC(ed),em.forEach(ex),O(ea);continue}if((null==r?void 0:r.newTitle)&&(ea={...ea,title:r.newTitle},eo.upsertAndCacheConversation(ea)),e){var t,s,o;let{userResponse:n,sideBySideIndex:i,isSoftStop:r,modelResponse:l,authNotification:c}=e;if(null==n?void 0:n.error)throw ex(ed={...ed,...n,state:"error"}),(0,a.vV)("response-store:useResponseStore:streamResponse:userResponseChunk",n.error),Error(n.error);if(null==l?void 0:l.error)throw(em=em.map(e=>({...e,...l,state:"error"}))).forEach(ex),(0,a.vV)("response-store:useResponseStore:streamResponse:modelResponseChunk",l.error),Error(l.error);let u=this.processSideBySide({responseChunk:e,toggledExperiment:ey,conversationId:ea.conversationId,parentResponseId:ed.responseId,modelName:m});if(u&&(ey=!0,u.uiLayout=null==(t=em[0])?void 0:t.uiLayout,em.push(u),ex(u),q(em.map(e=>e.responseId))),n){eC(ed={...ed,...n,conversationId:ea.conversationId,state:"closed"}),F(ed),ew=!0,(em=em.map(e=>({...e,parentResponseId:null==ed?void 0:ed.responseId}))).forEach(ex);continue}let h=null!=i?i:0,p=em[h];if(!p)continue;p=this.processResponseChunk({currentStreamResponse:p,responseChunk:e,onCitations:()=>G(p),onHasImage:$,onDisclaimer:Q,onFollowUpSuggestedMode:e=>{var t;(0,d.$s)("follow_up_suggested_mode_button_shown",e.mode,{responseId:p.responseId,followUpSuggestedMode:null!=(t=e.mode)?t:"UNKNOWN"})},onUiLayout:e=>{em=em.map(t=>{var s;return{...t,uiLayout:{...null!=(s=t.uiLayout)?s:{},...e}}})}}),(e.token||e.messageTag)&&ek(),eC(p),em[h]=p,r&&(p=this.processSoftStop({currentStreamResponse:p,responseChunk:e,startTimeMs:eS}),(0,d.$s)("generation_time_ms",p.generationTimeMs,{conversationId:ea.conversationId,responseId:p.responseId}),ex(p),em.every(e=>"closed"===e.state)&&((0,d.$s)("finished_query",null==(s=em[0])?void 0:s.responseId,{conversationId:ea.conversationId,toggledExperiment:ey.toString(),secondResponse:(null==(o=em[1])?void 0:o.responseId)||"",isReasoning:k?k.toString():"",deepsearchPreset:_||""}),em.forEach(ex),W(em),eb=!0)),c&&(eb=!0)}}if(ew||(this.ensureUserResponseSaved({conversationId:ea.conversationId,message:c,userResponse:ed,onUserResponse:F,forceUpsertResponse:ex}).then(U(em)).then(e=>em=e).catch((0,a.HX)("response-store:useResponseStore:streamCreateAndRespond")),ew=!0),!eb){let e=Error(f.CZ);(0,a.vV)("response-store:useResponseStore:streamCreateAndRespond:closedStream",e)}(0,a.N8)("streamCreateAndRespond",{type:"send_query_stream_success",subscriptionTier:ei||"unknown",modelId:m,modelMode:(0,i.yv)({isReasoning:k,deepsearchPreset:_})})}).catch(e=>{(0,l.GQ)(e)&&((0,a.vV)("response-store:useResponseStore:streamCreateAndRespond",e),(0,a.N8)("streamCreateAndRespond",{type:"send_query_stream_error",subscriptionTier:ei||"unknown",modelId:m,modelMode:(0,i.yv)({isReasoning:k,deepsearchPreset:_})}));let t=K(e);if(B&&t)M(m,ea.conversationId,em,k,_,D,G,Q,$,W,H).catch(e=>{throw(0,a.vV)("response-store:useResponseStore:streamCreateAndRespond:handleStreamError",e),e});else throw(em=em.map(e=>({...e,state:"error",liveThinkingEndTime:e.liveThinkingStartTime&&!e.liveThinkingEndTime?Date.now():e.liveThinkingEndTime,searchingEndTime:e.searchingStartTime&&!e.searchingEndTime?Date.now():e.searchingEndTime}))).forEach(ex),W(em),e}).finally(()=>{eT()})},this.ensureUserResponseSaved=e=>{let{conversationId:t,message:s,userResponse:o,onUserResponse:n,forceUpsertResponse:i}=e;return this.get().addUserResponse(t,s).then(e=>(i(e),n(e),e)).catch(()=>{if(!o)return;let e={...o,state:"error"};return i(e),e})},this.abortStream=async(e,t)=>{let s=this.get(),o=x.w.getState(),n=s.byId[t];if(!n.state||!["streaming","error","reconnecting"].includes(n.state))return Promise.resolve(t);let i=o.abortControllerById[e];return i&&(i.abort(),o.removeAbortControllerById(e)),u.chatApi.chatStopConversationInflightResponses({conversationId:e}).then(()=>{let t={...n,responseId:n.inflightResponseId,conversationId:e,state:"closed",partial:!0,liveThinkingEndTime:n.liveThinkingStartTime&&!n.liveThinkingEndTime?Date.now():n.liveThinkingEndTime,searchingEndTime:n.searchingStartTime&&!n.searchingEndTime?Date.now():n.searchingEndTime};return s.upsertResponse(t),t.responseId}).catch(e=>{let t={...n,state:"error",liveThinkingEndTime:n.liveThinkingStartTime&&!n.liveThinkingEndTime?Date.now():n.liveThinkingEndTime,searchingEndTime:n.searchingStartTime&&!n.searchingEndTime?Date.now():n.searchingEndTime};throw s.upsertResponse(t),e})},this.addUserResponse=(e,t,s)=>u.chatApi.chatAddUserResponse({conversationId:e,body:{message:t,parentResponseId:s}}).then(t=>{let s=this.get(),o={...t,conversationId:e};return s.upsertResponse(o),o}),this.addToolResponse=(e,t)=>u.chatApi.chatAddToolResponse({body:{responseId:e,toolResponse:t}}).then(()=>{let s=this.get(),o=s.byId[e];if(o){let e={...o,toolResponses:[...o.toolResponses||[],t]};return s.upsertResponse(e),e}throw Error("Response not found in state")}),this.createVoiceUserMessage=e=>{let{userResponseId:t,conversationId:s,parentResponseId:o,message:n,onUserResponse:i,onOptimisticModelResponse:r}=e,a=this.get(),l=N({responseId:t,parentResponseId:o,message:n,conversationId:s,state:"closed",partial:!1});a.upsertResponse(l),i(l);let d=A({conversationId:s,responseId:"streaming_in_progress_".concat(y()()),parentResponseId:l.responseId,sender:"ASSISTANT",state:"streaming"});a.upsertResponse(d),r(d)}}}async function M(e,t,s,o,n,r,c,m,h,p,v){let f=P.getState(),I=x.w.getState(),y=R.x.getState().bestSubscription,w=s.map(e=>({...e,state:"reconnecting"}));w.forEach(f.upsertResponse);let b=e=>new Promise(t=>setTimeout(t,e));if(t.startsWith("optimistic_conversation_"))return void(w=w.map(e=>({...e,state:"error"}))).forEach(f.upsertResponse);let S={type:"milliseconds_per_token",subscriptionTier:y||"unknown",modelId:e,modelMode:(0,i.yv)({isReasoning:o,deepsearchPreset:n}),millisecondsPerTokenList:[]},{log:C,stop:T,resetTime:_}=(0,a.Pp)("handleStreamError",S);(0,a.N8)("handleStreamError",{type:"send_query_stream_auto_reconnect_start",subscriptionTier:y||"unknown",modelId:e,modelMode:(0,i.yv)({isReasoning:o,deepsearchPreset:n})});for(let s=1;s<=10;s++){try{let s=await f.fetchListInflightResponses(t,!0);if(s.length>0&&s[0].responseId&&w[0].parentResponseId){await u.chatApi.chatReconnectResponseV2Raw({responseId:s[0].responseId}).then(async l=>{var u,b,S,x,R,T,k,M,P,B,E,N,L,U,j,V,D,O,F;(0,a.N8)("handleStreamError",{type:"send_query_stream_reconnect_start",subscriptionTier:y||"unknown",modelId:e,modelMode:(0,i.yv)({isReasoning:o,deepsearchPreset:n})}),_();let q=g(l.raw);C();let G=await q.next();if(!(null==(u=G.value)?void 0:u.result)||!(null==(x=G.value)||null==(S=x.result)||null==(b=S.response)?void 0:b.modelResponse))throw Error("No initial state received from reconnect");let{title:Q,response:$}=G.value.result;if(Q){let e=I.byId[t];I.upsertAndCacheConversation({...e,title:Q.newTitle})}let W=A({...$.modelResponse,conversationId:t,responseId:w[0].responseId,parentResponseId:w[0].parentResponseId,sender:w[0].sender,state:"streaming",...s[0].createTime&&{createTime:s[0].createTime}});if(((null==(R=$.queryAction)?void 0:R.type)==="aurora"||(null==(T=$.queryAction)?void 0:T.type)==="flux")&&(W.hasImages=!0,h()),(null==(k=$.queryAction)?void 0:k.type)==="x"&&(W.hasSearches=!0),(null==(M=$.followUpSuggestions)?void 0:M.suggestions)&&(W.suggestions=$.followUpSuggestions.suggestions),$.followUpSuggestedMode&&(W.followUpSuggestedMode=$.followUpSuggestedMode),$.finalMetadata&&($.finalMetadata.followUpSuggestions&&(W.suggestions=$.finalMetadata.followUpSuggestions),$.finalMetadata.disclaimer&&m($.finalMetadata.disclaimer,W.conversationId)),$.cachedImageGenerationResponse&&$.cachedImageGenerationResponse.imageUrl&&(W.generatedImageUrls=W.generatedImageUrls.concat([$.cachedImageGenerationResponse.imageUrl])),$.cardAttachment&&$.cardAttachment.jsonData&&(W.cardAttachmentsJson=W.cardAttachmentsJson.concat([$.cardAttachment.jsonData])),(null==(B=$.modelResponse)||null==(P=B.steps)?void 0:P.length)&&(W.searchingStartTime=new Date(W.createTime).getTime(),(null==(j=$.modelResponse)?void 0:j.message)&&(W.searchingEndTime=Date.now())),$.bannerMessage&&$.bannerMessage.message&&m($.bannerMessage.message,W.conversationId),$.disclaimer&&$.disclaimer.message&&m($.disclaimer.message,W.conversationId),(null==(E=$.modelResponse)?void 0:E.thinkingTrace)&&(W.liveThinkingStartTime=new Date(W.createTime).getTime(),$.isThinking||W.liveThinkingEndTime||(W.liveThinkingEndTime=Date.now())),w=[W],f.upsertResponse(W),r(w),$.streamingImageGenerationResponse){let{imageId:e,imageUrl:t}=$.streamingImageGenerationResponse;if(e&&t){let s=null!=(V=W.streamingImageById)?V:{};$.streamingImageGenerationResponse.progress&&(W.streamingImageById={...s,[e]:{...null!=(D=s[e])?D:{},[$.streamingImageGenerationResponse.progress]:$.streamingImageGenerationResponse}}),f.setOneImageIdByUrl(e,t)}}((null==(N=W.webSearchResults)?void 0:N.length)||(null==(L=W.citedWebSearchResults)?void 0:L.length)||(null==(U=W.xposts)?void 0:U.length))&&c(W);let[H,K]=z(),J=new Date(W.createTime).getTime();for await(let e of q){if(C(),e.error){let t=Error(e.error.message);throw v(t),t}if(!e.result)continue;let{title:s,response:i}=e.result;if(null==s?void 0:s.newTitle){let e=I.byId[t];I.upsertAndCacheConversation({...e,title:s.newTitle})}if(i){if(null==(O=i.modelResponse)?void 0:O.error)throw(0,a.vV)("response-store:handleStreamError:modelResponse",i.modelResponse.error),Error(i.modelResponse.error);W={...f.processResponseChunk({currentStreamResponse:W,responseChunk:i,onCitations:()=>c(W),onHasImage:h,onDisclaimer:m,onFollowUpSuggestedMode:e=>{var t;(0,d.$s)("follow_up_suggested_mode_button_shown",e.mode,{responseId:W.responseId,followUpSuggestedMode:null!=(t=e.mode)?t:"UNKNOWN"})}}),parentResponseId:w[0].parentResponseId},H(W),w[0]=W,i.isSoftStop&&(W=f.processSoftStop({currentStreamResponse:W,responseChunk:i,startTimeMs:J}),(0,d.$s)("generation_time_ms",W.generationTimeMs,{conversationId:t,responseId:W.responseId}),K(W),w.every(e=>"closed"===e.state)&&((0,d.$s)("finished_query",null==(F=w[0])?void 0:F.responseId,{conversationId:t,isReasoning:o?o.toString():"",deepsearchPreset:n||""}),w.forEach(K),p(w,w.map(e=>e.responseId))))}}("streaming"===W.state||"reconnecting"===W.state)&&(W={...W,state:"closed",liveThinkingEndTime:W.liveThinkingStartTime&&!W.liveThinkingEndTime?Date.now():W.liveThinkingEndTime,searchingEndTime:W.searchingStartTime&&!W.searchingEndTime?Date.now():W.searchingEndTime},w[0]=W,K(W)),p(w,w.map(e=>e.responseId)),(0,a.N8)("handleStreamError",{type:"send_query_stream_auto_reconnect_success",subscriptionTier:y||"unknown",modelId:e,modelMode:(0,i.yv)({isReasoning:o,deepsearchPreset:n})}),(0,a.N8)("handleStreamError",{type:"send_query_stream_reconnect_success",subscriptionTier:y||"unknown",modelId:e,modelMode:(0,i.yv)({isReasoning:o,deepsearchPreset:n})})});break}(w=w.map(e=>({...e,state:"error",liveThinkingEndTime:e.liveThinkingStartTime&&!e.liveThinkingEndTime?Date.now():e.liveThinkingEndTime,searchingEndTime:e.searchingStartTime&&!e.searchingEndTime?Date.now():e.searchingEndTime}))).forEach(f.upsertResponse),(0,a.N8)("handleStreamError",{type:"send_query_stream_auto_reconnect_fail",subscriptionTier:y||"unknown",modelId:e,modelMode:(0,i.yv)({isReasoning:o,deepsearchPreset:n})});break}catch(t){if(T(),(0,a.vV)("response-store:handleStreamError:retryError",t),(0,l.GQ)(t)&&((0,a.N8)("handleStreamError",{type:"send_query_stream_auto_reconnect_error",subscriptionTier:y||"unknown",modelId:e,modelMode:(0,i.yv)({isReasoning:o,deepsearchPreset:n})}),(0,a.N8)("handleStreamError",{type:"send_query_stream_reconnect_error",subscriptionTier:y||"unknown",modelId:e,modelMode:(0,i.yv)({isReasoning:o,deepsearchPreset:n})})),10===s)throw(0,a.N8)("handleStreamError",{type:"send_query_stream_auto_reconnect_fail",subscriptionTier:y||"unknown",modelId:e,modelMode:(0,i.yv)({isReasoning:o,deepsearchPreset:n})}),(w=w.map(e=>({...e,state:"error"}))).forEach(f.upsertResponse),t;await b(2e3),(w=w.map(e=>({...e,state:"reconnecting"}))).forEach(f.upsertResponse)}T()}}let P=(0,c.y$)(k,"useResponseStore");function B(e,t){return P(s=>{var o;return e?null==(o=s.byId[e])?void 0:o[t]:void 0})}(0,c.lB)(P,"byId","byConversationId",(e,t)=>{let s=Object.values(e),o=P.getState().byConversationId,n=new Set(b()(s).filter(e=>e!==t[e.responseId]||!!e.state&&"closed"!==e.state).map(e=>e.conversationId).value()),i=s.filter(e=>n.has(e.conversationId)),r=S.A(e=>e.conversationId,i);return{...o,...b().pick(r,[...n.values()])}}),(0,c.lB)(P,"byId","nodesByConversationId",e=>{let t=P.getState().nodesByConversationId,s=!1,o={};for(let n in e){let i=e[n],r=i.conversationId,a=t[r]||[],l=a.find(e=>e.responseId===n);l?"streaming"===i.state&&l.parentResponseId!==i.parentResponseId&&(s=!0,o[r]=[...a,{...l,parentResponseId:i.parentResponseId}]):(s||(s=!0,o={...t}),o[r]?o[r]===a&&(o[r]=[...a]):o[r]=[...a],o[r].push({responseId:n,parentResponseId:i.parentResponseId,sender:i.sender}))}return s?o:t});let E=2;function N(e){return{sender:"human",createTime:new Date().toISOString(),manual:!1,partial:!0,shared:!1,isControl:!1,query:"",queryType:"",thinkingTrace:"",webSearchResults:[],xpostIds:[],xposts:[],generatedImageUrls:[],imageAttachments:[],imageEditUris:[],fileAttachments:[],cardAttachmentsJson:[],fileUris:[],fileAttachmentsMetadata:[],state:"optimistic",parentResponseId:"",parentQuotedText:void 0,steps:[],imageEditUri:"",error:"",mediaTypes:[],webpageUrls:[],citedWebSearchResults:[],metadata:{},uiLayout:{reasoningUiLayout:"UNSPECIFIED"},selectedFileTextContent:"",selectedFileTextContentStartPosition:0,selectedFileTextContentEndPosition:0,toolResponses:[],toolUsageResultById:{},traceSteps:[],...e}}function A(e,t,s){let o="default"===t?Date.now():void 0,n=s?Date.now():void 0;return{message:"",createTime:new Date().toISOString(),manual:!1,partial:!0,shared:!1,isControl:!1,query:"",queryType:"",thinkingTrace:"",webSearchResults:[],xpostIds:[],xposts:[],generatedImageUrls:[],imageAttachments:[],imageEditUris:[],fileAttachments:[],cardAttachmentsJson:[],fileUris:[],fileAttachmentsMetadata:[],state:"streaming",steps:[],imageEditUri:"",error:"",mediaTypes:[],webpageUrls:[],citedWebSearchResults:[],metadata:{},deepsearchPreset:t,generatedImageHeight:void 0,generatedImageWidth:void 0,...e,liveThinkingStartTime:n,searchingStartTime:o,selectedFileTextContent:"",selectedFileTextContentStartPosition:0,selectedFileTextContentEndPosition:0,uiLayout:{reasoningUiLayout:"UNSPECIFIED"},toolResponses:[],toolUsageResultById:{},traceSteps:[]}}function z(){let e,t={};return[s=>{if(!e){P.getState().upsertResponse(s),e=setTimeout(()=>{let s=Object.values(t);t={},s.length&&P.getState().appendResponses(s),e=void 0},30);return}t[s.responseId]=s},s=>{s&&(t[s.responseId]=s),clearTimeout(e);let o=Object.values(t);t={},o.length&&P.getState().appendResponses(o),e=void 0}]}function L(e){return e.liveThinkingStartTime||e.searchingStartTime||e.thinkingStartTime}function U(e){return t=>(t&&e.forEach(e=>{e.parentResponseId=t.responseId}),e)}let j={header:0,summary:1,tool:1}},44347:(e,t,s)=>{s.d(t,{C$:()=>y,DC:()=>h,K2:()=>m,Qy:()=>p});var o=s(65258),n=s(64389),i=s(31352),r=s.n(i),a=s(96892),l=s.n(a),d=s(6132),c=s(4890),u=s(17823);let m={web_search:"web_search",google_web_search:"google_web_search",bing_web_search:"bing_web_search",web_search_with_snippets:"web_search_with_snippets",browse_page_with_js:"browse_page_with_js",browse_page_no_js:"browse_page_no_js",code_execution_training_parity:"code_execution_training_parity",get_x_user_handle:"get_x_user_handle",get_x_user_profile_pic_description:"get_x_user_profile_pic_description",x_post_lookup:"x_post_lookup",x_search:"x_search",x_keyword_search:"x_keyword_search",x_semantic_search:"x_semantic_search",get_top_us_news_from_x_trends:"get_top_us_news_from_x_trends",get_x_user_timeline:"get_x_user_timeline",get_x_bookmarks:"get_x_bookmarks",get_x_liked_posts:"get_x_liked_posts",render_x_posts:"render_x_posts",render_x_users:"render_x_users",render_card:"render_card"},h=d.z.object({promptMap:d.z.object({toolUseFc:d.z.string().nullish(),noToolUse:d.z.string().nullish(),toolUseSummarizer:d.z.string().nullish()}).nullish(),modelMap:d.z.object({noToolUse:d.z.string().nullish(),toolUse:d.z.string().nullish(),toolUseSummarizer:d.z.string().nullish(),imageGenModel:d.z.string().nullish(),imageEditModel:d.z.string().nullish()}).nullish(),useSingleModelEverything:d.z.boolean().nullish(),tools:d.z.record(d.z.nativeEnum(m),d.z.boolean()).nullish(),useToolOverrides:d.z.boolean().nullish()});function p(e){let t=Object.values(null!=e?e:{});return!!t&&t.some(e=>"object"==typeof e&&e?Object.values(e).length>0:!e)}d.z.object({displayUserMessageMarkdown:d.z.boolean(),showFollowUpSuggestions:d.z.boolean(),autoWrapLongLinesCode:d.z.boolean(),browserNotificationsEnabled:d.z.boolean(),selectedSystemPromptId:d.z.string().optional(),showConversationPreviews:d.z.boolean().optional(),hideArtifacts:d.z.boolean().optional(),autoDetectWebpageAttachments:d.z.boolean(),showActiveTabs:d.z.boolean().optional(),disableTypeahead:d.z.boolean().optional(),disableAutoScroll:d.z.boolean().optional()});let g={displayUserMessageMarkdown:!1,showFollowUpSuggestions:!0,autoWrapLongLinesCode:!1,browserNotificationsEnabled:!1,selectedSystemPromptId:void 0,showConversationPreviews:!0,hideArtifacts:!1,autoDetectWebpageAttachments:!1,showActiveTabs:!0,disableTypeahead:!1,disableAutoScroll:!1},v={isIncognito:!1,userSettingsPromise:void 0,userSettings:{excludeFromTraining:!1,allowXPersonalization:!0,preferences:g,enableMemory:!0},selectedLanguage:void 0,showAgeVerification:!1,ageVerificationCallback:void 0,modelConfigOverride:void 0,modelConfigOverrideByModel:{}},f={excludeFromTraining:!0,allowXPersonalization:!1,preferences:g,enableMemory:!1};class I{constructor(e,t){this.set=e,this.get=t,this.isIncognito=v.isIncognito,this.userSettingsPromise=v.userSettingsPromise,this.userSettings=v.userSettings,this.selectedLanguage=v.selectedLanguage,this.showAgeVerification=v.showAgeVerification,this.ageVerificationCallback=v.ageVerificationCallback,this.modelConfigOverride=v.modelConfigOverride,this.modelConfigOverrideByModel=v.modelConfigOverrideByModel,this.isToolComposer2=v.isToolComposer2,this.sideBySideMode=v.sideBySideMode,this.setIsIncognito=(0,o.kp)(this.set,"isIncognito"),this.setUserSettingsPromise=(0,o.kp)(this.set,"userSettingsPromise"),this.setUserSettings=(0,o.kp)(this.set,"userSettings"),this.setSelectedLanguage=(0,o.kp)(this.set,"selectedLanguage"),this.setShowAgeVerification=(0,o.kp)(this.set,"showAgeVerification"),this.setAgeVerificationCallback=(0,o.kp)(this.set,"setAgeVerificationCallback"),this.setModelConfigOverrideByModel=(0,o.kp)(this.set,"modelConfigOverrideByModel"),this.setIsToolComposer2=(0,o.kp)(this.set,"isToolComposer2"),this.setSideBySideMode=(0,o.kp)(this.set,"sideBySideMode"),this.initializeGdprUserSettings=()=>n.aK.settingsGetUserSettings().then(e=>{let t=this.get();void 0===e.excludeFromTraining||void 0===e.enableMemory?t.fetchSetUserSettings(f).catch(console.error):t.setUserSettings(b(e,t.userSettings))}),this.initializeEnterpriseUserSettings=()=>n.aK.settingsGetUserSettings().then(e=>{let t=this.get();e.excludeFromTraining?t.setUserSettings(b(e,t.userSettings)):t.fetchSetUserSettings(f).catch(console.error)}),this.fetchGetUserSettings=()=>{let e=this.get();if(e.userSettingsPromise)return e.userSettingsPromise;let t=n.aK.settingsGetUserSettings().then(t=>b(t,e.userSettings));return e.setUserSettingsPromise(t),t.then(e.setUserSettings).catch(console.error),t},this.fetchSetUserSettings=e=>{let t=this.get();t.setUserSettings({...t.userSettings,...e});let s=n.aK.settingsSetUserSettings({body:e}).then(e=>b(e,this.get().userSettings));return t.setUserSettingsPromise(s),s.then(t.setUserSettings).catch(e=>{console.error(e)}),s},this.fetchSetPreference=(e,t)=>{let s=this.get();return s.fetchSetUserSettings({...s.userSettings,preferences:{...s.userSettings.preferences,[e]:t}})}}}let y=(0,c.v)()((0,u.lt)((0,u.eh)((0,u.Zr)((e,t)=>new I(e,t),{name:"settings-store",partialize:e=>({modelConfigOverrideByModel:e.modelConfigOverrideByModel,isToolComposer2:e.isToolComposer2,sideBySideMode:e.sideBySideMode}),version:2})),{name:"useSettingsStore"}));function w(e,t){return d.z.object({displayUserMessageMarkdown:d.z.boolean().catch(e.displayUserMessageMarkdown),showFollowUpSuggestions:d.z.boolean().catch(e.showFollowUpSuggestions),autoWrapLongLinesCode:d.z.boolean().catch(e.autoWrapLongLinesCode),browserNotificationsEnabled:d.z.boolean().catch(e.browserNotificationsEnabled),selectedSystemPromptId:d.z.string().optional().catch(e.selectedSystemPromptId),showConversationPreviews:d.z.boolean().optional().catch(e.showConversationPreviews),hideArtifacts:d.z.boolean().optional().catch(e.hideArtifacts),autoDetectWebpageAttachments:d.z.boolean().catch(e.autoDetectWebpageAttachments),showActiveTabs:d.z.boolean().optional().catch(e.showActiveTabs),disableTypeahead:d.z.boolean().optional().catch(e.disableTypeahead),disableAutoScroll:d.z.boolean().optional().catch(e.disableAutoScroll)}).catch(e).parse(t)}function b(e,t){let s=l()(e,r());return{...t,...s,preferences:w(t.preferences,e.preferences)}}(0,o.CP)(y,"userSettings","user-settings",v.userSettings,function(e){return e&&"object"==typeof e?{excludeFromTraining:v.userSettings.excludeFromTraining,allowXPersonalization:v.userSettings.allowXPersonalization,preferences:{...w(g,e.userSettings),disableTypeahead:!1},enableMemory:v.userSettings.enableMemory}:v.userSettings})},44845:(e,t,s)=>{s.d(t,{Ku:()=>i,TM:()=>n,ot:()=>a,yv:()=>r});var o=s(6132);let n=o.z.union([o.z.literal("none"),o.z.literal("unknown"),o.z.literal("deepsearch"),o.z.literal("deepersearch"),o.z.literal("think")]);function i(e){return"deepersearch"===e?"deeper":"deepsearch"===e?"default":void 0}function r(e){let{isReasoning:t,deepsearchPreset:s}=e;return t?"think":"deeper"===s?"deepersearch":"default"===s?"deepsearch":s?"unknown":"none"}function a(e){return"deepersearch"===e?"DEEPERSEARCH":"deepsearch"===e?"DEEPSEARCH":"think"===e?"REASONING":"DEFAULT"}},48992:(e,t,s)=>{s.d(t,{Cg:()=>l,Mb:()=>d,Po:()=>u,Wm:()=>function e(t,s){let o=t[s];if(!o)return s;let n=o[o.length-1];return n&&n.responseId?e(t,n.responseId):s},d7:()=>r,m$:()=>a,zp:()=>c});var o=s(38541),n=s.n(o),i=s(17703);function r(e,t,s){let o=n().keyBy(t,"responseId"),i=o[e];if(!i)return[];let r=[i],a=i.parentResponseId;for(;a&&(!s||r.length<s);){let e=o[a];if(!e)break;r.push(e),a=e.parentResponseId}return r}function a(e,t){let s;for(let o of e)if(t.find(e=>e.responseId===o.responseId))s=o;else break;return s}function l(e,t){let s=[],o=e,n=new Set;for(;o;){if(n.has(o.responseId||"")){(0,i.vV)("conversation-utils:getAncestorIds","Cycle detected in response hierarchy: ".concat(o.responseId));break}n.add(o.responseId||""),s.unshift(o.responseId||"");let e=o.parentResponseId;if(!e)break;o=t[e]}return s}function d(e){let t=new Set(e.map(e=>e.parentResponseId)),s=e.filter(e=>!t.has(e.responseId));if(0!==s.length)return n().maxBy(s,e=>e.createTime)}function c(e,t,s){if(!s)return!1;for(let o of r(s,t))if(o.responseId&&!e.some(e=>e.responseId===o.responseId))return!0;return!1}function u(e){if(!e||0===e.length)return 0;let t=new Set(e.map(e=>e.parentResponseId).filter(e=>e&&!(0,o.isEmpty)(e))),s=e.filter(e=>!t.has(e.responseId)),n=0;for(let t of s)n=Math.max(n,r(t.responseId,e).length);return n}},49972:(e,t,s)=>{s.d(t,{b:()=>b,w:()=>w});var o=s(2376),n=s(17703),i=s(65258),r=s(64389),a=s(94980),l=s(3275),d=s(74995),c=s(6230),u=s(23831),m=s(53915),h=s(3814),p=s(54542),g=s(98451),v=s(43893);function f(e){return{...e,personaId:(0,o._c)(e.systemPromptName),isNew:!1,state:"closed"}}let I=a.A(f);class y{constructor(e,t){this.set=e,this.get=t,this.promiseById={},this.byId={},this.list=[],this.abortControllerById={},this.listPromiseByQuery={},this.nextPageTokenByQuery={},this.upsertConversation=(0,i.el)(this.set,"byId","conversationId"),this.appendConversations=(0,i.BC)(this.set,"byId","conversationId"),this.removeConversation=(0,i.TF)(this.set,"byId"),this.setById=(0,i.kp)(this.set,"byId"),this.idsertConversationPromise=(0,i.q5)(this.set,"promiseById"),this.removeConversationPromise=(0,i.TF)(this.set,"promiseById"),this.setPromiseById=(0,i.kp)(this.set,"promiseById"),this.idsertAbortControllerById=(0,i.q5)(this.set,"abortControllerById"),this.removeAbortControllerById=(0,i.TF)(this.set,"abortControllerById"),this.setListPromiseByQuery=(0,i.kp)(this.set,"listPromiseByQuery"),this.idsertListPromiseByQuery=(0,i.q5)(this.set,"listPromiseByQuery"),this.idsertNextPageTokenByQuery=(0,i.q5)(this.set,"nextPageTokenByQuery"),this.upsertAndCacheConversation=(e,t)=>{let s=this.get();t&&t in s.byId&&t!==e.conversationId&&(s.removeConversation(t),s.removeConversationPromise(t)),s.upsertConversation(e),s.idsertConversationPromise(Promise.resolve(e),e.conversationId)},this.appendAndCacheConversations=e=>{let t=l.A(d.A("conversationId"),e),s=c.A(e=>Promise.resolve(e),t),{byId:o,promiseById:n}=this.get();this.set({byId:{...o,...t},promiseById:{...n,...s}})},this.fetchCreateConversation=e=>{var t;let s=this.get(),i=v.A3.getState(),a=r.chatApi.chatCreateConversation({body:e}).then(e=>({...e,personaId:(0,o._c)(e.systemPromptName),isNew:!0,state:"closed"})),l=null==(t=e.addResponseRequest)?void 0:t.conversationId;return l&&(s.idsertConversationPromise(a,l),i.nodesByConversationId[l]=[]),a.then(e=>{s.upsertConversation(e),s.idsertConversationPromise(a,e.conversationId),i.nodesByConversationId[e.conversationId]=[]}).catch((0,n.HX)("fetchCreateConversation")),a},this.fetchUpdateConversation=(e,t)=>{let s=this.get(),o=r.chatApi.chatUpdateConversation({conversationId:e,body:t}).then(t=>({...s.byId[t.conversationId]||{conversationId:e,isNew:!1,state:"closed"},...t})).then(u.A(s.upsertConversation)),i={...s.byId[e]||{conversationId:e,isNew:!1,state:"closed"},...t};return s.upsertConversation(i),s.idsertConversationPromise(Promise.resolve(i),e),o.then(()=>s.idsertConversationPromise(o,e)).catch((0,n.HX)("fetchUpdateConversation")),o},this.fetchDeleteConversation=e=>{let t=this.get(),s=r.chatApi.chatDeleteConversation({conversationId:e});return t.removeConversation(e),t.removeConversationPromise(e),t.setListPromiseByQuery(c.A(t=>t.then(t=>t.filter(t=>t.conversation.conversationId!==e)),t.listPromiseByQuery)),s},this.fetchSoftDeleteConversation=e=>{let t=this.get(),s=r.chatApi.chatSoftDeleteConversation({conversationId:e});return t.removeConversation(e),t.removeConversationPromise(e),s},this.fetchGetConversation=e=>{let t=this.get();if(e in t.promiseById)return t.promiseById[e];let s=r.chatApi.chatGetConversation({conversationId:e,includeWorkspaces:!0,includeTaskResult:!0}).then(f);return t.set(m.A(h.A(["promiseById",e]),s)),s.then(t.upsertConversation).catch(console.error),s},this.fetchGetManyConversations=e=>{let t=this.get(),s={},o=[];if(e.forEach(e=>{e in t.promiseById?s[e]=t.promiseById[e]:o.push(e)}),0===o.length)return Promise.all(Object.values(s));let n=o.length>0?r.chatApi.chatGetConversations({conversationIds:o,includeWorkspaces:!0,includeTaskResult:!0}).then(e=>{let{conversations:t}=e;return t||[]}).then(I):Promise.resolve([]);return n.then(e=>{e.forEach(e=>{let s=Promise.resolve(e);t.idsertConversationPromise(s,e.conversationId)}),t.appendConversations(e)}).catch(console.error),Promise.all([...Object.values(s),n.then(e=>e||[])]).then(e=>e.flat())},this.fetchListConversations=(e,t)=>{let s=this.get(),o=JSON.stringify(function e(t){if(null===t||"object"!=typeof t)return t;if(Array.isArray(t))return t.map(e);let s=Object.keys(t).sort(),o={};for(let n of s)o[n]=e(t[n]);return o}(p.A(e=>!!e,e||{})),null,void 0);if(!t&&o in s.listPromiseByQuery)return s.listPromiseByQuery[o];let n=t?s.nextPageTokenByQuery[o]:void 0,i=r.chatApi.chatListConversations({pageSize:"60",pageToken:n,...e}).then(e=>{let{conversations:t,textSearchMatches:n,nextPageToken:i}=e;return(i&&s.idsertNextPageTokenByQuery(i,o),null==n?void 0:n.length)?n.map(e=>{if(e.conversation)return{...e,conversation:f(e.conversation)}}):(null==t?void 0:t.length)?t.map(e=>({conversation:f(e)})):[]}).then(e=>e.filter(e=>!!e)).then(u.A(e=>{s.appendConversations(e.map(e=>e.conversation)),s.setPromiseById(c.A(e=>Promise.resolve(e.conversation),l.A(e=>e.conversation.conversationId,e)))}));if(t){let e=s.listPromiseByQuery[o];if(e)return Promise.all([e,i]).then(g.A);s.idsertListPromiseByQuery(i,o)}else s.idsertListPromiseByQuery(i,o);return i},this.fetchSoftDeleteAllConversations=()=>(this.setById({}),this.setPromiseById({}),r.chatApi.chatSoftDeleteAllConversations())}}let w=(0,i.y$)(y,"useConversationStore");function b(e){let t=new Date().toISOString();return{title:"New conversation",createTime:t,modifyTime:t,starred:!1,temporary:!1,isNew:!0,state:"optimistic",mediaTypes:[],workspaces:[],taskResult:{},...e}}(0,i.lB)(w,"byId","list",Object.values)},56096:(e,t,s)=>{s.d(t,{x:()=>i});var o=s(65258);class n{constructor(e,t){this.set=e,this.get=t}}let i=(0,o.y$)(n,"useSubscriptionsStore")},56691:(e,t,s)=>{s.d(t,{$n:()=>c,gx:()=>u,ru:()=>d});var o=s(79342),n=s(7287),i=s(17338),r=s(88382),a=s(61312),l=s(61884);let d=(0,i.F)(["inline-flex items-center justify-center gap-2 whitespace-nowrap text-sm font-medium leading-[normal] cursor-pointer","focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:opacity-60 disabled:cursor-not-allowed","transition-colors duration-100","[&_svg]:shrink-0","select-none"],{variants:{variant:{filled:"bg-button-filled text-fg-invert hover:bg-button-filled-hover disabled:hover:bg-button-filled",filledSecondary:"bg-surface-l2 text-fg-primary hover:bg-surface-l4-hover dark:hover:bg-surface-l3 border border-border-l1 disabled:hover:bg-surface-l2 dark:disabled:hover:bg-surface-l2",outline:"border border-border-l2 text-fg-primary hover:bg-button-ghost-hover [&_svg]:hover:text-fg-primary disabled:hover:bg-transparent",ghost:"text-fg-primary hover:bg-button-ghost-hover disabled:hover:bg-transparent border border-transparent",ghostSecondary:"text-fg-secondary hover:text-fg-primary hover:bg-button-ghost-hover disabled:hover:text-fg-secondary disabled:hover:bg-transparent [&_svg]:hover:text-fg-primary",text:"text-fg-primary bg-transparent hover:text-fg-secondary disabled:hover:text-fg-primary",textSecondary:"text-secondary bg-transparent hover:text-primary disabled:hover:text-fg-secondary",sticky:"text-fg-secondary hover:text-fg-primary disabled:hover:text-fg-secondary bg-surface-l1 dark:bg-surface-l2 dark:hover:bg-surface-l3 hover:bg-surface-l4-hover disabled:hover:bg-surface-l1 dark:disabled:hover:bg-surface-l2",none:"",primary:"bg-button-primary text-background hover:bg-button-primary-hover",secondary:"bg-button-secondary text-primary hover:bg-button-secondary-hover",accent:"bg-sunset/90 text-ivory hover:bg-sunset",card:"ring-1 ring-inset ring-toggle-border bg-card hover:bg-card-hover text-primary",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",link:"text-primary underline-offset-4 hover:underline"},size:{xs:"h-6 rounded-lg px-3 text-xs",sm:"h-8 rounded-xl px-3 text-xs",md:"h-10 rounded-xl px-3.5 py-2 text-sm",lg:"h-12 rounded-2xl px-5",iconXs:"h-6 w-6 rounded-lg",iconSm:"h-8 w-8 rounded-lg",iconMd:"h-10 w-10 rounded-xl",iconLg:"h-12 w-12 rounded-2xl",none:"",iconXl:"h-10 w-10 rounded-full",pill:"h-9 rounded-full px-3.5 py-2",nav:"h-8 rounded-xl px-3.5 text-sm font-medium",icon:"h-10 w-10 rounded-xl",default:"h-9 px-4 py-2 rounded-lg",noPadding:"h-9 rounded-lg"},rounded:{true:"rounded-full",false:null},btnColor:{default:null,danger:null},overideIconStyle:{true:"[&_svg]:text-inherit [&_svg]:hover:text-inherit",false:null}},compoundVariants:[{variant:"filled",btnColor:"danger",className:"text-white bg-red-500 hover:bg-red-400 disabled:hover:bg-red-500"},{variant:"filledSecondary",btnColor:"danger",className:"text-red-400 dark:text-red-300 hover:text-red-500 dark:text-red-200"},{variant:["outline","ghost","ghostSecondary","text"],btnColor:"danger",className:"text-red-400 dark:text-red-300 hover:text-red-500 dark:text-red-200 hover:bg-red-400/10"}],defaultVariants:{variant:"none",size:"md",rounded:!1,btnColor:"default"}}),c=r.forwardRef((e,t)=>{let{className:s,variant:i,size:r,btnColor:l="default",rounded:c=!1,asChild:u=!1,overideIconStyle:m=!1,...h}=e,p=u?n.DX:"button";return(0,o.jsx)(p,{className:(0,a.cn)(d({variant:i,size:r,rounded:c,btnColor:l,overideIconStyle:m,className:s})),ref:t,type:"button",...h})});c.displayName="Button";let u=r.forwardRef((e,t)=>{let{className:s,variant:i,size:r,btnColor:c="default",rounded:u=!1,asChild:m=!1,overideIconStyle:h=!1,tooltipProps:p={},tooltipContent:g,tooltipContentProps:v={},tooltipAsChild:f,stayOpenOnClick:I=!1,...y}=e,w=m?n.DX:"button",b=y["aria-label"];return void 0===b&&"string"==typeof g&&(b=g),(0,o.jsxs)(l.m_,{delayDuration:100,...p,children:[(0,o.jsx)(l.k$,{asChild:!0,onClick:I?e=>e.preventDefault():void 0,children:(0,o.jsx)(w,{className:(0,a.cn)(d({variant:i,size:r,rounded:u,btnColor:c,overideIconStyle:h,className:s})),ref:t,type:"button","aria-label":b,...y})}),g?(0,o.jsx)(l.ZI,{onPointerDownOutside:I?e=>e.preventDefault():void 0,...v,children:g}):null]})});u.displayName="ButtonWithTooltip"},58192:(e,t,s)=>{s.d(t,{E8:()=>r,Sk:()=>o,Wl:()=>i,fG:()=>a,oQ:()=>n});let o="grok-3",n="Grok 3",i="Grok 3",r="grok-3",a="Grok 2"},61312:(e,t,s)=>{s.d(t,{cn:()=>i});var o=s(40409),n=s(19967);function i(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,n.QP)((0,o.$)(t))}},61884:(e,t,s)=>{s.d(t,{Bc:()=>a,Gv:()=>u,ZI:()=>c,k$:()=>d,m_:()=>l});var o=s(79342),n=s(40251),i=s(88382),r=s(61312);let a=n.Kq,l=n.bL,d=n.l9,c=i.forwardRef((e,t)=>{let{className:s,sideOffset:i=4,disableAnimation:a,container:l,...d}=e;return(0,o.jsx)(n.ZL,{container:l,children:(0,o.jsx)(n.UC,{ref:t,collisionPadding:{top:16,right:16,bottom:16,left:16},sideOffset:i,className:(0,r.cn)("z-50 overflow-hidden rounded-md bg-popover shadow-sm dark:shadow-none px-3 py-1.5","text-xs text-popover-foreground pointer-events-none","max-w-80 text-wrap",a?"":(0,r.cn)("animate-in fade-in-0 zoom-in-95","data-[state=closed]:animate-out","data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95","data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2","data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2"),s),...d})})});c.displayName=n.UC.displayName;let u=(0,r.cn)("z-50 overflow-hidden rounded-2xl bg-primary text-primary-foreground","shadow-sm dark:shadow-none text-xs animate-in fade-in-0 zoom-in-95","data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95","data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 p-3");c.displayName=n.UC.displayName},65258:(e,t,s)=>{s.d(t,{BC:()=>w,CP:()=>S,L$:()=>p,MQ:()=>x,TF:()=>g,WQ:()=>m,_q:()=>_,dX:()=>h,el:()=>v,gN:()=>I,kp:()=>u,lB:()=>b,oQ:()=>y,ok:()=>T,q5:()=>f,y$:()=>C});var o=s(85431),n=s(3275),i=s(74995),r=s(53915),a=s(46815),l=s(4890),d=s(17823),c=s(76328);function u(e,t){return s=>{e(e=>({...e,[t]:s}),void 0,"assign:".concat(R(arguments)))}}function m(e,t){return s=>{e(e=>({...e,[t]:[...e[t]||[],s]}),void 0,"add:".concat(R(arguments)))}}function h(e,t,s){return()=>{e(e=>({...e,[t]:s}),void 0,"presign:".concat(R(arguments)))}}function p(e,t){return()=>{e(e=>({...e,[t]:!e[t]}),void 0,"toggle:".concat(R(arguments)))}}function g(e,t){return s=>{e(e=>({...e,[t]:o.A([s],e[t])}),void 0,"remove:".concat(R(arguments)))}}function v(e,t,s){return o=>{e(e=>({...e,[t]:{...e[t],...n.A(i.A(s),[o])}}),void 0,"upsert:".concat(R(arguments)))}}function f(e,t){return(s,o)=>{e(e=>({...e,[t]:{...e[t],[o]:s}}),void 0,"idsert:".concat(R(arguments)))}}function I(e,t){return(s,o)=>{e(e=>({...e,[t]:{...e[t],[o]:[...e[t][o]||[],s]}}),void 0,"lisert:".concat(R(arguments)))}}function y(e,t,s){return(o,n)=>{let i=!1;return e(e=>{var r;return{...e,[t]:{...e[t],[o]:null==(r=e[t][o])?void 0:r.filter(e=>{let t=e[s]!==n;return t||(i=!0),t})}}},void 0,"delist:".concat(R(arguments))),i}}function w(e,t,s){return o=>{e(e=>({...e,[t]:{...e[t],...n.A(i.A(s),o)}}),void 0,"append:".concat(R(arguments)))}}function b(e,t,s,o){let{subscribe:n,setState:l}=e;return n(i.A(t),(e,t)=>{l(r.A(a.A(s),o(e,t)))},{fireImmediately:!0})}function S(e,t,s,o,n){let{subscribe:l,setState:d}=e;try{let e=localStorage.getItem(s);if(null!=e){let s=JSON.parse(e);if(n){let e=n(s);d(r.A(a.A(t),e))}else d(r.A(a.A(t),s))}}catch(e){localStorage.setItem(s,JSON.stringify(o))}l(i.A(t),e=>{localStorage.setItem(s,JSON.stringify(e))})}function C(e,t){return(0,l.v)()((0,d.lt)((0,d.eh)((t,s)=>new e(t,s)),{name:t,store:t}))}function x(e,t){return(0,l.v)()((0,d.lt)((0,d.eh)((0,c.D)((t,s)=>({...new e(t,s)}))),{name:t,store:t}))}function R(e){return String([...e].slice(1))}function T(e){return{data:e,status:"success",error:null}}function _(e){return{data:null,status:"error",error:e instanceof Error?e:Error("unknown error")}}},68332:(e,t,s)=>{s.d(t,{o:()=>h});var o=s(97325),n=s(41739),i=s(17703),r=s(84499),a=s(49972),l=s(39116),d=s(12110),c=s(88382);let u=[new d.w("/chat/:chatId"),new d.w("/chat"),new d.w("/")],m=new d.w("/share/:shareLinkId");function h(){let e=(0,l.useRouter)(),t=(0,l.usePathname)(),{push:s}=(0,r.wK)(),d=(0,c.useMemo)(()=>!!t&&u.some(e=>e.test(t)),[t]),h=(0,c.useMemo)(()=>!!t&&m.test(t),[t]),p=(0,c.useMemo)(()=>{if(h){var e;return{shareLinkId:null==(e=m.test(t))?void 0:e.shareLinkId}}},[h,t]),g=(0,c.useCallback)((t,r,l)=>{let c=o.aP.getState();c.setConversationId(t),c.setSidePanelContent(void 0);let{fetchGetConversation:u,byId:m}=a.w.getState();if(t&&l){let e=n.a.getState();u(t).then(e.upsertConversationAsTab).catch((0,i.HX)("use-chat-router:routeToConversation:addToTabs"))}if(!r)if(t){var h,p;let o=null!=(p=null==(h=m[t])?void 0:h.temporary)&&p;s({page:"chat",conversationId:t,temporary:o}),d||e.push("/chat/".concat(t))}else s({page:"main"})},[d,s,e]);return{isChatPage:d,isSharePage:h,pageData:p,routeToConversation:g,signInWithReturnTo:(0,c.useCallback)((s,o)=>{let n=new URLSearchParams({q:s||"",reasoningMode:o||"none"}).toString(),i=n?"".concat(t,"?").concat(n):t,r=i?new URLSearchParams({return_to:i}).toString():void 0;e.push("/sign-in".concat(r?"?".concat(r):""))},[e,t])}}},69648:(e,t,s)=>{s.d(t,{w:()=>a});var o=s(79342),n=s(90808),i=s(88382),r=s(61312);let a=i.forwardRef((e,t)=>{let{className:s,orientation:i="horizontal",decorative:a=!0,...l}=e;return(0,o.jsx)(n.b,{ref:t,decorative:a,orientation:i,className:(0,r.cn)("shrink-0 bg-border","horizontal"===i?"h-[1px] w-full":"h-full w-[1px]",s),...l})});a.displayName=n.b.displayName},70888:(e,t,s)=>{s.d(t,{x:()=>c});var o=s(17703),n=s(65258),i=s(64389),r=s(14908),a=s(86530).hp;let l={listByConversationId:{},fileMetaPromiseById:{},fileMetaById:{},attachListByConversationId:{}};class d{constructor(e,t){this.set=e,this.get=t,this.listByConversationId=l.listByConversationId,this.fileMetaPromiseById=l.fileMetaPromiseById,this.fileMetaById=l.fileMetaById,this.attachListByConversationId=l.attachListByConversationId,this.lisertByConversationId=(0,n.gN)(this.set,"listByConversationId"),this.removeByConversationId=(0,n.TF)(this.set,"listByConversationId"),this.delistByConversationId=(0,n.oQ)(this.set,"listByConversationId","file"),this.upsertFileMetadata=(0,n.el)(this.set,"fileMetaById","fileMetadataId"),this.idsertFileMetadataPromise=(0,n.q5)(this.set,"fileMetaPromiseById"),this.lisertAttachByConversationId=(0,n.gN)(this.set,"attachListByConversationId"),this.removeAttachByConversationId=(0,n.TF)(this.set,"attachListByConversationId"),this.delistAttachByConversationId=(0,n.oQ)(this.set,"attachListByConversationId","assetId"),this.fetchUploadFile=(e,t)=>{let s=this.get(),n=e.arrayBuffer().then(t=>i.chatApi.chatUploadFile({body:{fileName:e.name,fileMimeType:e.type,content:a.from(t).toString("base64")}}).then(e=>e).catch(e=>{if(e.message.includes("OUT_OF_RANGE"))throw Error("File was too large.");throw e})),r={file:e,metadataPromise:n};return s.lisertByConversationId(r,t),n.then(o=>{s.delistByConversationId(t,e)&&s.lisertByConversationId({...r,metadata:o},t)}).catch(n=>{s.delistByConversationId(t,e)&&(s.lisertByConversationId({...r,metadata:n},t),(0,o.vV)("fetchUploadFile",n))}),r},this.fetchFileMetadata=e=>{let t=this.get();if(e in t.fileMetaById)return Promise.resolve(t.fileMetaById[e]);if(e in t.fileMetaPromiseById)return t.fileMetaPromiseById[e];let s=i.chatApi.chatGetFileMetadata({fileMetadataId:e}).then(e=>e);return t.idsertFileMetadataPromise(s,e),s.then(t.upsertFileMetadata),s},this.fetchAttachThirdPartyFile=(e,t,s,n,a)=>{let l=this.get(),d=i.chatApi.chatUploadFile({body:{fileName:e,fileMimeType:t,fileSource:s,thirdPartyFileId:n}}).then(e=>e).catch(e=>{if(e.message.includes("OUT_OF_RANGE"))throw Error("File was too large.");throw e}),c=new File([n],e),u={file:c,metadataPromise:d};return l.lisertByConversationId(u,a),d.then(e=>{l.delistByConversationId(a,c)&&l.lisertByConversationId({...u,metadata:e},a)}).catch(e=>{l.delistByConversationId(a,c)&&(l.lisertByConversationId({...u,metadata:e},a),(0,o.vV)("fetchAttachThirdPartyFile",e)),e.message&&r.oR.error(e.message)}),u}}}let c=(0,n.y$)(d,"useFileStore")},83626:(e,t,s)=>{function o(e){let t=!1;return()=>{t||(e(),t=!0)}}function n(e,t){if(void 0!==e)return t(e)}s.d(t,{F:()=>n,S:()=>o})},84499:(e,t,s)=>{s.d(t,{KQ:()=>B,N_:()=>_,wK:()=>k});var o=s(79342),n=s(97325),i=s(61884),r=s(17703),a=s(44347),l=s(39116),d=s(12110),c=s(88382),u=s(61657);let m=["conversations","attachments"],h=["name","size","used","created"],p="used",g=["image","document","spreadsheet","code","pdf"],v=["user","grok"],f=new d.w("/files"),I=new d.w("/workspace"),y=new d.w("/workspace/:id"),w=new d.w("/project"),b=new d.w("/project/:id"),S=new d.w("/chat/:id"),C=new d.w("/chat"),x=new d.w("/images"),R=new d.w("/tasks");function T(e,t){switch(e.page===t.page&&(e=function(e){let t={...e};for(let e of Object.keys(t))void 0===t[e]&&delete t[e];return t}(e),e={...t,...e}),e.page){case"main":case"unknown":return{pathname:"/"};case"files":return{pathname:"/files",query:{file:e.fileId||void 0,emptyView:"default"===e.emptyView?void 0:e.emptyView,search:e.search||void 0,sort:e.sort===p?void 0:e.sort,fileType:e.fileType,createdBy:e.createdBy}};case"workspaces":return{pathname:"/project"};case"workspace":return{pathname:"/project/"+e.workspaceId,query:{tab:"attachments"!==e.tab?e.tab:void 0}};case"chat":if(e.temporary)return{pathname:"/chat"};if(!e.conversationId)return{pathname:"/"};return{pathname:"/chat/"+e.conversationId};case"images":return{pathname:"/images".concat(e.tab?"/".concat(e.tab):"")};case"tasks":return{pathname:"/tasks",query:{task:e.taskId||void 0,tab:e.tab||void 0}};case"plans":return{pathname:"/plans"};default:let s=e;return(0,r.vV)("routeToUrlObject","Unhandled route case:"+s),{}}}let _=(0,c.forwardRef)((e,t)=>{let{route:s,onClick:r,tooltip:d,tooltipContentProps:u,showTooltip:m=!0,...h}=e,{route:p}=k(),g=(0,c.useMemo)(()=>P(T(s,p)),[JSON.stringify(s),JSON.stringify(p)]),v=(0,l.useRouter)(),{route:f}=k(),I=(0,c.useCallback)(e=>{var t;if(null==r||r(e),!function(e){let t=e.currentTarget.getAttribute("target");return t&&"_self"!==t||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey||2===e.button}(e)&&(e.preventDefault(),null==(t=globalThis)||t.window.history.pushState({},"",g),("unknown"===f.page||"unknown"===s.page)&&v.push(g),"main"===s.page)){let{setIsIncognito:e}=a.C$.getState();if(e(!1),"chat"===p.page){let{setOptimisticConversationId:e,setConversationId:t,setSidePanelContent:s}=n.aP.getState();e(void 0),t(void 0),s(void 0)}}},[f.page,v,r,s.page,g,p.page]);return d?(0,o.jsxs)(i.m_,{children:[(0,o.jsx)(i.k$,{asChild:!0,children:(0,o.jsx)("a",{...h,onClick:I,href:g,ref:t})}),m&&(0,o.jsx)(i.ZI,{...u,children:d})]}):(0,o.jsx)("a",{...h,onClick:I,href:g,ref:t})});function k(){let e=(0,l.usePathname)(),t=(0,l.useSearchParams)(),s=(0,c.useMemo)(()=>(function(e,t){var s,o,n,i,r;if("/"===e)return{page:"main"};if(f.test(e))return{page:"files",fileId:t.get("file")||null,emptyView:"image"===t.get("emptyView")?"image":"default",search:t.get("search")||void 0,sort:null!=(s=M(h,t.get("sort")))?s:p,fileType:M(g,t.get("fileType")),createdBy:M(v,t.get("createdBy"))};if(I.test(e)||w.test(e))return{page:"workspaces"};let a=y.test(e);if(null==a?void 0:a.id){let e=null!=(o=t.get("tab"))?o:"";return{page:"workspace",workspaceId:a.id,tab:null!=(n=M(m,e))?n:"attachments"}}let l=b.test(e);if(null==l?void 0:l.id){let e=null!=(i=t.get("tab"))?i:"";return{page:"workspace",workspaceId:l.id,tab:null!=(r=M(m,e))?r:"attachments"}}let d=S.test(e);return(null==d?void 0:d.id)?{page:"chat",conversationId:d.id,temporary:!1}:C.test(e)?{page:"chat",conversationId:null,temporary:!0}:x.test(e)?{page:"images"}:R.test(e)?{page:"tasks",taskId:t.get("task"),tab:t.get("tab")}:{page:"unknown"}})(e,t),[e,t.toString()]),o=(0,c.useCallback)(e=>{var t;let o=P(T(e,s));null==(t=globalThis)||t.window.history.pushState({},"",o)},[s]),n=(0,c.useCallback)(e=>{var t;let o=P(T(e,s));null==(t=globalThis)||t.window.history.replaceState({},"",o)},[s]);return(0,c.useMemo)(()=>({push:o,replace:n,route:s}),[o,n,s])}function M(e,t,s){return e.includes(t)?t:s}function P(e){if(e.query&&"string"!=typeof e.query)for(let t in e.query)void 0===e.query[t]&&delete e.query[t];return(0,u.format)(e)}function B(e,t){let s=P(T(e,e));return"".concat(t).concat(s)}},97325:(e,t,s)=>{s.d(t,{aP:()=>D});var o=s(23835),n=s(58192),i=s(44845),r=s(83626),a=s(17703),l=s(33960),d=s(35021),c=s(65258),u=s(64389),m=s(49972),h=s(36936),p=s(29938),g=s(43893),v=s(44347),f=s(13511),I=s(99452),y=s.n(I),w=s(83318),b=s(38541),S=s.n(b),C=s(12110),x=s(14908),R=s(27853),T=s(6132),_=s(4890),k=s(17823),M=s(79342);let P=[1];var B=s(98100),E=s(17014),N=s(88382),A=s(65146);let z=e=>{let{modelName:t,reasoningMode:s,waitTimeSeconds:o}=e,{t:n}=(0,A.Bd)("chat"),{modelById:i}=(0,B.GB)(),r=(0,N.useMemo)(()=>{var e;return(null==(e=i[t])?void 0:e.name)||t},[i,t]),a=(0,N.useMemo)(()=>{let e=Math.floor(o/3600),t=Math.floor(o%3600/60);return e>0&&t>0?"".concat(n("time.hours",{defaultValue_one:"{{count}} hour",defaultValue_other:"{{count}} hours",count:e})," ").concat(n("time.minutes",{count:t,defaultValue_one:"{{count}} minutes",defaultValue_other:"{{count}} minutes"})):e>0?n("time.hours",{defaultValue_one:"{{count}} hour",defaultValue_other:"{{count}} hours",count:e}):n("time.minutes",{count:t,defaultValue_one:"{{count}} minutes",defaultValue_other:"{{count}} minutes"})},[o,n]),l=(0,N.useMemo)(()=>"DEEPSEARCH"===s?n("Rate Limit Reached.description-deepsearch","Query limit reached for {{modelName}} with DeepSearch. Limit refreshes in {{time}}.",{modelName:r,time:a}):"DEEPERSEARCH"===s?n("Rate Limit Reached.description-deepersearch","Query limit reached for {{modelName}} with DeeperSearch. Limit refreshes in {{time}}.",{modelName:r,time:a}):"REASONING"===s?n("Rate Limit Reached.description-reasoning","Query limit reached for {{modelName}} with Think. Limit refreshes in {{time}}.",{modelName:r,time:a}):n("Rate Limit Reached.description","Query limit reached for {{modelName}}. Limit refreshes in {{time}}.",{modelName:r,time:a}),[a,r,n,s]);return(0,M.jsxs)("div",{className:"flex items-center gap-2",children:[(0,M.jsx)(E.id,{className:"size-5"}),(0,M.jsx)("div",{className:"font-semibold text-xs",children:l})]})},L=e=>{let{modelName:t,reasoningMode:s,remainingQueries:o,windowSizeSeconds:n}=e,{t:i}=(0,A.Bd)("chat"),{modelById:r}=(0,B.GB)(),a=(0,N.useMemo)(()=>{var e;return(null==(e=r[t])?void 0:e.name)||t},[r,t]),l=(0,N.useMemo)(()=>{let e=Math.floor(n/3600),t=Math.floor(n%3600/60);return e>0&&t>0?"".concat(i("time.hours",{defaultValue_one:"{{count}} hour",defaultValue_other:"{{count}} hours",count:e})," ").concat(i("time.minutes",{count:t,defaultValue_one:"{{count}} minutes",defaultValue_other:"{{count}} minutes"})):e>0?i("time.hours",{defaultValue_one:"{{count}} hour",defaultValue_other:"{{count}} hours",count:e}):i("time.minutes",{count:t,defaultValue_one:"{{count}} minutes",defaultValue_other:"{{count}} minutes"})},[n,i]),d=(0,N.useMemo)(()=>"DEEPSEARCH"===s?i("Remaining Queries.description-deepsearch",{modelName:a,count:o,time:l,defaultValue_one:"One query left for {{modelName}} with DeepSearch. Limit resets every {{time}}.",defaultValue_other:"You have {{count}} remaining queries for {{modelName}} with DeepSearch. Limit resets every {{time}}."}):"DEEPERSEARCH"===s?i("Remaining Queries.description-deepersearch",{modelName:a,count:o,time:l,defaultValue_one:"One query left for {{modelName}} with DeeperSearch. Limit resets every {{time}}.",defaultValue_other:"You have {{count}} remaining queries for {{modelName}} with DeeperSearch. Limit resets every {{time}}."}):"REASONING"===s?i("Remaining Queries.description-reasoning",{modelName:a,count:o,time:l,defaultValue_one:"One query left for {{modelName}} with Think. Limit resets every {{time}}.",defaultValue_other:"You have {{count}} remaining queries for {{modelName}} with Think. Limit resets every {{time}}."}):i("Remaining Queries.description",{modelName:a,count:o,time:l,defaultValue_one:"One query left for {{modelName}}. Limit resets every {{time}}.",defaultValue_other:"You have {{count}} remaining queries for {{modelName}}. Limit resets every {{time}}."}),[o,a,l,i,s]);return(0,M.jsxs)("div",{className:"flex items-center gap-2",children:[(0,M.jsx)(E.id,{className:"size-5"}),(0,M.jsx)("div",{className:"text-xs font-semibold",children:d})]})};function U(e){u.tW.rateLimitsGetRateLimits({body:e}).then(t=>{void 0!==t.remainingQueries&&P.includes(t.remainingQueries)?x.oR.info((0,M.jsx)(L,{reasoningMode:e.requestKind,modelName:e.modelName,remainingQueries:t.remainingQueries,windowSizeSeconds:t.windowSizeSeconds||0}),{duration:7e3}):0===t.remainingQueries&&t.waitTimeSeconds&&x.oR.info((0,M.jsx)(z,{reasoningMode:e.requestKind,modelName:e.modelName,waitTimeSeconds:t.waitTimeSeconds}),{duration:7e3})}).catch(e=>{(0,a.vV)("chat-page-store:checkRateLimits",e)})}function j(e,t){let s=function(e,t){let s=e.trim().replace(/^[^a-zA-Z0-9]+|[^a-zA-Z0-9]+$/g,"");return s.length>200?s.slice(0,200)+"...":s}(e,200);x.oR.info(s,{duration:7e3}),(0,d.$s)("show_disclaimer",s,{conversationId:t})}T.z.union([T.z.literal("auto"),T.z.literal("image"),T.z.literal("search"),T.z.literal("modelOnly"),T.z.literal("noSearch")]),T.z.union([T.z.literal("chat"),T.z.literal("voice")]);class V{constructor(e,t){this.set=e,this.get=t,this.activeModelId=n.Sk,this.isRateLimited=!1,this.isThinkingRateLimited=!1,this.isDeepSearchRateLimited=!1,this.isUnauthenticated=!1,this.hasDismissedDisclaimer=!1,this.conversationMode="chat",this.outputMode="auto",this.reasoningMode="none",this.usingExperiment=!1,this.experiments=[],this.streamingExperimentsIds=[],this.queryBarExpanded=!1,this.isTypingDebounce=!1,this.metadata={},this.selectedPersonalityId=void 0,this.customPersonality=void 0,this.queryByConversationId={},this.chatPageLoaded=!1,this.isDeeperSearchSelected=!1,this.livekitRoom=null,this.livekitToken=null,this.voiceConnectionStatus="disconnected",this.voiceId="Ara",this.voicePersonalityId=null,this.voiceCustomInstructions=null,this.voiceEnableSearch=!0,this.voiceModeTimeoutId=null,this.setConversationId=(0,c.kp)(this.set,"conversationId"),this.setOptimisticConversationId=(0,c.kp)(this.set,"optimisticConversationId"),this.setLastMessageId=(0,c.kp)(this.set,"lastMessageId"),this.setSidePanelContent=(0,c.kp)(this.set,"sidePanelContent"),this.toggleSidePanelContent=e=>{let t=this.get().sidePanelContent;(null==t?void 0:t.type)===e.type&&t.data===e.data?this.setSidePanelContent(void 0):this.setSidePanelContent(e)},this.setStreamedMessageId=(0,c.kp)(this.set,"streamedMessageId"),this.setActiveModelId=(0,c.kp)(this.set,"activeModelId"),this.setSelectedSystemPromptId=(0,c.kp)(this.set,"selectedSystemPromptId"),this.setIsRateLimited=(0,c.kp)(this.set,"isRateLimited"),this.setIsUnauthenticated=(0,c.kp)(this.set,"isUnauthenticated"),this.setHasDismissedDisclaimer=(0,c.kp)(this.set,"hasDismissedDisclaimer"),this.setOptimisticMessageId=(0,c.kp)(this.set,"optimisticMessageId"),this.setConversationMode=(0,c.kp)(this.set,"conversationMode"),this.setOutputMode=(0,c.kp)(this.set,"outputMode"),this.setReasoningMode=(0,c.kp)(this.set,"reasoningMode"),this.setChatPageLoaded=(0,c.kp)(this.set,"chatPageLoaded"),this.setDefaultAnonModelId=(0,c.kp)(this.set,"defaultAnonModelId"),this.setDefaultFreeModelId=(0,c.kp)(this.set,"defaultFreeModelId"),this.setDefaultProModelId=(0,c.kp)(this.set,"defaultProModelId"),this.setMetadata=(0,c.kp)(this.set,"metadata"),this.setUsingExperiment=e=>{this.removeAllExperiments(),this.removeAllStreamingExperiments(),this.set(t=>({...t,usingExperiment:e}))},this.removeAllExperiments=(0,c.dX)(this.set,"experiments",[]),this.setExperiments=(0,c.kp)(this.set,"experiments"),this.addExperiment=(0,c.WQ)(this.set,"experiments"),this.removeExperiment=e=>{this.set(t=>{let s=[...t.experiments];return s.splice(e,1),{...t,experiments:s}})},this.setStreamingExperimentsIds=(0,c.kp)(this.set,"streamingExperimentsIds"),this.addStreamingExperimentId=(0,c.WQ)(this.set,"streamingExperimentsIds"),this.removeAllStreamingExperiments=(0,c.dX)(this.set,"streamingExperimentsIds",[]),this.setSelectedPersonalityId=(0,c.kp)(this.set,"selectedPersonalityId"),this.setCustomPersonality=(0,c.kp)(this.set,"customPersonality"),this.idsetQueryByConversationId=(0,c.q5)(this.set,"queryByConversationId"),this.setQueryBarExpanded=e=>this.set({queryBarExpanded:e}),this.setIsTypingDebounce=e=>this.set({isTypingDebounce:e}),this.setIsDeeperSearchSelected=(0,c.kp)(this.set,"isDeeperSearchSelected"),this.setLivekitRoom=(0,c.kp)(this.set,"livekitRoom"),this.setLivekitToken=(0,c.kp)(this.set,"livekitToken"),this.setVoiceConnectionStatus=(0,c.kp)(this.set,"voiceConnectionStatus"),this.setVoiceId=(0,c.kp)(this.set,"voiceId"),this.setVoicePersonalityId=(0,c.kp)(this.set,"voicePersonalityId"),this.setVoiceCustomInstructions=(0,c.kp)(this.set,"voiceCustomInstructions"),this.setVoiceEnableSearch=(0,c.kp)(this.set,"voiceEnableSearch"),this.isErrorRetryable=e=>{let t=(0,l.G1)(e);return 429===t?(this.setIsRateLimited(!0),!1):401===t?(this.setIsUnauthenticated(!0),!1):!(t&&t>=400&&t<500||e.message.includes("Failed to respond")||e.message.includes(f.CZ)||e.message.includes(f.S3))},this.establishNewConversation=async e=>{let{temporary:t,message:s,fileAttachmentIds:o,webpageUrls:a,toolOverrides:l,isPreset:d,persona:c,enableRetries:u,disableArtifactDiff:m,imageEditUri:h,workspaceIds:f,responseMetadata:I,isFromGrokFiles:y,disableToolComposer:w=!1,disableMemory:b=!1,ff:C}=e,x=this.get(),R=g.A3.getState(),T=v.C$.getState(),_=p.jN.getState(),k=S().get(_.byId,T.userSettings.preferences.selectedSystemPromptId||""),M=x.activeModelId,P=q(void 0,x.reasoningMode,M),B=void 0,E=(null==k?void 0:k.prompt)||x.customPersonality,N=c&&M!==n.E8?"".concat(E,"\n\n").concat(c.prompt,"."):E,A=!1,z={...x.metadata,...I};return x.setMetadata({}),new Promise((e,n)=>{R.streamCreateAndRespond({temporary:t,message:s,modelName:M,fileAttachmentIds:o,webpageUrls:a,systemPromptName:null==c?void 0:c.systemPromptName,personaId:null==c?void 0:c.personaId,toolOverrides:null!=l?l:O(x.outputMode,P),isPreset:d,customInstructions:B,customPersonality:N,deepsearchPreset:(0,i.Ku)(P),isReasoning:"think"===P,imageEditUri:h,enableRetries:u,disableArtifactDiff:m,workspaceIds:f,responseMetadata:z,isFromGrokFiles:y,disableToolComposer:w,disableMemory:b,onOptimisticConversation:e=>{let{conversationId:t}=e;x.setOptimisticConversationId(t)},onOptimisticResponse:e=>{let{responseId:t}=e;x.setOptimisticMessageId(t)},onStart:e=>{var t;x.setStreamedMessageId(null==(t=e[0])?void 0:t.responseId)},onConversation:t=>{x.setConversationId(t.conversationId),x.setOptimisticConversationId(void 0),A=!0,e(t)},onUserResponse:e=>{x.setLastMessageId(e.responseId),x.setOptimisticMessageId(e.responseId)},onStartExperiment:e=>{x.setUsingExperiment(!0),e.forEach(e=>{x.addStreamingExperimentId(e),x.addExperiment({})})},onCitations:()=>{},onDisclaimer:c?()=>{}:j,onHasImage:(0,r.S)(()=>T.setShowAgeVerification(!0)),onClose:e=>{e.length>1&&(x.setExperiments(e),x.setStreamingExperimentsIds(e.map(e=>e.responseId)));let t=S().first(e);t&&this.get().lastMessageId===t.parentResponseId&&(x.setLastMessageId(t.responseId),x.setStreamedMessageId(t.responseId)),U({modelName:M,requestKind:(0,i.ot)(P)}),A?x.setOptimisticConversationId(void 0):n(Error("Not resolved by close"))},onWke:e=>{"RateLimitError"===e.name&&x.setIsRateLimited(!0),n(e)},onError:this.isErrorRetryable,ff:C}).catch(e=>{n(e)})})},this.sendResponse=async e=>{var t;let{message:s,parentResponseId:o,parentQuotedText:a,conversationId:l,fileAttachmentIds:d,webpageUrls:c,toolOverrides:u,setOpimisticUserResponse:m,setUserResponse:h,onOptimisticUserResponse:f,onError:I,imageEditUri:y,persona:w,enableRetries:b,disableArtifactDiff:C,metadata:x,followUpType:R,reasoningMode:T,isFromGrokFiles:_,resumeResponseId:k,disableToolComposer:M=!1,disableMemory:P=!1,ff:B}=e,E=this.get(),N=g.A3.getState(),A=v.C$.getState(),z=p.jN.getState(),L=S().get(z.byId,A.userSettings.preferences.selectedSystemPromptId||""),V=E.activeModelId,D=void 0,F=null!=(t=(null==L?void 0:L.prompt)||E.customPersonality)?t:"",G=w&&V!==n.E8?"".concat(F,"\n\n").concat(w.prompt,"."):F;E.setUsingExperiment(!1),E.setLastMessageId(o);let Q=q(T,E.reasoningMode,V),$={...E.metadata,...x};return E.setMetadata({}),new Promise((e,t)=>{N.streamResponse({message:s,metadata:$,parentResponseId:o,parentQuotedText:a,conversationId:l,modelName:V,systemPromptName:null==w?void 0:w.systemPromptName,fileAttachmentIds:d,webpageUrls:c,toolOverrides:{...O(E.outputMode,Q),...null!=u?u:{}},customInstructions:D,customPersonality:G,deepsearchPreset:(0,i.Ku)(Q),isReasoning:"think"===Q,imageEditUri:y,enableRetries:b,disableArtifactDiff:C,followUpType:R,isFromGrokFiles:_,resumeResponseId:k,disableToolComposer:M,disableMemory:P,onOptimisticUserResponse:e=>{m&&(E.setOptimisticMessageId(e.responseId),null==f||f(e))},onOptimisticModelResponse:e=>{E.setStreamedMessageId(e.responseId)},onStart:e=>{var t;E.setStreamedMessageId(null==(t=e[0])?void 0:t.responseId)},onUserResponse:e=>{h&&(E.setLastMessageId(e.responseId),E.setOptimisticMessageId(e.responseId))},onStartExperiment:e=>{E.setUsingExperiment(!0),e.forEach(e=>{E.addStreamingExperimentId(e),E.addExperiment({})})},onCitations:()=>{},onDisclaimer:w?()=>{}:j,onHasImage:(0,r.S)(()=>A.setShowAgeVerification(!0)),onClose:s=>{s.length>1&&(E.setExperiments(s),E.setStreamingExperimentsIds(s.map(e=>e.responseId)));let o=S().first(s);if(o&&this.get().lastMessageId===o.parentResponseId&&(E.setLastMessageId(o.responseId),E.setStreamedMessageId(o.responseId)),s.length&&s.every(e=>"closed"===e.state))e(s);else{let e=Error("Responses missing, errored, or not closed");null==I||I(e),t(e)}U({modelName:V,requestKind:(0,i.ot)(Q)})},onWke:e=>{"RateLimitError"===e.name&&E.setIsRateLimited(!0),null==I||I(e),t(e)},onError:this.isErrorRetryable,ff:B}).catch(e=>{null==I||I(e),t(e)})})},this.reconnectToInflightResponses=async(e,t)=>{let s=this.get(),o=g.A3.getState(),n=v.C$.getState(),l=s.activeModelId;try{let d=await o.fetchListInflightResponses(e);if(!d.length)return;let c=S().maxBy(d,e=>new Date(e.createTime?e.createTime:0));if(!c)return;if(!c.responseId)return void(0,a.vV)("chat-page-store:reconnectToInflightResponses","Inflight response missing response id");if(!c.parentResponseId)return void(0,a.vV)("chat-page-store:reconnectToInflightResponses","Inflight response missing parent response id:");s.setLastMessageId(c.parentResponseId),await o.reconnectToResponse({inflightResponse:c,conversationId:e,modelName:l,parentResponseId:c.parentResponseId,enableRetries:t,isReasoning:"think"===s.reasoningMode,deepsearchPreset:(0,i.Ku)(s.reasoningMode),onStart:e=>{let t=e[0];t&&s.setStreamedMessageId(t.responseId)},onCitations:()=>{},onDisclaimer:j,onHasImage:(0,r.S)(()=>n.setShowAgeVerification(!0)),onClose:(e,t)=>{e.length>1&&(s.setExperiments(e),s.setStreamingExperimentsIds(t));let o=S().first(e);o&&(s.setLastMessageId(o.responseId),s.setStreamedMessageId(void 0)),U({modelName:l,requestKind:(0,i.ot)(s.reasoningMode)})},onWke:e=>{"RateLimitError"===e.name&&s.setIsRateLimited(!0),(0,a.vV)("chat-page-store:reconnectToInflightResponses","Error reconnecting to inflight response")},onError:this.isErrorRetryable})}catch(e){(0,a.vV)("chat-page-store:reconnectToInflightResponses","Error checking inflight responses")}},this.requestLivekitToken=async(e,t)=>{let s=this.get(),n=null===o.sessionStoreState||void 0===o.sessionStoreState?void 0:o.sessionStoreState.getState();try{var i,r,l;let o=await u.hx.livekitCreateToken({body:{conversationId:t,sessionPayload:JSON.stringify({voice:s.voiceId,personality:s.voicePersonalityId,instructions:F({username:null==n||null==(i=n.user)?void 0:i.givenName,customInstructions:s.voiceCustomInstructions||void 0}),enable_search:s.voiceEnableSearch,enable_vision:(null==(l=s.livekitRoom)||null==(r=l.localParticipant)?void 0:r.isScreenShareEnabled)||!1,turn_detection:{type:"server_vad"}}),requestAgentDispatch:!1,livekitUrl:e}});if(!o.token)throw Error("No livekit token returned");return s.setLivekitToken(o.token),o.token}catch(e){throw(0,a.vV)("chat-page-store:requestLivekitToken","Failed to get livekit token"),e}},this.enterVoiceMode=async e=>{let t=this.get(),s=m.w.getState();if(this.voiceModeTimeoutId&&(clearTimeout(this.voiceModeTimeoutId),this.voiceModeTimeoutId=null),"voice"===t.conversationMode&&"disconnected"!==t.voiceConnectionStatus)throw(0,a.vV)("chat-page-store:enterVoiceMode","Already in voice mode"),Error("Already in voice mode");this.setConversationMode("voice"),this.setVoiceConnectionStatus("connecting"),(0,w.He)("silent");try{let o=await this.requestLivekitToken(e,t.conversationId),n=new w.Wv({publishDefaults:{screenShareEncoding:{maxBitrate:35e5,maxFramerate:1}}});this.setLivekitRoom(n),n.prepareConnection(e,o).catch(()=>{(0,a.vV)("chat-page-store:enterVoiceMode","Failed to prepare connection")});let i=null,r=new Promise(e=>{i=e});n.on(w.u9.Disconnected,async()=>{this.setVoiceConnectionStatus("disconnected"),await this.exitVoiceMode()}),n.on(w.u9.Reconnecting,()=>{this.setVoiceConnectionStatus("reconnecting")}),n.on(w.u9.Reconnected,()=>{this.setVoiceConnectionStatus("connected")}),n.on(w.u9.LocalTrackSubscribed,()=>{}),n.on(w.u9.ParticipantDisconnected,async()=>this.exitVoiceMode().finally(()=>{x.oR.error("Voice connection lost")})),n.on(w.u9.DataReceived,(e,o,n,r)=>{let a=new TextDecoder().decode(e);if("realtime_server_events"===r){let e=JSON.parse(a);switch(e.type){case"ping":return this.handleVoiceConnectionPing();case"conversation.created":if("connected"===this.get().voiceConnectionStatus){if(this.setVoiceConnectionStatus("ready"),!t.conversationId&&!t.optimisticConversationId){let e="optimistic_conversation_".concat(y()()),t=(0,m.b)({conversationId:e,temporary:!1});s.upsertAndCacheConversation(t),this.setOptimisticConversationId(e);let o=new AbortController;s.idsertAbortControllerById(o,e)}i&&i()}return this.handleConversationCreated(e);case"conversation.item.created":return this.handleConversationItemCreated(e);case"response.created":return this.handleAssistantVoiceResponseCreated(e);case"response.audio_transcript.delta":return this.handleAssistantVoiceResponseTranscriptDelta(e);case"response.search.result":return this.handleVoiceResponseSearchResult(e);case"response.grok.output":return this.handleVoiceGrokOutput(e)}}}),await n.connect(e,o),this.setVoiceConnectionStatus("connected"),await n.localParticipant.setMicrophoneEnabled(!0,{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}).catch(()=>{throw(0,a.vV)("chat-page-store:enterVoiceMode","Failed to set microphone enabled"),Error("Failed to set microphone enabled")});let l=new Promise((e,t)=>{this.voiceModeTimeoutId=setTimeout(()=>{(0,a.vV)("chat-page-store:enterVoiceMode","Connection ready timeout after 20 seconds"),t(Error("Voice connection ready timeout after 20 seconds"))},2e4)});try{await Promise.race([r,l]),this.voiceModeTimeoutId&&(clearTimeout(this.voiceModeTimeoutId),this.voiceModeTimeoutId=null)}catch(e){throw this.voiceModeTimeoutId&&(clearTimeout(this.voiceModeTimeoutId),this.voiceModeTimeoutId=null),await this.exitVoiceMode(),e}}catch(e){var o,n;if((0,a.vV)("chat-page-store:enterVoiceMode","Failed to enter voice mode"),this.setConversationMode("chat"),this.setVoiceConnectionStatus("disconnected"),this.setLivekitRoom(null),this.setLivekitToken(null),this.voiceModeTimeoutId&&(clearTimeout(this.voiceModeTimeoutId),this.voiceModeTimeoutId=null),(null==(o=e.message)?void 0:o.includes("Permission denied"))||(null==(n=e.message)?void 0:n.includes("NotAllowedError")))throw Error("mic-permission-denied");throw e}},this.exitVoiceMode=async()=>{let e=this.get(),t=m.w.getState();if(e.setVoiceConnectionStatus("disconnecting"),this.voiceModeTimeoutId&&(clearTimeout(this.voiceModeTimeoutId),this.voiceModeTimeoutId=null),e.streamedMessageId){let t=g.A3.getState(),s=t.byId[e.streamedMessageId],o=s.responseId,n=s.inflightResponseId||(0,R.A)();t.upsertResponse({...s,state:"closed",partial:!0,responseId:n}),this.setStreamedMessageId(void 0),this.setOptimisticMessageId(void 0),this.setLastMessageId(n),t.removeResponse(o)}if(e.livekitRoom){var s;await (null==(s=e.livekitRoom.localParticipant)?void 0:s.publishData(new TextEncoder().encode(""),{topic:"disconnect"})),await e.livekitRoom.disconnect()}e.optimisticConversationId&&(t.removeConversation(e.optimisticConversationId),this.setOptimisticConversationId(void 0),t.removeAbortControllerById(e.optimisticConversationId)),this.setLivekitRoom(null),this.setLivekitToken(null),this.setVoiceConnectionStatus("disconnected"),this.setConversationMode("chat")},this.toggleScreenSharing=async()=>{var e;let t=this.get();if(!(null==t?void 0:t.livekitRoom)||!(null==t||null==(e=t.livekitRoom)?void 0:e.localParticipant)||"ready"!==t.voiceConnectionStatus)throw(0,a.vV)("chat-page-store:startScreenShare","Voice connection not ready"),Error("Voice connection not ready");let s=t.livekitRoom.localParticipant.isScreenShareEnabled;try{await t.livekitRoom.localParticipant.setScreenShareEnabled(!s,{audio:!1,video:!0,selfBrowserSurface:"exclude",surfaceSwitching:"include"}).then(()=>t.sendVoiceSettingsUpdate({voiceId:t.voiceId,voicePersonalityId:t.voicePersonalityId,voiceCustomInstructions:t.voiceCustomInstructions,voiceEnableSearch:t.voiceEnableSearch}))}catch(e){throw(0,a.vV)("chat-page-store:toggleScreenSharing","Failed to toggle screen share"),e}},this.sendVoiceSettingsUpdate=async e=>{var t,s,n;let{voiceId:i,voicePersonalityId:r,voiceCustomInstructions:l,voiceEnableSearch:d}=e,c=this.get();if(!c.livekitRoom||"ready"!==c.voiceConnectionStatus)throw(0,a.vV)("chat-page-store:sendVoiceSessionUpdate","Voice connection not ready"),Error("Voice connection not ready");let u={voiceId:c.voiceId,voicePersonalityId:c.voicePersonalityId,voiceCustomInstructions:c.voiceCustomInstructions,voiceEnableSearch:c.voiceEnableSearch};this.setVoiceId(i),this.setVoicePersonalityId(r),this.setVoiceCustomInstructions(l),this.setVoiceEnableSearch(d);let m=null===o.sessionStoreState||void 0===o.sessionStoreState?void 0:o.sessionStoreState.getState(),h={instructions:F({username:null==m||null==(t=m.user)?void 0:t.givenName,customInstructions:c.voiceCustomInstructions||void 0}),voice:i,personality:r,enable_search:d,enable_vision:(null==(n=c.livekitRoom)||null==(s=n.localParticipant)?void 0:s.isScreenShareEnabled)||!1};return c.livekitRoom.localParticipant.publishData(new TextEncoder().encode(JSON.stringify({type:"session.update",session:h})),{topic:"realtime_client_event"}).catch(()=>{throw(0,a.vV)("chat-page-store:sendVoiceSettingsUpdate","Failed to send voice settings update"),this.setVoiceId(u.voiceId),this.setVoicePersonalityId(u.voicePersonalityId),this.setVoiceCustomInstructions(u.voiceCustomInstructions),this.setVoiceEnableSearch(u.voiceEnableSearch),Error("Failed to send voice settings update")})},this.sendVoiceManualMessage=async e=>{let{message:t}=e,s=this.get();if(!s.livekitRoom||"ready"!==s.voiceConnectionStatus)throw(0,a.vV)("chat-page-store:sendVoiceManualMessage","Voice connection not ready"),Error("Voice connection not ready");return s.livekitRoom.localParticipant.publishData(new TextEncoder().encode(t),{topic:"grok.chat"}).catch(()=>{throw(0,a.vV)("chat-page-store:sendVoiceManualMessage","Failed to send voice message"),Error("Failed to send voice message")})},this.handleVoiceConnectionPing=()=>{let e=this.get();return e.livekitRoom?e.livekitRoom.localParticipant.publishData(new TextEncoder().encode(JSON.stringify({timestamp:Date.now()})),{topic:"grok.ping"}):void(0,a.vV)("chat-page-store:handleVoiceConnectionPing","No livekit room available")},this.handleConversationCreated=e=>{let{conversation:t}=e,s=this.get(),o=m.w.getState();if(!s.optimisticConversationId)return;if(!(null==t?void 0:t.id))return void(0,a.vV)("chat-page-store:handleConversationCreated","Missing conversation id");let n=o.byId[s.optimisticConversationId];if(n.conversationId===t.id)return;let i={...n,conversationId:t.id,mediaTypes:["audio"],state:"optimistic"};o.upsertAndCacheConversation(i);let r=o.abortControllerById[s.optimisticConversationId];o.idsertAbortControllerById(r,i.conversationId),o.removeConversation(s.optimisticConversationId),s.setOptimisticConversationId(i.conversationId)},this.handleConversationItemCreated=e=>{var t,s,o,n,i,r,l,d;let{item:c}=e;if(!c||!c.id)return void(0,a.vV)("chat-page-store:handleConversationItemCreated","Missing item or item.id");if("user"!==c.role||"completed"!==c.status||!(null==(s=c.content)||null==(t=s[0])?void 0:t.text)&&!(null==(n=c.content)||null==(o=n[0])?void 0:o.transcript))return;let u=this.get(),h=g.A3.getState(),p=m.w.getState(),v=u.conversationId;if(!u.conversationId&&u.optimisticConversationId){let e={...p.byId[u.optimisticConversationId],state:"closed"};v=e.conversationId,p.upsertAndCacheConversation(e),u.set({optimisticConversationId:void 0,conversationId:e.conversationId}),h.idsertNodesByConversationId([],e.conversationId)}else if(!u.conversationId||!u.lastMessageId)return void(0,a.vV)("chat-page-store:handleConversationItemCreated","Missing conversationId or lastMessageId");let f=h.byId[c.id];if(f)return void h.upsertResponse({...f,message:(null==(l=c.content)?void 0:l[0].text)||(null==(d=c.content)?void 0:d[0].transcript)||""});let I=u.lastMessageId;if(u.streamedMessageId){let e=g.A3.getState(),t=e.byId[u.streamedMessageId],s=t.responseId,o=t.inflightResponseId||(0,R.A)();I=o,e.upsertResponse({...t,state:"closed",partial:!0,responseId:o,inflightResponseId:void 0}),this.setStreamedMessageId(void 0),this.setOptimisticMessageId(void 0),this.setLastMessageId(o),e.removeResponse(s)}h.createVoiceUserMessage({userResponseId:c.id,conversationId:v,parentResponseId:I,message:(null==(i=c.content)?void 0:i[0].text)||(null==(r=c.content)?void 0:r[0].transcript)||"",onUserResponse:e=>{u.setLastMessageId(e.responseId)},onOptimisticModelResponse:e=>{u.setStreamedMessageId(e.responseId)}})},this.handleAssistantVoiceResponseCreated=e=>{let{response:t}=e;if(!(null==t?void 0:t.id))return void(0,a.vV)("chat-page-store:handleAssistantVoiceResponseCreated","Missing response id");let s=this.get(),o=g.A3.getState();if(!s.streamedMessageId)return;let n=o.byId[s.streamedMessageId];return n&&(null==n?void 0:n.parentResponseId)?o.byId[n.parentResponseId]?void(n.inflightResponseId?o.upsertResponse({...n,message:"",inflightResponseId:t.id,state:"streaming"}):(o.upsertResponse({...n,inflightResponseId:t.id,state:"streaming"}),s.setStreamedMessageId(n.responseId))):void(0,a.vV)("chat-page-store:handleAssistantVoiceResponseCreated","Missing parent response"):void(0,a.vV)("chat-page-store:handleAssistantVoiceResponseCreated","Missing streaming response or parent response id")},this.handleAssistantVoiceResponseTranscriptDelta=e=>{let{response_id:t,delta:s}=e;if(!t||!s)return void(0,a.vV)("chat-page-store:handleAssistantVoiceResponseTranscriptDelta","Missing response_id or delta");let o=g.A3.getState(),n=this.get();if(!n.conversationId)return void(0,a.vV)("chat-page-store:handleAssistantVoiceResponseTranscriptDelta","Missing conversationId");let i=o.byConversationId[n.conversationId].find(e=>e.inflightResponseId===t);i&&"streaming"===i.state&&o.upsertResponse({...i,message:i.message+s})},this.handleVoiceGrokOutput=e=>{let{response_id:t,follow_ups:s}=e;if(!t)return void(0,a.vV)("chat-page-store:handleVoiceGrokOutput","Missing response_id");let o=g.A3.getState(),n=this.get();if(!n.conversationId)return void(0,a.vV)("chat-page-store:handleVoiceGrokOutput","Missing conversationId");let i=o.byConversationId[n.conversationId].find(e=>e.inflightResponseId===t);i&&(o.upsertResponse({...i,state:"closed",partial:!1,responseId:t,suggestions:s,inflightResponseId:void 0}),this.setStreamedMessageId(void 0),this.setOptimisticMessageId(void 0),this.setLastMessageId(t),o.removeResponse(i.responseId))},this.handleVoiceResponseSearchResult=e=>{let{response_id:t,x_posts:s,web_search_results:o}=e;if(!t)return void(0,a.vV)("chat-page-store:handleVoiceResponseSearchResult","Missing response_id");if(!(null==s?void 0:s.length)&&!(null==o?void 0:o.length))return;let n=this.get(),i=g.A3.getState();if(!n.conversationId)return void(0,a.vV)("chat-page-store:handleVoiceResponseSearchResult","Missing conversationId");let r=i.byConversationId[n.conversationId],l=i.byId[t]||r.find(e=>e.inflightResponseId===t);if(!l)return void(0,a.vV)("chat-page-store:handleVoiceResponseSearchResult","Missing response");let d=(null==s?void 0:s.map(e=>({username:e.userhandle,name:e.name,text:e.text,createTime:e.create_time,profileImageUrl:e.profile_image_url,postId:e.post_id,viewCount:e.view_count,citationId:e.post_id})))||[],c=(null==o?void 0:o.map(e=>({url:e.url,title:e.title,preview:e.snippet})))||[];i.upsertResponse({...l,xposts:(null==d?void 0:d.length)?d:l.xposts,xpostIds:(null==d?void 0:d.length)?S().compact(null==d?void 0:d.map(e=>e.postId)):l.xpostIds,webSearchResults:(null==c?void 0:c.length)?c:l.webSearchResults}),d.length?n.setSidePanelContent({type:"xPosts",data:d}):c.length&&n.setSidePanelContent({type:"webSearchResults",data:{webSearchResults:c}})}}}let D=(0,_.v)()((0,k.eh)((0,k.Zr)((e,t)=>new V(e,t),{name:"chat-preferences",partialize:e=>({outputMode:e.outputMode,activeModelId:e.activeModelId,selectedPersonalityId:e.selectedPersonalityId,customPersonality:e.customPersonality,defaultAnonModelId:e.defaultAnonModelId,defaultFreeModelId:e.defaultFreeModelId,defaultProModelId:e.defaultProModelId,voiceId:e.voiceId,voicePersonalityId:e.voicePersonalityId,voiceCustomInstructions:e.voiceCustomInstructions,voiceEnableSearch:e.voiceEnableSearch}),version:1})));function O(e,t){switch(t){case"deepsearch":case"deepersearch":return{imageGen:void 0,webSearch:void 0,xSearch:void 0,xMediaSearch:void 0,trendsSearch:void 0,xPostAnalyze:void 0}}switch(e){case"modelOnly":return{imageGen:!1,webSearch:!1,xSearch:!1,xMediaSearch:!1,trendsSearch:!1,xPostAnalyze:!1};case"noSearch":return{imageGen:void 0,webSearch:!1,xSearch:!1,xMediaSearch:!1,trendsSearch:!1,xPostAnalyze:!1};default:return{imageGen:void 0,webSearch:void 0,xSearch:void 0,xMediaSearch:void 0,trendsSearch:void 0,xPostAnalyze:void 0}}}function F(e){let{username:t,customInstructions:s}=e;return"Reminder: You do not need to introduce yourself unless the user asks for your name. You are Grok, a smart and helpful AI assistant created by xAI. You have a PLEASANT female voice. You're a helpful AI assistant that helps get things done. Never use commands and write your answer as if it was a transcript of an audio conversation. You are using your voice to speak aloud, so keep your responses brief.\n  ".concat(t?"You are speaking with ".concat(t,". Do not repeat the name unless necessary."):"","\n  ").concat(s)}function q(e,t,s){var o,n;if(e)return e;let i=h.V.getState().modelById[s];return((null==i||null==(o=i.tags)?void 0:o.includes("think"))||"think"!==t)&&((null==i||null==(n=i.tags)?void 0:n.includes("deepsearch"))||"deepsearch"!==t&&"deepersearch"!==t)?t:"none"}(0,c.lB)(D,"conversationId","optimisticConversationId",()=>void 0),(0,c.lB)(D,"conversationId","isRateLimited",()=>!1),(0,c.lB)(D,"conversationId","isUnauthenticated",()=>!1),(0,c.lB)(D,"conversationId","hasDismissedDisclaimer",()=>!1),(0,c.lB)(D,"conversationId","usingExperiment",()=>!1),(0,c.lB)(D,"conversationId","experiments",()=>[]),(0,c.lB)(D,"conversationId","streamingExperimentsIds",()=>[]),(0,c.lB)(D,"activeModelId","isRateLimited",()=>!1),(0,c.lB)(D,"reasoningMode","isRateLimited",()=>!1),D.subscribe(e=>e,(e,t)=>{"voice"===e.conversationMode&&(e.conversationId!==t.conversationId&&e.conversationId!==t.optimisticConversationId&&e.conversationId!==e.optimisticConversationId||!e.conversationId&&t.conversationId)&&D.getState().exitVoiceMode().catch(e=>{(0,a.vV)("chat-page-store:conversationId","Failed to exit voice mode",e)})}),!function(e){let t=new C.w("/chat/:chatId").test(window.location.pathname);e.setState({conversationId:t?t.chatId:void 0})}(D)},98100:(e,t,s)=>{s.d(t,{I2:()=>S,$E:()=>I,QG:()=>y,GB:()=>w});var o=s(97325),n=s(58192),i=s(6132);let r=i.z.object({modelId:i.z.string(),name:i.z.string().optional(),description:i.z.string().optional(),tags:i.z.array(i.z.string()).optional(),badgeText:i.z.string().optional()});i.z.object({models:i.z.array(r).optional().default([]),defaultFreeModel:i.z.string().optional(),defaultProModel:i.z.string().optional(),unavailableModels:i.z.array(r).optional().default([]),defaultAnonModel:i.z.string().optional()});let a=e=>["get-models",e];var l=s(64389),d=s(70888),c=s(13511),u=s(61683),m=s(38541),h=s.n(m),p=s(74995),g=s(3275),v=s(88382),f=s(75500);function I(){let e=(0,f.h)();return(0,v.useMemo)(()=>e.FORCE_SIGN_IN_MODELS.value.forceSignInModels&&Array.isArray(e.FORCE_SIGN_IN_MODELS.value.forceSignInModels)?e.FORCE_SIGN_IN_MODELS.value.forceSignInModels:[],[e.FORCE_SIGN_IN_MODELS.value])}function y(e){var t,s;let n=(0,d.x)(p.A("listByConversationId")),i=(0,d.x)(p.A("attachListByConversationId")),r=(0,o.aP)(p.A("conversationId"))||"no_conversation_id",a=(0,o.aP)(p.A("reasoningMode")),l="deepsearch"==a||"deepersearch"==a,c="think"==a,u=n[r],m=i[r],h=((null==u?void 0:u.length)||0)+((null==m?void 0:m.length)||0),g=null==e||null==(t=e.tags)?void 0:t.includes("no_attachments_for_think"),f=null==e||null==(s=e.tags)?void 0:s.includes("no_attachments_for_deepsearch"),I=!!(h&&g),y=!!(h&&f);return{isAttachDisabled:(0,v.useMemo)(()=>!!g&&!!c||!!f&&!!l,[l,c,g,f]),isThinkDisabled:I,isDeepsearchDisabled:y,isThinkSelected:c,isDeepsearchSelected:l}}function w(){var e,t,s,o;let i=u.Ay.language,d=(0,f.h)(),{data:m,isPending:I}=(0,c.IT)({queryKey:a(i),queryFn:async()=>{var e;return{models:((e=await l.FI.modelsGetModels({body:{locale:i}})).models||[]).map(e=>r.safeParse(e)).filter(e=>e.success).map(e=>e.data).sort((e,t)=>e.name===n.Wl?-1:t.name===n.Wl||e.name===n.fG?1:t.name===n.fG?-1:0),unavailableModels:(e.unavailableModels||[]).map(e=>r.safeParse(e)).filter(e=>e.success).map(e=>e.data),defaultAnonModelId:e.defaultAnonModel,defaultFreeModelId:e.defaultFreeModel,defaultProModelId:e.defaultProModel}},staleTime:3e5}),y=(0,v.useMemo)(()=>{var e;if(!m)return[];let t=R.safeParse(d.GROK35_FLEXIBLE_INPUT.value),s=new Set(null==(e=C.safeParse(d.HIDE_MODELS.value).data)?void 0:e.hideModels);return h().sortBy(m.models.filter(e=>!s.has(e.modelId)),"name").map(e=>({...e,...b(e.modelId,t)}))},[m,d.HIDE_MODELS,d.GROK35_FLEXIBLE_INPUT]),w=(0,v.useMemo)(()=>y?g.A(p.A("modelId"),y):{},[y]);return{models:y,unavailableModels:null!=(e=null==m?void 0:m.unavailableModels)?e:[],defaultAnonModelId:null!=(t=null==m?void 0:m.defaultAnonModelId)?t:n.Sk,defaultFreeModelId:null!=(s=null==m?void 0:m.defaultFreeModelId)?s:n.Sk,defaultProModelId:null!=(o=null==m?void 0:m.defaultProModelId)?o:n.Sk,modelById:w,isPending:I}}function b(e,t){var s,o,n,i,r,a,l,d;let c={modelId:e};return(null==(o=t.data)||null==(s=o[e])?void 0:s.name_override)&&(c.name=null==(a=t.data)||null==(r=a[e])?void 0:r.name_override),(null==(i=t.data)||null==(n=i[e])?void 0:n.description_override)&&(c.description=null==(d=t.data)||null==(l=d[e])?void 0:l.description_override),c}function S(e,t){return b(e,R.safeParse(t.GROK35_FLEXIBLE_INPUT.value))}let C=i.z.object({hideModels:i.z.array(i.z.string())}),x=i.z.object({name_override:i.z.string().nullish(),description_override:i.z.string().nullish()}).catch({}),R=i.z.record(i.z.string(),x).catch({})}}]);