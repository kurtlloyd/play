!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="ae08c4f0-ca27-4901-88f9-72e240a6759e",e._sentryDebugIdIdentifier="sentry-dbid-ae08c4f0-ca27-4901-88f9-72e240a6759e")}catch(e){}}(),(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[41340],{37357:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>x});var a=s(79342),l=s(10953),i=s(56691),n=s(97724),r=s(24429),o=s(84499),d=s(61312),c=s(2122),u=s(32171),m=s.n(u);s(88382);var f=s(65146);let x=()=>{let{t:e}=(0,f.Bd)(),{isSuperGrokUser:t}=(0,r.Q2)(),s=(0,r.hd)(),{push:u}=(0,o.wK)();return(0,a.jsxs)("div",{className:(0,d.cn)("fixed z-50 bg-background grid inset-0 place-items-center gap-4 duration-200 w-[100vw] min-h-[100vh] overflow-x-hidden","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 p-6"),children:[(0,a.jsx)("meta",{name:"description",content:"Unlock advanced AI capabilities with SuperGrok. With SuperGrok you get signifcantly more access to our premium models and early access to new features."})," ",(0,a.jsx)("meta",{name:"keywords",content:"Grok, Supergrok, Subscription, xAI, AI, Models, Context, Images, Generation, Tools, Features"}),(0,a.jsx)(i.$n,{asChild:!0,variant:"secondary",size:"pill",className:"absolute top-8 z-10 h-10 pr-5",children:(0,a.jsxs)(m(),{href:"/",children:[(0,a.jsx)(c.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"-mt-px",children:e("Go to","Go to")}),(0,a.jsx)("div",{className:"-mx-0.5 -mt-px",children:(0,a.jsx)(l.r1,{className:"h-3"})})]})}),(0,a.jsx)(n.W,{isSubscribed:t,isSuccessful:s,onSuccess:()=>u({page:"main"})})]})}},38245:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d});var a=s(79342),l=s(28503),i=s(10953),n=s(32171),r=s.n(n),o=s(65146);function d(){let{t:e}=(0,o.Bd)("base");return(0,a.jsxs)("div",{className:"w-full min-h-dvh flex flex-col items-center justify-center pt-4",children:[(0,a.jsx)("div",{className:"fixed bgGradient w-screen h-dvh -z-10"}),(0,a.jsx)(r(),{href:"/",className:"block focus:outline-none focus-visible:ring-1 focus-visible:ring-ring rounded-lg",children:(0,a.jsx)(i.r1,{height:20,width:60,className:"opacity-80 hover:opacity-100 fill-black dark:fill-white"})}),(0,a.jsx)(l.J,{title:e("pages.404.title","Page not found"),description:e("pages.404.description","There was an error loading this page. Please verify that you are using a correct URL or contact one of the admins if the issue persists."),cta:e("pages.404.home","Return to home")})]})}},41405:(e,t,s)=>{"use strict";function a(e){let t=["B","KB","MB","GB","TB"];if(0===e||e===BigInt(0))return"0.00 B";let s="bigint"==typeof e?Number(e):e;if("bigint"==typeof e&&e>BigInt(Number.MAX_SAFE_INTEGER)){let s=0,a=e;for(;a>=BigInt(1e3)&&s<t.length-1;)a/=BigInt(1e3),s++;return Number(a).toFixed(2)+" "+t[s]}let a=Math.floor(Math.log(s)/Math.log(1e3));return(s/Math.pow(1e3,a)).toFixed(2)+" "+t[a]}s.d(t,{z:()=>a})},56115:(e,t,s)=>{"use strict";s.d(t,{R:()=>l});var a=s(88382);let l=e=>{let{hasNextPage:t,isFetchingNextPage:s,isLoading:l,fetchNextPage:i}=e,n=(0,a.useRef)(null),r=(0,a.useRef)(null),[o,d]=(0,a.useState)(!1),[c,u]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{if(!(null==n?void 0:n.current)||!(null==r?void 0:r.current))return;let e=new IntersectionObserver(e=>{let[t]=e;d(t.isIntersecting)},{root:r.current,rootMargin:"300px 0px 300px 0px",threshold:.1}),t=n.current;return e.observe(t),()=>{t&&e.unobserve(t)}},[]),(0,a.useLayoutEffect)(()=>{!o||!t||s||c||l||(u(!0),i())},[o,t,s,i,c,l]),(0,a.useEffect)(()=>{if(c){let e=setTimeout(()=>{u(!1)},300);return()=>clearTimeout(e)}},[c]),{loadMoreRef:n,historyContainerRef:r}}},69473:(e,t,s)=>{"use strict";s.d(t,{H:()=>S});var a=s(79342),l=s(39489),i=s(92372),n=s(10084),r=s(56691),o=s(80226),d=s(75500),c=s(4878),u=s(12220),m=s(17703),f=s(6063),x=s(61312),h=s(13511),p=s(49694),g=s(73239),v=s(28984),j=s(71205),b=s(24405),y=s(16506),w=s(88382),N=s(65146),I=s(14486),k=s(93192),C=s(6980),E=s(73508);function S(e){let{fileMetadata:t,onClose:s,useRawFileURI:i,hideEdit:n,className:r}=e,o=(0,d.h)(),{ASSET_SERVER_URL:u}=(0,l.v)(),m=i?t.fileUri:(0,c.sU)(u,t.fileUri);if(o.ENABLE_CSV_RENDERING&&f.Ig.includes(t.fileMimeType)){let e=(0,x.cn)("flex flex-col items-center justify-center size-full mx-auto",r);return(0,a.jsx)(k.fE,{assetUrl:m,className:e})}if(o.ENABLE_XLSX_RENDERING&&f.f9.includes(t.fileMimeType)){let e=(0,x.cn)("flex flex-col items-center justify-center size-full mx-auto",r);return(0,a.jsx)(C.f,{assetUrl:m,fileMetadata:t,className:e})}if(t.fileMimeType.startsWith("text/"))return(0,a.jsx)(z,{assetUrl:m,fileMetadata:t,className:r});switch(t.fileMimeType){case"image/jpeg":case"image/png":case"image/webp":return(0,a.jsx)(A,{assetUrl:m,fileMetadata:t,onClose:s,hideEdit:n});case"application/json":case"application/csv":case"application/x-yaml":case"application/xml":case"application/toml":case"":return(0,a.jsx)(z,{className:r,assetUrl:m,fileMetadata:t});case"image/heic":case"image/heif":case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":case"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":case"application/vnd.ms-powerpoint":return(0,a.jsx)(R,{assetUrl:m,fileMetadata:t});default:return(0,a.jsx)(M,{assetUrl:m,fileMetadata:t})}}function A(e){let{assetUrl:t,fileMetadata:s,showControls:l=!1,onClose:d,hideEdit:c}=e,[f,x]=(0,w.useState)(!0),{t:h}=(0,N.Bd)("chat");(0,w.useEffect)(()=>{if(!t)return void x(!1);let e=new Image;return e.src=t,e.onload=()=>x(!1),e.onerror=()=>x(!1),()=>{e.onload=null,e.onerror=null}},[t]);let b=(0,w.useCallback)(()=>{t&&(0,u.G)(t,s.fileName).catch((0,m.HX)("chat-asset-viewer:handleDownloadImage"))},[t,s]);return l?(0,a.jsx)("div",{className:"flex flex-col items-center justify-center w-full max-w-4xl mx-auto","data-vaul-no-drag":!0,children:(0,a.jsx)("div",{className:"relative w-full max-w-4xl mx-auto",children:(0,a.jsx)(I.GT,{initialScale:1,initialPositionX:0,initialPositionY:0,children:e=>{let{zoomIn:l,zoomOut:i,resetTransform:n}=e;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"absolute end-4 bottom-4 z-10 flex space-x-1 rounded-full bg-background p-1 opacity-80",children:[(0,a.jsx)(r.$n,{onClick:()=>l(),variant:"ghost",size:"iconSm",className:"text-primary hover:bg-foreground","aria-label":"Zoom In",children:(0,a.jsx)(p.A,{className:"h-4 w-4"})}),(0,a.jsx)(r.$n,{onClick:()=>i(),variant:"ghost",size:"iconSm",className:"text-primary hover:bg-foreground","aria-label":"Zoom Out",children:(0,a.jsx)(g.A,{className:"h-4 w-4"})}),(0,a.jsx)(r.$n,{onClick:()=>n(),variant:"ghost",size:"iconSm",className:"text-primary hover:bg-foreground","aria-label":"Reset Zoom",children:(0,a.jsx)(v.A,{className:"h-4 w-4"})}),(0,a.jsx)(r.$n,{onClick:b,variant:"ghost",size:"iconSm",className:"text-primary hover:bg-foreground","aria-label":"Reset Zoom",children:(0,a.jsx)(j.A,{className:"h-4 w-4"})})]}),(0,a.jsx)(I.WZ,{wrapperClass:"!w-full bg-primary/50 rounded-lg",children:(0,a.jsx)("img",{src:t,alt:s.fileName,className:"w-full h-auto shadow-md",onLoad:()=>i(),style:{maxHeight:"70vh"}})}),f&&(0,a.jsx)(o.E,{className:"w-full h-[70vh] rounded-lg"})]})}})})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("img",{src:t,alt:s.fileName,className:"w-[94vw] max-h-[calc(100vh-10rem)] max-w-5xl xl:max-w-6xl shadow cursor-pointer rounded-xl lg:w-fit object-contain"}),t&&!c&&(0,a.jsx)("div",{className:"w-full flex justify-center absolute bottom-3 p-3",children:(0,a.jsxs)(n.R,{className:"px-4 py-3 h-auto",buttonProps:{variant:"card",size:"pill"},editingImage:{url:t,metadata:s},location:"chat-asset-viewer",onClick:e=>{e.stopPropagation(),d()},children:[(0,a.jsx)(i.mg,{className:"size-5 text-secondary"}),h("Edit Image","Edit Image")]})})]})}let z=w.memo(function(e){let{assetUrl:t,fileMetadata:s,className:l}=e,{t:i}=(0,N.Bd)("chat"),{resolvedTheme:n}=(0,y.D)(),{isLoading:r,error:o,data:d}=(0,h.IT)({queryKey:["text-asset",t],queryFn:async()=>{if(!t)throw Error("Asset URL is required");let e=await fetch(t,{method:"GET",credentials:"include"});if(!e.ok)throw Error("Failed to fetch: ".concat(e.statusText));return await e.text()},enabled:!!t});if(r)return(0,a.jsx)("div",{className:"p-4",children:i("Loading text…","Loading text…")});if(o)return(0,a.jsx)("div",{className:"p-4",children:i("errorMessage","Error: {{error}}",{error:o.message})});if(!d)return(0,a.jsx)("div",{className:"p-4 w-full h-full flex items-center justify-center text-secondary",children:i("Content is empty","Content is empty")});let c=d.length>16384,u=f.rU.includes(s.fileMimeType),m=c||u?(0,a.jsx)("pre",{className:(0,x.cn)("w-full p-4 rounded-lg shadow-md text-sm font-mono overflow-auto max-h-[50dvh] sm:max-h-[calc(100dvh-6rem)] mb-4 bg-foreground",l),children:d}):(0,a.jsx)("div",{className:(0,x.cn)("w-full rounded-lg shadow-md text-sm font-mono overflow-auto max-h-[50dvh] sm:max-h-[calc(100dvh-6rem)] mb-4",l),children:(0,a.jsx)(E.r,{customStyle:{background:"dark"===n?"#121314":"var(--foreground)",fontFamily:"var(--font-ibm-plex-mono)"},children:d})});return(0,a.jsx)("div",{className:(0,x.cn)("flex flex-col items-center justify-center w-full max-w-4xl mx-auto",l),children:m})});function R(e){let{assetUrl:t,fileMetadata:s}=e,{t:l}=(0,N.Bd)("chat");return t?(0,a.jsxs)("div",{className:"flex flex-col min-h-full w-full items-center justify-center rounded-2xl mb-4 gap-6 p-4",children:[(0,a.jsx)(b.A,{size:100,className:"text-muted"}),(0,a.jsx)("a",{href:t,download:s.fileName||"download",children:(0,a.jsx)(r.$n,{variant:"filledSecondary",rounded:!0,children:l("Download Asset","Download Asset")})})]}):null}function M(e){let{assetUrl:t,fileMetadata:s}=e,l=(0,w.useRef)(null);return(0,a.jsx)("div",{className:"flex flex-col items-center justify-center rounded-lg w-full h-full",children:(0,a.jsx)("iframe",{ref:l,src:t,title:s.fileName,className:"rounded-lg shadow-md h-full w-full"})})}z.displayName="MemoizedTextAssetViewer"},70154:(e,t,s)=>{Promise.resolve().then(s.bind(s,80885))},80885:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>sM});var a=s(79342),l=s(1270),i=s(97325),n=s(51375),r=s(37469),o=s(65761),d=s(56691),c=s(41405),u=s(61312),m=s(87891),f=s(20337),x=s(42283),h=s(77010),p=s(33846),g=s(74995),v=s(88382),j=s(65146);let b=(0,v.memo)(e=>{let{asset:t,isFileSelected:s}=e,{t:l}=(0,j.Bd)(),{client:b}=(0,f.useStatsigClient)(),y=(0,i.aP)(g.A("setSidePanelContent")),[w,N]=(0,v.useState)(!1),I=(0,m.R)(e=>e.deleteAsset),k=(0,v.useCallback)(()=>{if(s)return void y(void 0);y({type:"asset",data:(0,r.B)(t),hideEdit:!0})},[t,s,y]),C=(0,v.useCallback)(e=>{var s,a;e.stopPropagation(),I(t.assetId),b.logEvent("delete_asset","asset_row",{assetId:t.assetId,assetName:t.name,assetSize:null!=(a=null==(s=t.sizeBytes)?void 0:s.toString())?a:"unknown",assetType:t.mimeType})},[t,I,b]);return(0,a.jsxs)(p.P.div,{layout:!0,initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:(0,u.cn)("flex flex-shrink-0 items-center gap-4 p-2 border rounded-xl bg-card hover:bg-card-hover cursor-pointer focus:bg-card-hover focus:outline-none mb-2 overflow-x-hidden",s&&"bg-card-hover"),tabIndex:0,onClick:k,children:[(0,a.jsx)(n.E,{metadata:(0,r.B)(t),className:"rounded-lg w-12 h-12 ms-0 me-0 [&>img]:h-full [&>img]:w-full"}),(0,a.jsxs)("div",{className:"flex flex-col flex-1",children:[(0,a.jsx)("span",{className:"line-clamp-1 break-all",children:t.name}),(0,a.jsxs)("div",{className:"text-sm text-gray-500 line-clamp-1 break-all",children:[(0,a.jsx)("span",{children:t.sizeBytes?(0,c.z)(t.sizeBytes):l("file-browser.unknown-size","Unknown")}),(0,a.jsx)("span",{children:" • "}),(0,a.jsx)("span",{children:t.createTime?(0,o.P)(t.createTime):""}),(0,a.jsx)("span",{children:" • "}),(0,a.jsx)("span",{children:t.mimeType})]})]}),w?(0,a.jsxs)("div",{className:"flex flex-row items-center gap-2",children:[(0,a.jsx)(d.gx,{variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),N(!1)},tooltipContent:l("Cancel","Cancel"),"aria-label":l("Cancel","Cancel"),className:"flex items-center gap-3 size-8 rounded-md",children:(0,a.jsx)(x.A,{size:16})}),(0,a.jsx)(d.gx,{variant:"ghost",size:"sm",btnColor:"danger",onClick:C,tooltipContent:l("Confirm","Confirm"),"aria-label":l("Confirm","Confirm"),className:"flex items-center gap-3 size-8 rounded-md",children:(0,a.jsx)(h.A,{size:16})})]}):(0,a.jsx)(d.gx,{variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),N(!0)},tooltipContent:l("Delete","Delete"),"aria-label":l("Delete","Delete"),className:"flex items-center gap-3 size-8 rounded-md",children:(0,a.jsx)(h.A,{size:16})})]},t.assetId)});var y=s(81745),w=s(28503),N=s(54344),I=s(23835),k=s(73772),C=s(74933),E=s(48589),S=s(84499),A=s(40873),z=s(5335);let R=(0,z.A)("File",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]);var M=s(67811),P=s(57402),_=s(84969),T=s(63209),D=s(56115),B=s(17703);let F=()=>{let{route:e}=(0,S.wK)(),t=(0,m.R)(e=>e.loadFirstPage),s=(0,m.R)(e=>e.loadNextPage),a=(0,m.R)(e=>e.listPageToken),l=(0,m.R)(e=>e.listStatus),i=(0,m.Z0)();(0,v.useEffect)(()=>{t({sort:"files"===e.page?e.sort:"used",search:"files"===e.page?e.search:void 0})},[t,e]);let{loadMoreRef:n,historyContainerRef:r}=(0,D.R)({hasNextPage:!!a,isFetchingNextPage:"loading"===l,isLoading:"loading"===l,fetchNextPage:()=>{s().catch(e=>(0,B.vV)("files-load-more",e))}});return{assets:i,isLoading:"loading"===l,hasError:"error"===l,refetch:t,loadMoreRef:n,historyContainerRef:r}},O=[{label:(0,a.jsx)(j.x6,{ns:"base",i18nKey:"file-browser.sort.size",defaults:"Size"}),value:"size"},{label:(0,a.jsx)(j.x6,{ns:"base",i18nKey:"file-browser.sort.name",defaults:"Name"}),value:"name"},{label:(0,a.jsx)(j.x6,{ns:"base",i18nKey:"file-browser.sort.created-time",defaults:"Created Time"}),value:"created"},{label:(0,a.jsx)(j.x6,{ns:"base",i18nKey:"file-browser.sort.last-used-time",defaults:"Last Used Time"}),value:"used"}];function U(){var e;let{t}=(0,j.Bd)("base"),{user:s}=(0,I.useSession)(),{push:l,replace:n,route:r}=(0,S.wK)(),o="files"===r.page?r:(0,A.Z)("only for /files"),[c,m]=(0,v.useState)(""),f=o.sort||"used",x=(0,E.o)(c,500);(0,v.useEffect)(()=>{n({...o,search:x})},[x,n,o]);let h=e=>{l({...o,sort:e})},g=(0,i.aP)(e=>{var t;return(null==(t=e.sidePanelContent)?void 0:t.type)!=="asset"?null:e.sidePanelContent.data.fileMetadataId}),{assets:z,isLoading:D,hasError:B,refetch:U,loadMoreRef:L,historyContainerRef:W}=F();return s?(0,a.jsxs)("main",{className:(0,u.cn)("h-dvh w-full relative flex flex-col items-center"),children:[(0,a.jsx)(T.hx,{hideIncognito:!0}),(0,a.jsx)(y.CommandMenu,{}),(0,a.jsxs)("div",{className:"max-w-[50rem] px-2 pt-16 pb-8 @sm:pt-18 mx-auto w-full flex flex-col h-full",ref:W,children:[(0,a.jsxs)("h1",{className:"text-2xl flex gap-2 items-center pb-4",children:[(0,a.jsx)(R,{size:24,className:"min-w-8"}),t("Files","Files")]}),(0,a.jsxs)("div",{className:"flex gap-2 items-center justify-between w-full pb-2",children:[(0,a.jsx)(C.p,{value:c,onChange:e=>m(e.target.value),placeholder:t("file-browser.filter.placeholder","Search files..."),className:"text-primary bg-input h-10 rounded-xl"}),(0,a.jsxs)(k.rI,{children:[(0,a.jsx)(k.ty,{asChild:!0,children:(0,a.jsxs)(d.$n,{variant:"outline",className:"h-10 rounded-xl",children:[t("file-browser.sort.label","Sort by: "),null==(e=O.find(e=>e.value===f))?void 0:e.label,(0,a.jsx)(M.A,{size:16})]})}),(0,a.jsx)(k.SQ,{children:O.map(e=>(0,a.jsx)(k._2,{onClick:()=>h(e.value),children:e.label},e.value))})]})]}),(0,a.jsxs)(N.D,{children:[(0,a.jsxs)(_.N,{children:[null==z?void 0:z.map(e=>(0,a.jsx)(b,{isFileSelected:e.assetId===g,asset:e},e.assetId)),(null==z?void 0:z.length)===0&&!D&&(0,a.jsx)(p.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:(0,a.jsx)("div",{className:"text-center",children:t("file-browser.no-files-found","No files found")})},"no-files-found"),D&&(0,a.jsx)("div",{className:"flex justify-center items-center w-full h-full max-h-[150px]",children:(0,a.jsx)(p.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)(P.A,{className:"animate-spin"})})})},"files-loading"),B&&(0,a.jsxs)("div",{className:"flex justify-center items-center w-full h-full max-h-[150px] flex-col gap-4",children:[(0,a.jsx)("div",{className:"text-center",children:t("file-browser.error.description","There was an issue loading your files")}),(0,a.jsx)(d.$n,{variant:"filledSecondary",onClick:()=>U(),children:t("Retry","Retry")})]},"files-error")]}),(0,a.jsx)("div",{ref:L})]})]})]}):(0,a.jsx)("main",{className:(0,u.cn)("w-screen h-dvh relative"),children:(0,a.jsx)(w.J,{title:t("Error","Error"),description:t("file-browser.error.anonymous-user","You must be logged in to access this page"),cta:t("Go Home","Go Home")})})}var L=s(38245),W=s(37357),G=s(42557),H=s(35692),$=s(43086),K=s(46748),V=s(75500),q=s(41320),X=s(2280),Z=s(27636),Q=s(64389),Y=s(73304),J=s(13511),ee=s(47416),et=s(31905),es=s(49881),ea=s(19717),el=s(8757),ei=s(2010),en=s(35795),er=s(35589),eo=s(16506),ed=s(39116),ec=s(14908);function eu(e){let{children:t,numOfLines:s,...l}=e;return(0,a.jsx)("p",{style:{display:"-webkit-box",WebkitLineClamp:s,WebkitBoxOrient:"vertical",overflow:"hidden"},...l,children:t})}function em(e){let{task:t,onClick:s}=e,{client:l}=(0,f.useStatsigClient)(),{getScheduleLabel:i}=(0,Z.Ik)(),n=(0,Y.d)(g.A("handleSetCreateDialog")),r=(0,Y.d)(g.A("handleSetTaskToEdit")),o=(0,v.useCallback)(()=>{l.logEvent("task_preset_clicked",void 0,{}),n(!0),r(t),null==s||s()},[n,r,s,l,t]),d=(0,Z.O$)(t),c=(0,v.useMemo)(()=>{var e,t;if(d)return i(d.cadence,d.timeOfDay,d.ianaTimezone,d.localDayOfWeek,d.localDayOfMonth,null!=(t=null==(e=d.localDayOfYear)?void 0:e.toISODate())?t:void 0)},[i,d]),{resolvedTheme:m}=(0,eo.D)();return(0,a.jsxs)("div",{className:(0,u.cn)("group h-40 grow w-full rounded-2xl pt-4 px-4 flex flex-col items-center gap-3 border cursor-pointer bg-surface-l1 hover:bg-surface-l2",{"hover:bg-surface-inset":"light"===m}),onClick:o,children:[(0,a.jsx)("h1",{className:"font-semibold text-sm",children:t.cta||t.name}),(0,a.jsxs)("div",{className:"grow w-full rounded-t-xl border bg-surface-l2 overflow-hidden p-3 group-hover:bg-surface-l3",children:[(0,a.jsx)(eu,{className:"text-xs text-fg-secondary font-normal mb-2",numOfLines:2,children:t.prompt}),(0,a.jsx)("p",{className:"text-xs font-normal",children:c})]})]})}var ef=function(e){return e[e.ACTIVE=0]="ACTIVE",e[e.COMPLETED=1]="COMPLETED",e[e.ARCHIVED=2]="ARCHIVED",e}(ef||{});function ex(){let e=(0,V.h)(),{t}=(0,j.Bd)("tasks"),{getUserTasksQuery:s,getInactiveUserTasksQuery:l}=(0,Z.ek)(),i=(0,Y.d)(g.A("handleSetCreateDialog")),n=(0,Y.d)(g.A("handleSetSelectedTask")),{taskPresets:r}=(0,Z.Ik)(),o=(0,q.Di)(),{client:c}=(0,f.useStatsigClient)(),{route:m}=(0,S.wK)(),x="tasks"===m.page&&m.taskId||null,h="tasks"===m.page&&m.tab||null,b=(0,v.useRef)(null),[w,N]=(0,v.useState)(!0),[I,k]=(0,v.useState)(!1),[C,E]=(0,v.useState)({}),A=(0,v.useCallback)((e,t)=>{E(s=>({...s,[e]:t}))},[E]);(0,v.useEffect)(()=>{let e=t("tasks-page-document-title","Tasks");document.title="".concat(e," - Grok")},[t]),(0,K.r)(t("tasks-page-document-title","Tasks")),(0,v.useEffect)(()=>{c.logEvent("opened_tasks_page",void 0,{})},[c]);let[z,R]=(0,v.useState)(2*("archived"===h)),M=!!(0,G.wV)().user,P=e.ENABLE_GROK_TASKS&&M,{isLoading:_,data:D,refetch:B,isRefetching:F}=s,{isLoading:O,data:U,refetch:L,isRefetching:W}=l,H=2===z?O:_,Q=2===z?W:F;(0,v.useEffect)(()=>{let e=()=>{if(b.current){let{scrollTop:e,scrollHeight:t,clientHeight:s}=b.current;0===e?N(!0):N(!1),e+s>=t-5?k(!0):k(!1)}},t=b.current;return t&&t.addEventListener("scroll",e),()=>{t&&t.removeEventListener("scroll",e)}},[b,H]);let J=(0,v.useCallback)(async()=>2===z?L():B(),[z,B,L]),el=(0,v.useMemo)(()=>2===z?null==U?void 0:U.tasks:null==D?void 0:D.tasks,[z,null==U?void 0:U.tasks,null==D?void 0:D.tasks]),ei=(0,v.useCallback)(()=>{R(0)},[]),en=(0,v.useCallback)(()=>{R(2)},[]),eo=(0,v.useCallback)(async()=>{c.logEvent("refresh_tasks_clicked",void 0,{}),J().catch(e=>ec.oR.error(e))},[J,c]),eu=(0,v.useCallback)(()=>(0,a.jsxs)("div",{className:"rounded-xl border p-0.5 flex items-center gap-1 bg-surface-inset",children:[(0,a.jsx)(d.$n,{variant:0===z?"filledSecondary":"ghost",onClick:ei,size:"sm",className:(0,u.cn)("px-3 rounded-[0.5rem] font-semibold",{"text-primary":0===z,"text-fg-secondary":0!==z}),children:t("tasks-toggle.active","Active")}),(0,a.jsx)(d.$n,{variant:2===z?"filledSecondary":"ghost",onClick:en,size:"sm",className:(0,u.cn)("px-3 rounded-[0.5rem] font-semibold",{"text-primary":2===z,"text-fg-secondary":2!==z}),children:t("tasks-toggle.archived","Archived")})]}),[t,z,ei,en]),ef=(0,v.useCallback)(()=>{c.logEvent("clicked_add_new_task",void 0,{location:"tasks-page"}),i(!0),R(0)},[i,c]),ex=(0,v.useCallback)(()=>(0,a.jsxs)("div",{className:"w-full py-8 border rounded-xl flex flex-col items-center gap-4 px-4",children:[(0,a.jsx)(d.$n,{size:"iconMd",variant:"secondary",className:"rounded-full",onClick:ef,"aria-label":t("tasks.create","Add new"),children:(0,a.jsx)(ee.A,{size:20})}),(0,a.jsxs)("div",{className:"flex flex-col items-center w-full gap-2 text-lg font-semibold",children:[(0,a.jsx)("h1",{children:t("no-tasks-banner.title","Get started by adding a task")}),(0,a.jsx)("p",{className:"text-xs font-normal text-fg-secondary text-center leading-1",children:t("no-tasks-banner.subtitle","Schedule a task to automate actions and get reminders when they complete.")})]})]}),[ef,t]),ep=(0,v.useCallback)(()=>(0,a.jsxs)("div",{className:"w-full py-8 border rounded-xl flex flex-col items-center gap-4",children:[(0,a.jsx)("div",{className:"flex items-center justify-center rounded-full bg-surface-l1 p-4",children:(0,a.jsx)(et.A,{size:20})}),(0,a.jsxs)("div",{className:"flex flex-col items-center w-full gap-2 text-lg font-semibold",children:[(0,a.jsx)("h1",{children:t("no-archived-tasks-banner.title","No archived tasks")}),(0,a.jsx)("p",{className:"text-xs font-normal text-fg-secondary text-center leading-1",children:t("no-archived=tasks-banner.subtitle","Archived tasks will show up here")})]})]}),[t]),eg=(0,v.useMemo)(()=>{if(!el)return[];if(0===z){var e;return e=el.filter(e=>{var t;return null==(t=e.task)?void 0:t.isActive}),e.sort((e,t)=>{var s,a,l,i;let n=C[null!=(l=null==(s=e.task)?void 0:s.taskId)?l:""],r=C[null!=(i=null==(a=t.task)?void 0:a.taskId)?i:""];return n&&r?er.c9.fromISO(r).diff(er.c9.fromISO(n)).toMillis():n?-1:1*!!r})}return 2===z?el.filter(e=>{var t;return!(null==(t=e.task)?void 0:t.isActive)}):[]},[el,z,C]);(0,v.useEffect)(()=>{var e;let t=x?null==el?void 0:el.find(e=>{var t;return(null==(t=e.task)?void 0:t.taskId)===x}):void 0;t&&t.task&&(null==(e=t.schedules)?void 0:e.at(0))&&n(t),x||n(void 0)},[el,n,x]),(0,v.useEffect)(()=>()=>{n(void 0)},[n]);let ev=(0,v.useMemo)(()=>r.sort(()=>Math.random()-.5).slice(0,2),[r]);if(!P)return(0,ed.redirect)("/");let ej=0===z&&eg.length<=3;return(0,a.jsxs)("div",{className:(0,u.cn)("h-dvh w-full relative selection:bg-highlight",{"overflow-y-auto":o}),children:[(0,a.jsx)(T.hx,{hideIncognito:!0}),(0,a.jsx)(y.CommandMenu,{}),(0,a.jsxs)("div",{className:"max-w-[50rem] px-2 pt-16 @sm:pt-18 mx-auto w-full flex flex-col h-full items-center pb-4",style:I?{}:{maskImage:X.pA,WebkitMaskImage:X.pA},children:[(0,a.jsx)("div",{className:"flex justify-between align-center mt-6 min-h-[42px] w-full",children:(0,a.jsxs)("div",{className:"flex justify-between items-center w-full",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 group",children:[(0,a.jsx)("h1",{className:"text-2xl flex gap-2 items-center font-semibold",children:t("tasks.page-title","Tasks")}),(0,a.jsx)(d.$n,{size:"iconSm",variant:"ghost",disabled:H||Q,onClick:eo,className:"opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:(0,a.jsx)(es.A,{size:14,"aria-label":t("task-results.refresh","refresh task results")})})]}),!o&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"absolute left-1/2 -translate-x-1/2",children:(0,a.jsx)(eu,{})}),(0,a.jsxs)(d.$n,{variant:"outline",onClick:ef,size:"md",children:[(0,a.jsx)(ea.A,{size:16}),(0,a.jsx)("span",{children:t("tasks.create","Add new")})]})]})]})}),o&&(0,a.jsxs)("div",{className:"flex w-full justify-between items-center pb-4",children:[(0,a.jsx)(eu,{}),(0,a.jsxs)(d.$n,{variant:"outline",onClick:ef,size:"md",children:[(0,a.jsx)(ea.A,{size:16}),t("tasks.create","Add new")]})]}),H?(0,a.jsx)("div",{className:"grow shrink self-stretch flex items-center justify-center",children:(0,a.jsx)($.y,{size:"sm"})}):(0,a.jsxs)("div",{className:"pt-6 w-full overflow-auto relative no-scrollbar",style:w?{}:{maskImage:X.l1,WebkitMaskImage:X.l1},ref:b,children:[0===eg.length&&0===z&&(0,a.jsx)(ex,{}),0===eg.length&&2===z&&(0,a.jsx)(ep,{}),(0,a.jsxs)("div",{className:(0,u.cn)("flex flex-col gap-4 pb-4 w-full "),children:[eg.length>0&&eg.filter(e=>!!e.task).map((e,t)=>{if(e.task){var s;return(0,a.jsx)(p.P.div,{initial:{opacity:0,x:50},animate:{opacity:1,x:0},transition:{type:"ease",ease:"easeInOut",duration:.166,delay:.07*(t+1)},children:(0,a.jsx)(eh,{task:e,updateTaskIdIsUnread:A})},null==(s=e.task)?void 0:s.taskId)}}),ej?(0,a.jsx)("div",{className:(0,u.cn)("pt-4 flex items-center pb-20",{"flex-col pb-8":o}),children:(0,a.jsx)("div",{className:(0,u.cn)("flex w-full gap-4",{"flex-col":o}),children:ev.map((e,t)=>(0,a.jsx)(em,{task:e},t))})}):null]})]})]})]})}function eh(e){var t,s,l,i,n,r,o,d,c,m;let{task:x,updateTaskIdIsUnread:h}=e,{t:p}=(0,j.Bd)("tasks"),{onSetSelectedTask:b}=(0,Z.ek)(),{getNextRunLabel:y}=(0,Z.Ik)(),{client:w}=(0,f.useStatsigClient)(),{resolvedTheme:N}=(0,eo.D)(),I=(0,q.Di)(),k=(0,Y.d)(g.A("selectedTaskForSidePanel")),C=(null==k||null==(t=k.task)?void 0:t.taskId)===(null==(s=x.task)?void 0:s.taskId),E=(0,V.h)(),S=(0,v.useCallback)(()=>{var e;if(w.logEvent("clicked_tasks_card",void 0,{}),C)return b(void 0);b(null==(e=x.task)?void 0:e.taskId)},[C,b,w,null==(l=x.task)?void 0:l.taskId]),A=null==(i=x.schedules)?void 0:i.at(0),{data:z}=(0,J.IT)({queryKey:["latest-task-result",null==(n=x.task)?void 0:n.taskId],queryFn:async()=>{var e;if(!(null==(e=x.task)?void 0:e.taskId))throw Error("TaskId is required");return Q.Cs.grokTasksGetLatestUnreadTaskResult({taskId:x.task.taskId})},enabled:E.ENABLE_GROK_TASKS&&!!(null==(r=x.task)?void 0:r.taskId),staleTime:0,refetchOnMount:"always"}),R=null==z||null==(o=z.results)?void 0:o.at(0),M=!(null==(d=x.task)?void 0:d.isActive),P=!!(R&&!R.isRead&&!M),T=null==R?void 0:R.createTime;if((0,v.useEffect)(()=>{var e,t;h(null!=(t=null==(e=x.task)?void 0:e.taskId)?t:"",T)},[h,null==(c=x.task)?void 0:c.taskId,T]),!x.task||!A)return null;let D=!!((null==(m=x.task)?void 0:m.isActive)&&A.isEnabled);return(0,a.jsxs)("div",{className:(0,u.cn)("w-full flex flex-col p-4 rounded-2xl border bg-surface-l1 hover:bg-surface-l2 cursor-pointer  relative",{"hover:bg-surface-inset":"light"===N},{"bg-surface-l2 hover:bg-surface-l3":C},{"bg-surface-inset hover:bg-button-ghost-hover":C&&"light"===N}),onClick:S,children:[(0,a.jsx)("div",{className:"flex flex-row items-center",children:(0,a.jsx)("h1",{className:(0,u.cn)("text-sm font-semibold w-full",{"text-xs":I}),children:x.task.name&&x.task.name.length>0?x.task.name:"Task"})}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{className:(0,u.cn)("flex items-center gap-1 text-sm font-medium text-fg-secondary",{"text-yellow-300":!D&&!M,"text-xs":I}),children:[M?(0,a.jsx)(et.A,{size:14}):D?(0,a.jsx)(el.A,{size:14,className:"text-fg-positive"}):(0,a.jsx)(ei.A,{size:14}),M?p("task-card.archived","Archived"):D?p("task-card.scheduled","Scheduled"):p("task-card.not-scheduled","Paused")]}),(0,a.jsx)("p",{className:(0,u.cn)("text-sm text-fg-secondary font-normal",{"text-xs":I}),children:D&&A.nextRun&&A.taskCadence&&"".concat(p("task-cadence.next-run","Next Run:")," ").concat(y(A.nextRun,A.isCompleted))})]}),(0,a.jsx)(_.N,{children:!I&&P&&R&&(0,a.jsx)("div",{className:"w-full mt-2",children:(0,a.jsx)(ep,{taskResult:R})})})]})}function ep(e){var t;let{taskResult:s}=e,{t:l}=(0,j.Bd)("tasks"),{client:i}=(0,f.useStatsigClient)(),{push:n}=(0,S.wK)(),r=(0,q.Di)(),o=(0,v.useCallback)(e=>{i.logEvent("clicked_latest_unread_in_tasks_card",void 0,{}),(null==s?void 0:s.conversationId)&&(e.stopPropagation(),n({page:"chat",conversationId:null==s?void 0:s.conversationId,temporary:!1}))},[n,i,s]),c=(0,v.useMemo)(()=>{var e;if(!s.createTime)return null;let t=er.c9.fromISO(s.createTime),a=er.c9.now();return null!=(e=t.toRelative({base:a}))?e:l("just-now","Just now")},[l,s.createTime]);return(0,a.jsx)(p.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2,ease:"easeIn"},children:(0,a.jsxs)(d.gx,{variant:"none",className:(0,u.cn)("cursor-pointer hover:bg-button-ghost-hover bg-surface-l3 border px-3 rounded-lg flex items-center justify-between w-full text-sm flex-wrap h-full",{"flex-col items-start p-3":r}),onClick:o,tooltipContent:l("task-card.goto-last-chat-unread","Go to latest unread chat"),tooltipContentProps:{side:"bottom"},children:[(0,a.jsxs)("div",{className:(0,u.cn)("flex items-center gap-2",{"justify-between w-full":r}),children:[!r&&(0,a.jsx)(H.x,{variant:"sm"}),(0,a.jsx)("p",{children:null!=(t=s.title)?t:l("new-task-result-label","New task result")}),r&&(0,a.jsx)(H.x,{variant:"sm"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1.5 text-fg-secondary",children:[(0,a.jsx)("p",{className:(0,u.cn)({"text-xs":r}),children:c}),!r&&(0,a.jsx)(en.A,{size:14})]})]})})}var eg=s(92437);function ev(e){let{className:t}=e,{t:s}=(0,j.Bd)("files"),l=(0,v.useRef)(null),i=(0,m.R)(e=>e.uploadAsset),{push:n}=(0,S.wK)(),r=(0,v.useCallback)((e,t)=>{let a=t.items;if(!a||0===a.length||!("webkitGetAsEntry"in a[0]))return void e.forEach(e=>i(e));let l=e=>{".DS_Store"!==e.name&&i(e,e=>n({page:"files",fileId:e}))},r=e=>{(0,B.vV)("explorer-drop-zone:file-upload",e),ec.oR.error(s("files-extract-error","Error when processing file"))};for(let e=0;e<a.length;e++){let t=a[e].webkitGetAsEntry();t&&function e(t,s,a){t.isFile?t.file(s,a):t.isDirectory&&t.createReader().readEntries(t=>{for(let l of t)e(l,s,a)},a)}(t,l,r)}},[s,i,n]),o=(0,eg.t)({ref:l,onDrop:r});return(0,a.jsx)(eg.u,{ref:l,dragState:o,title:s("explorer-dropzone.title","Drop files to upload"),className:t})}var ej=s(92372),eb=s(41284),ey=s(17014);let ew=(0,z.A)("ArrowDownNarrowWide",[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 20V4",key:"1yoxec"}],["path",{d:"M11 4h4",key:"6d7r33"}],["path",{d:"M11 8h7",key:"djye34"}],["path",{d:"M11 12h10",key:"1438ji"}]]);var eN=s(86565),eI=s(17779),ek=s(36512);let eC=(0,z.A)("FolderUp",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}],["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"m9 13 3-3 3 3",key:"1pxg3c"}]]),eE=(0,v.memo)(e=>{let{children:t}=e,{t:s}=(0,j.Bd)("files"),l=(0,m.R)(e=>e.createAsset),i=(0,f.useStatsigClient)(),{push:n}=(0,S.wK)(),r=(0,eN.KR)(),{ENABLE_IMAGE_EDITOR_IN_FILES:o,ENABLE_XLSX_EDITING:c}=(0,V.h)(),u=(0,v.useRef)(null),x=(0,m.R)(e=>e.uploadAsset),h=(0,v.useCallback)(e=>n({page:"files",fileId:e}),[n]),p=(0,v.useCallback)(e=>{l(e,h),i.logEvent("files.create-file",e)},[l,h,i]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(k.rI,{children:[(0,a.jsx)(k.ty,{asChild:!0,children:t||(0,a.jsxs)(d.$n,{variant:"filledSecondary",size:"iconSm",rounded:!0,className:"flex-shrink-0",children:[(0,a.jsx)(ea.A,{size:"16"}),(0,a.jsx)("span",{className:"sr-only",children:s("files-add-button.label","Add new file")})]})}),(0,a.jsxs)(k.SQ,{align:"start",alignOffset:-8,sideOffset:8,className:"min-w-[160px]",children:[(0,a.jsx)(eS,{fileTypeId:"markdown",onSelect:p}),c&&(0,a.jsxs)(k._2,{onSelect:()=>{p(r.spreadsheet.newFileName)},children:[(0,v.createElement)(r.spreadsheet.Icon,{className:"me-2 text-secondary",size:16}),r.spreadsheet.name]}),(0,a.jsxs)(k._2,{onSelect:()=>{p(r.html.newFileName)},children:[(0,a.jsx)(ej.fC,{size:16,className:"me-2 text-secondary"}),s("empty.webpage","Webpage")]}),(0,a.jsxs)(k._2,{onSelect:()=>{p(r.html.newFileName)},children:[(0,a.jsx)(eI.A,{size:16,className:"me-2 text-secondary"}),s("empty.game","Game")]}),o&&(0,a.jsxs)(k._2,{onSelect:()=>n({page:"files",fileId:null,emptyView:"image"}),children:[(0,a.jsx)(ej.XG,{size:16,className:"me-2 text-secondary"}),s("files-add-image","Image")]}),(0,a.jsxs)(k.lv,{children:[(0,a.jsxs)(k.nV,{children:[(0,a.jsx)(ek.A,{size:16,className:"me-2 text-secondary"}),s("files-add-code","Code")]}),(0,a.jsx)(k.dc,{children:(0,a.jsx)(k.M5,{sideOffset:12,alignOffset:-4,className:"min-w-[140px]",children:eN.cC.map(e=>(0,a.jsx)(eS,{fileTypeId:e,disableIcons:!0,onSelect:p},e))})})]}),(0,a.jsx)(k.mB,{className:"bg-border-l1 mx-2"}),(0,a.jsxs)(k._2,{onSelect:()=>{u.current&&u.current.click()},children:[(0,a.jsx)(eC,{size:16,className:"me-2 text-secondary"}),s("files-menu-upload.label","Upload Files")]})]})]}),(0,a.jsx)("input",{type:"file",ref:u,className:"hidden",onChange:e=>{e.target.files&&(Array.from(e.target.files).forEach(e=>{x(e,h)}),e.target.value="")},multiple:!0})]})});function eS(e){let{fileTypeId:t,onSelect:s,disableIcons:l}=e,{Icon:i,name:n,newFileName:r}=(0,eN.KR)()[t];return(0,a.jsxs)(k._2,{onSelect:()=>s(r),children:[l?null:(0,a.jsx)(i,{size:16,className:"me-2 text-secondary"}),n]})}var eA=s(97377);function ez(e){let{className:t,onClose:s,onBlur:l,...i}=e,{t:n}=(0,j.Bd)("files"),r=(0,u.cn)("rounded-full shadow-none border border-border ps-9 h-8 focus:ring-0",t),o=(0,v.useCallback)(e=>{null==l||l(e),""===e.target.value&&(null==s||s())},[l,s]);return(0,a.jsxs)("div",{className:"relative flex flex-1",children:[(0,a.jsx)(eA.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground",size:16}),(0,a.jsx)(C.p,{placeholder:n("files-search-input.placeholder","Search"),className:r,onBlur:o,...i})]})}function eR(){var e,t;let{t:s}=(0,j.Bd)("files"),l=(0,S.wK)(),{push:i,replace:n}=l,r="files"===l.route.page?l.route:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";throw Error(e)}("Only use Header in /files"),o=(0,G.wV)(),[c,f]=(0,v.useState)(null!=(e=r.search)?e:""),[x,h]=(0,v.useState)(null!=(t=r.search)&&t),[g,b]=(0,v.useState)(!1),y=(0,E.o)(c,500);(0,v.useEffect)(()=>{n({page:"files",search:y})},[y,n]),(0,v.useEffect)(()=>{r.search||(b(!1),f(""))},[r.search]);let w=e=>{e.stopPropagation(),e.preventDefault(),b(!1),f(""),i({page:"files",sort:null,createdBy:null,fileType:null,search:""})},N="files"===r.page&&r.sort||null,I=e=>{i({page:"files",sort:e})},C="files"===r.page&&r.createdBy||null,A=e=>{i({page:"files",createdBy:e})},z="files"===r.page&&r.fileType||null,R=e=>{i({page:"files",fileType:e})},M=()=>{f(""),h(!1)},P=(0,v.useMemo)(()=>[{label:(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(eb.e,{className:"w-6 h-6",textClassName:"!text-[10px]",user:o.user}),(0,a.jsx)(j.x6,{ns:"base",i18nKey:"file-browser.sort.creator-human",defaults:"Me"})]}),value:"user"},{label:(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(ey.Qtr,{size:"x-small",className:"w-6 h-6"}),(0,a.jsx)(j.x6,{ns:"base",i18nKey:"file-browser.sort.creator-grok",defaults:"Grok"})]}),value:"grok"}],[o.user]),T=[{value:"image",label:s("files-filter-images","Images"),icon:ej.xf},{value:"document",label:s("files-filter-documents","Documents"),icon:ej.py},{value:"spreadsheet",label:s("files-filter-spreadsheets","Spreadsheets"),icon:ej.Kb},{value:"code",label:s("files-filter-code","Code"),icon:ej.lo},{value:"pdf",label:s("files-filter-pdf","PDF"),icon:ej.yT}];return(0,a.jsxs)("header",{className:"flex flex-col gap-4 pb-1 @container",children:[(0,a.jsxs)("div",{className:"flex gap-2 pt-0.5",children:[(0,a.jsx)("div",{className:"flex-1 relative",children:(0,a.jsx)(_.N,{mode:"sync",children:x?(0,a.jsx)(p.P.div,{initial:{width:"32px",height:"32px",opacity:0},animate:{width:"100%",height:"auto",opacity:1},exit:{width:"32px",height:"32px",opacity:0},transition:{duration:.1,ease:"easeOut"},className:"flex justify-end items-center gap-2 absolute top-0 end-0",children:(0,a.jsx)(ez,{value:c,onChange:e=>{f(e.target.value)},autoFocus:!0,className:"flex-1",onKeyDown:e=>{"Escape"===e.key&&M()},onClose:M})},"search-input"):(0,a.jsxs)(p.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.1,ease:"easeOut"},className:"flex justify-between",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:(0,a.jsx)(S.N_,{route:{page:"files",fileId:null},children:s("files-explorer-header","Files")})}),(0,a.jsxs)("div",{className:"flex gap-1",children:[(0,a.jsx)(d.$n,{variant:"ghost",size:"iconSm",rounded:!0,"aria-label":s("files-explorer-collapse-button","Collapse"),onClick:()=>m.R.getState().setIsFileExplorerCollapsed(!0),children:(0,a.jsx)(ej.KD,{size:15,className:"text-fg-secondary"})}),(0,a.jsxs)(d.$n,{variant:"ghost",size:"iconSm",rounded:!0,onClick:()=>h(!0),children:[(0,a.jsx)(ej.WI,{size:15,className:"text-fg-secondary"}),(0,a.jsx)("span",{className:"sr-only",children:s("files-search-open-button.label","Show search input")})]})]})]},"title-and-button")})}),(0,a.jsx)(eE,{})]}),(0,a.jsxs)("div",{className:"flex gap-2 overflow-x-auto no-scrollbar py-0.5",children:[(0,a.jsxs)(k.rI,{open:g,onOpenChange:b,children:[(0,a.jsxs)("div",{className:(0,u.cn)("flex items-center rounded-full border gap-0.5 border-border-l2 h-8 overflow-hidden flex-shrink-0",z&&"bg-button-ghost-hover border-secondary pr-0"),children:[(0,a.jsx)(k.ty,{asChild:!0,children:(0,a.jsxs)(d.$n,{variant:"ghost",size:"sm",className:(0,u.cn)("border-0  flex-shrink-0",z&&"pr-0 hover:bg-transparent"),style:{boxShadow:"none"},children:[(0,a.jsx)(ej.YG,{size:16,className:"text-fg-secondary"}),(0,a.jsx)("span",{className:"sr-only",children:s("files-filter-open-button.label","Show filters")}),(0,a.jsx)("span",{className:"hidden @[160px]:inline-block",children:s("files-filter-show-menu","Filter")})]})}),z?(0,a.jsxs)(d.$n,{variant:"ghost",size:"iconSm",onClick:w,rounded:!0,children:[(0,a.jsx)(ej.uv,{size:16}),(0,a.jsx)("span",{className:"sr-only",children:s("files-filter-clear","Clear all filters")})]}):null]}),(0,a.jsxs)(k.SQ,{side:"bottom",align:"start",sideOffset:6,className:"no-a11y-check rounded-2xl",children:[(0,a.jsxs)("div",{className:"min-w-36 flex gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs text-secondary ms-3 my-2",children:s("files-filter-by-type","File Type")}),T.map(e=>{let t=e.icon;return(0,a.jsxs)(k._2,{onSelect:()=>R(e.value),className:"flex items-center gap-2",children:[(0,a.jsx)(t,{size:16,className:"text-fg-secondary"}),e.label,z===e.value&&(0,a.jsx)("span",{className:"ms-auto text-xs text-primary",children:"✓"})]},e.value||"all")})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs text-secondary ms-3 my-2 min-w-32",children:s("files-filter-by-creator","Created By")}),P.map(e=>(0,a.jsxs)(k._2,{onSelect:()=>A(e.value),className:"flex items-center gap-2",children:[e.label,C===e.value&&(0,a.jsx)("span",{className:"ms-auto text-xs text-primary",children:"✓"})]},"CREATOR_OPTIONS"+e.value.toString()))]})]}),(c||z||C)&&(0,a.jsx)(d.$n,{variant:"outline",onClick:w,className:"w-full mt-4 rounded-xl",children:s("files-filter-reset","Reset filters")})]})]}),(0,a.jsxs)(k.rI,{children:[(0,a.jsx)(k.ty,{asChild:!0,children:(0,a.jsxs)(d.$n,{variant:"outline",size:"sm",rounded:!0,className:" flex-shrink-0",children:[(0,a.jsx)(ew,{size:15,className:"text-fg-secondary"}),(0,a.jsx)("span",{className:"sr-only",children:s("files-sort-show-menu","Show sorting menu")}),(0,a.jsx)("span",{className:"hidden @[160px]:inline-block",children:s("files-sort-show-menu","Sort")})]})}),(0,a.jsx)(k.SQ,{side:"bottom",align:"start",sideOffset:6,className:"min-w-36",children:O.map(e=>(0,a.jsxs)(k._2,{onSelect:()=>I(e.value),className:"flex items-center gap-2",children:[e.label,N===e.value&&(0,a.jsx)("span",{className:"ms-auto text-xs text-primary",children:"✓"})]},e.value))})]}),(0,a.jsx)(eM,{})]})]})}let eM=(0,v.memo)(function(){let e=(0,m.R)(e=>"loading"===e.listStatus);return(0,a.jsx)(_.N,{children:e&&(0,a.jsx)(p.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15,ease:"easeOut"},className:"flex-1 flex justify-end items-center",children:(0,a.jsx)($.y,{size:"xs",className:"border-b-secondary"})})})});var eP=s(83638),e_=s(51182);function eT(e){let{onRetry:t}=e,{t:s}=(0,j.Bd)("files");return(0,a.jsxs)("div",{className:"border border-l1 bg-surface-l1 rounded-2xl p-4 flex flex-col items-center justify-center text-center",children:[(0,a.jsx)("h3",{className:"text-sm font-semibold mb-2",children:s("files-list-loading-error.title","Could not load files")}),(0,a.jsx)("p",{className:"text-xs text-fg-secondary mb-4",children:s("files-list-loading-error.message","Something went wrong while loading your files")}),(0,a.jsxs)(d.$n,{variant:"outline",size:"md",onClick:t,children:[(0,a.jsx)(es.A,{className:"h-4 w-4 text-secondary"}),s("files-list-loading-error.retry","Retry")]})]})}var eD=s(6085);function eB(e){let{onFiltersClear:t}=e,{t:s}=(0,j.Bd)("files");return(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full gap-4 overflow-hidden",children:[(0,a.jsx)("p",{className:"text-muted-foreground truncate",children:s("files-no-results.label","No results")}),(0,a.jsxs)(d.$n,{variant:"outline",size:"md",onClick:()=>{null==t||t()},children:[(0,a.jsx)(eD.A,{className:"size-4 text-secondary"}),(0,a.jsx)("span",{className:"truncate",children:s("files-clear-filters.label","Clear filters")})]})]})}var eF=s(66347),eO=s(93038);function eU(e){var t;let{asset:s,stack:l,className:i}=e,o=(0,v.useRef)(!l.length);return l.length?(0,a.jsx)("div",{className:(0,u.cn)("relative",i),children:(0,a.jsxs)(_.N,{initial:o.current,children:[(0,a.jsx)(p.P.div,{animate:{x:-2,y:2,rotate:-8},transition:{delay:.2,duration:1},children:(0,a.jsx)(n.E,{metadata:(0,r.B)(s),className:"rounded-md w-6 h-6 ms-0 me-0 [&>img]:h-full [&>img]:w-full bg-surface-l1 border border-white"})},s.assetId),(0,a.jsx)(p.P.div,{animate:{x:2,y:-2,rotate:8},transition:{duration:2},className:"absolute inset-0 -z-10",children:(0,a.jsx)(n.E,{metadata:(0,r.B)(l[0]),className:"rounded-md w-6 h-6 ms-0 me-0 [&>img]:h-full [&>img]:w-full bg-surface-l1 border border-white"})},null==(t=l[0])?void 0:t.assetId)]})}):(0,a.jsx)(n.E,{metadata:(0,r.B)(s),className:"rounded-md w-6 h-6 ms-0 me-0 [&>img]:h-full [&>img]:w-full bg-surface-l1 border border-white"})}var eL=s(82263);function eW(e){let{okLabel:t,onOk:s,cancelLabel:l,onCancel:i}=e;return(0,a.jsxs)("div",{className:(0,u.cn)("flex","items-center justify-end gap-0.5"),children:[(0,a.jsxs)(d.gx,{variant:"ghost",size:"iconSm",rounded:!0,onClick:i,tooltipContent:l,tooltipContentProps:{hideWhenDetached:!0},children:[(0,a.jsx)(ej.uv,{size:16,className:"text-fg-primary"}),(0,a.jsx)("span",{className:"sr-only",children:l})]}),(0,a.jsxs)(d.gx,{variant:"ghost",size:"iconSm",rounded:!0,onClick:s,tooltipContent:t,tooltipContentProps:{hideWhenDetached:!0},children:[(0,a.jsx)(eL.A,{size:16,className:"text-fg-primary"}),(0,a.jsx)("span",{className:"sr-only",children:l})]})]})}var eG=s(80354);let eH=(0,v.memo)(function(e){let{value:t,onSubmit:s,onCancel:l,state:i,suffix:n,className:r}=e,{t:o}=(0,j.Bd)("files"),[d,c]=(0,v.useState)(t),m=(0,v.useRef)(null);(0,v.useEffect)(()=>{c(t)},[t]),(0,v.useEffect)(()=>{"edit"===i&&m.current&&(m.current.focus(),m.current.setSelectionRange(0,m.current.value.lastIndexOf(".")))},[i]);let f=()=>{s(d.trim())},x=e=>{e.preventDefault(),e.stopPropagation(),f()};if("edit"===i)return(0,a.jsxs)("div",{className:"flex flex-1",onClick:eG.Y,children:[(0,a.jsx)("input",{ref:m,className:"w-full bg-transparent focus-visible:outline-none",value:d,onKeyDown:e=>{"Enter"===e.key?f():"Escape"===e.key&&l()},onChange:e=>c(e.target.value),"aria-label":o("filename-edit-input.label","Edit file name")}),(0,a.jsx)(eW,{onCancel:e=>{e.preventDefault(),e.stopPropagation(),l()},cancelLabel:o("Cancel","Cancel"),onOk:e=>{e.preventDefault(),e.stopPropagation(),x(e)},okLabel:o("Save","Save")})]});let h=(0,u.cn)("flex-1 select-none text-nowrap max-w-full overflow-hidden inline-block",r);return(0,a.jsxs)("span",{className:h,style:{maskImage:X.uU,WebkitMaskImage:X.uU},children:[t,n&&(0,a.jsx)("span",{className:"text-fg-tertiary",children:n})]})}),e$=e=>(0,a.jsx)("span",{className:"font-bold",children:e}),eK=e=>{let{text:t,pattern:s,renderMatch:l=e$}=e,i=(0,v.useMemo)(()=>{let e=s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),a=RegExp("(".concat(e,")"),"gi");return t.split(a)},[t,s]);return(0,a.jsx)(a.Fragment,{children:i.map((e,t)=>e.toLowerCase()===s.toLowerCase()&&l?(0,a.jsx)(v.Fragment,{children:l(e)},t):(0,a.jsx)(v.Fragment,{children:e},t))})};function eV(e){let{assetId:t}=e,s=(0,m.R)(e=>e.debouncedSearchQuery),l=(0,m.R)(e=>{var a,l;return null!=(l=null==(a=e.searchHighlight[s])?void 0:a[t])?l:""});return l&&s?(0,a.jsx)("div",{className:"px-3 mb-2 text-xs text-fg-secondary text-start max-w-full text-wrap line-clamp-3 leading-normal max-h-[4.5em]",children:(0,a.jsx)(eK,{text:l,pattern:s,renderMatch:eq})}):null}let eq=e=>(0,a.jsx)("span",{className:"text-fg-primary font-semibold",children:e});function eX(e){let t=e.lastIndexOf(".");return -1===t?[e,""]:[e.slice(0,t),e.slice(t+1)]}let eZ=(0,v.memo)(function(e){var t,s,l,i,o,c,x;let{asset:p,stackedAssets:g,action:b,onActionChange:y,className:w,isActive:N=!1}=e,{push:I,route:C}=(0,S.wK)(),{t:E}=(0,j.Bd)("base"),A=(0,m.R)((0,e_.k)(e=>e.assetsById)),z=(0,f.useStatsigClient)(),[,R]=eX(null!=(s=p.name)?s:""),M=null!=(i=null!=R?R:(0,eO.extension)(null!=(l=p.mimeType)?l:""))?i:"",P=(null==b?void 0:b.type)==="edit"&&(null==b?void 0:b.assetId)===p.assetId,_=(null==b?void 0:b.type)==="delete"&&(null==b?void 0:b.assetId)===p.assetId,T=(0,m.R)(e=>e.renameAsset),D=(0,v.useMemo)(()=>g.map(e=>{var t;return null==(t=A[e])?void 0:t.data}).filter(Boolean).sort((e,t)=>new Date((null==e?void 0:e.createTime)||"").getTime()-new Date((null==t?void 0:t.createTime)||"").getTime())||[],[g,A]),F=(0,v.useCallback)(()=>{y(null)},[y]),O=(0,v.useCallback)(e=>{var t,s,a,l;let i=null==(s=A[p.rootAssetId||p.assetId])||null==(t=s.data)?void 0:t.sourceConversationId,n=null!=(l=null!=(a=p.rootAssetSourceConversationId)?a:i)?l:p.sourceConversationId;n&&(e.stopPropagation(),e.preventDefault(),I({page:"chat",conversationId:n,temporary:!1}))},[p.rootAssetSourceConversationId,p.rootAssetId,p.assetId,p.sourceConversationId,A,I]),U=(0,v.useCallback)(e=>{e.stopPropagation(),e.preventDefault(),y({type:"delete",assetId:p.assetId})},[p.assetId,y]),L=(0,v.useCallback)(e=>{e.stopPropagation(),e.preventDefault(),F()},[F]),W=(0,m.R)(e=>e.deleteAsset),G=async e=>{var t;e.stopPropagation(),e.preventDefault(),y(null),await W(null!=(t=p.assetId)?t:""),z.logEvent("files.delete",p.assetId),(null==g?void 0:g.length)&&await Promise.all(g.map(e=>(z.logEvent("files.delete",e),W(e)))),"files"===C.page&&(C.fileId===p.rootAssetId||C.fileId===p.assetId)&&I({page:"files",fileId:null})},H=(0,u.cn)("flex py-0 gap-1 relat justify-start items-center w-full overflow-hidden group/file hover:bg-button-ghost-hover min-h-10 h-auto items-stretch",{"bg-button-ghost-active":N},w);return(0,a.jsx)(d.$n,{variant:"ghost",className:H,asChild:!0,children:(0,a.jsxs)(S.N_,{route:{page:"files",fileId:null!=(c=null!=(o=p.rootAssetId)?o:p.assetId)?c:null},className:(0,u.cn)("group/file text-sm","w-full flex flex-col justify-center !gap-0 text-primary ps-0 pe-1"),children:[(0,a.jsxs)("div",{className:"w-full flex flex-row gap-2 text-primary ps-2 items-center min-h-10",children:[(null==(t=p.mimeType)?void 0:t.startsWith("image/"))?(0,a.jsx)(eU,{asset:p,stack:D,className:"w-fit h-fit"}):(0,a.jsx)(n.E,{metadata:(0,r.B)(p),className:"rounded-md w-6 h-6 ms-0 me-0 [&>img]:h-full [&>img]:w-full bg-transparent"}),(0,a.jsx)(eH,{value:null!=(x=p.name)?x:"",onCancel:F,onSubmit:e=>{var t;y(null),""!==e&&(T(null!=(t=p.assetId)?t:"",e).catch((0,B.HX)("FileRow")),z.logEvent("files.rename",e))},state:P?"edit":"view"}),P?null:_?(0,a.jsx)(eW,{onCancel:L,cancelLabel:E("Cancel","Cancel"),onOk:G,okLabel:E("Delete","Delete")}):(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:(0,u.cn)("hidden group-hover/file:hidden group-focus-visible/file:hidden","text-fg-secondary"),children:M}),(0,a.jsxs)("div",{className:(0,u.cn)("flex items-center justify-end"),children:[(0,a.jsxs)(k.rI,{children:[(0,a.jsx)(k.ty,{asChild:!0,children:(0,a.jsxs)(d.gx,{tabIndex:-1,className:(0,u.cn)("text-fg-secondary",p.isRootAssetCreatedByModel?"w-8":"w-0","group-hover/file:w-8 group-focus-visible/file:w-8 group-hover/file:flex group-focus-visible/file:flex"),variant:"ghost",size:"iconSm",rounded:!0,style:{boxShadow:p.isRootAssetCreatedByModel?"none":void 0},tooltipContent:E("files-more-options.label","Options"),tooltipContentProps:{hideWhenDetached:!0,side:"bottom"},children:[p.isRootAssetCreatedByModel?(0,a.jsx)(ey.Qtr,{size:16,className:(0,u.cn)("opacity-20 group-hover/file:hidden group-focus-visible/file:hidden")}):null,(0,a.jsx)(eF.A,{size:16,className:"hidden group-hover/file:block group-focus-visible/file:block"}),(0,a.jsx)("span",{className:"sr-only",children:E("files-more-options.label","Options")})]})}),(0,a.jsxs)(k.SQ,{side:"bottom",align:"end",className:"min-w-36",children:[(0,a.jsxs)(k._2,{onSelect:e=>{e.preventDefault(),y({type:"edit",assetId:p.assetId})},className:"flex items-center gap-2",children:[(0,a.jsx)(ej.rZ,{size:16,className:"text-fg-secondary"}),E("files.rename","Rename")]}),p.isRootAssetCreatedByModel&&(0,a.jsxs)(k._2,{onClick:e=>{O(e)},className:"flex items-center gap-2",children:[(0,a.jsx)(en.A,{size:16,className:"text-fg-secondary"}),E("files.open-conversation","Open Conversation")]})]})]}),(0,a.jsxs)(d.gx,{tabIndex:-1,className:(0,u.cn)("text-fg-secondary","hidden group-hover/file:flex group-focus-visible/file:flex"),onClick:U,variant:"ghost",size:"iconSm",rounded:!0,tooltipContent:E("files-list-delete.tooltip","Delete file"),tooltipContentProps:{hideWhenDetached:!0},children:[(0,a.jsx)(h.A,{size:16}),(0,a.jsx)("span",{className:"sr-only",children:E("files-list-delete","Delete file")})]})]})]})]}),(0,a.jsx)(eV,{assetId:p.assetId})]})})});var eQ=s(69358),eY=s(80226);function eJ(){return(0,a.jsx)(eQ.P,{delayMs:300,children:(0,a.jsxs)("div",{className:"flex flex-col gap-4 p-3","aria-busy":"true",children:[(0,a.jsx)(e0,{className:"w-1/5"}),(0,a.jsx)(e0,{className:"w-3/5"}),(0,a.jsx)(e0,{className:"w-2/5"}),(0,a.jsx)(e0,{className:"w-1/5"}),(0,a.jsx)(e0,{className:"w-2/3"})]})})}let e0=e=>{let{className:t}=e;return(0,a.jsxs)("div",{className:"flex w-full gap-3 items-center",children:[(0,a.jsx)(eY.E,{className:"w-6 h-6 rounded-md"}),(0,a.jsx)(eY.E,{className:(0,u.cn)("w-full rounded-xl h-4",t)})]})};function e1(){let{t:e}=(0,j.Bd)("files");return(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full gap-4 text-muted-foreground",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-center",children:e("files-empty.title","No files yet")}),(0,a.jsx)("p",{className:"text-center",children:e("files-empty.subtitle","Upload files or ask Grok to create one")}),(0,a.jsx)(eE,{children:(0,a.jsxs)(d.$n,{variant:"outline",size:"sm",children:[(0,a.jsx)(ea.A,{className:"size-4"}),e("files-empty.add-button","Add File")]})})]})}let e2=(0,v.memo)(e=>{let{className:t}=e,{t:s}=(0,j.Bd)("files"),l=(0,S.wK)(),i=l.push,n="files"===l.route.page?l.route:(0,A.Z)("Files list only for /files"),[r,o]=(0,v.useState)(null),d=(0,m.R)(e=>e.loadFirstPage),c=(0,m.R)(e=>e.loadNextPage),x=(0,m.R)(e=>e.listPageToken),h=(0,f.useStatsigClient)();(0,v.useEffect)(()=>{d({search:n.search,sort:n.sort,fileType:n.fileType,createdBy:n.createdBy}),n.search&&h.logEvent("files.search"),n.sort&&"used"!==n.sort&&h.logEvent("files.sort",n.sort),(n.fileType||n.createdBy)&&h.logEvent("files.filter")},[d,n,h]);let g=(0,m.R)(e=>!!(e.debouncedSearchQuery||e.searchFileType||e.source)),b=(0,m.R)((0,e_.k)(e=>e.list)),y=(0,m.R)((0,e_.k)(e=>e.listStatus)),w=(0,m.R)((0,e_.k)(e=>e.assetsById)),I=(0,m.R)((0,e_.k)(e=>e.currentVersion)),k=(0,v.useMemo)(()=>b.map(e=>{var t;return null==(t=w[e])?void 0:t.data}).filter(A.O),[b,w]),C=(0,v.useMemo)(()=>{let e=k.reduce((e,t)=>{var s;return(null==(s=t.mimeType)?void 0:s.startsWith("image/"))&&t.sourceConversationId&&(e[t.sourceConversationId]||(e[t.sourceConversationId]=[]),e[t.sourceConversationId].push(t.assetId)),e},{});return k.map(t=>{var s;let a=[];if((null==(s=t.mimeType)?void 0:s.startsWith("image/"))&&t.currentConversationId){let s=e[t.currentConversationId];s&&a.push(...s)}return{rootAsset:t,children:a}})},[k]),E=(0,v.useMemo)(()=>{let e=new Set(C.flatMap(e=>e.children.filter(t=>t!==e.rootAsset.assetId)));return b.filter(t=>!e.has(t))},[b,C]),z=(0,m.R)(e=>e.creationRequests),R=(0,v.useCallback)(()=>{x&&"loading"!==y&&c()},[y,c,x]),M=(0,eP.B)(R),P=null;if("loading"===y&&!x&&0===b.length)return(0,a.jsx)(eJ,{});"ready"===y?0===b.length?P=g?(0,a.jsx)(eB,{onFiltersClear:()=>{i({...n,sort:void 0,createdBy:void 0,fileType:void 0,search:""})}}):(0,a.jsx)(e1,{}):x&&(P=(0,a.jsx)("div",{ref:M,className:"text-center mt-8 text-sm text-fg-secondary",children:s("files-scrollto.label","Scroll to load more")})):"loading"===y?x&&(P=(0,a.jsx)(eJ,{})):"error"===y&&(P=(0,a.jsx)(eT,{onRetry:d}));let T=(0,u.cn)("gap-0 py-1.5",t);return(0,a.jsxs)(N.D,{className:T,fadeSize:"md","aria-busy":"loading"===y,children:[(0,a.jsx)("ol",{children:z.filter(e=>!e.assetId||!w[e.assetId]).map(e=>(0,a.jsx)(p.P.li,{initial:{height:0,scaleY:0,opacity:0},animate:{height:"auto",scaleY:1,opacity:1},transition:{duration:.15},children:(0,a.jsx)(e3,{request:e})},e.name))}),(0,a.jsx)("ol",{children:(0,a.jsx)(_.N,{children:E.map(e=>{var t,s;let l=null==(t=w[I[e]])?void 0:t.data;return l?(0,a.jsx)(p.P.li,{initial:{height:"auto",scaleY:1,opacity:1},exit:{height:0,scaleY:0,opacity:0},transition:{duration:.15},children:(0,a.jsx)(eZ,{asset:l,stackedAssets:(null==(s=C.find(t=>t.rootAsset.assetId===e))?void 0:s.children)||[],action:r,onActionChange:o,isActive:n.fileId===e||z.some(t=>t.assetId===e)})},e):null})})}),P]})});function e3(e){var t;let{request:s}=e,[l,i]=eX(null!=(t=s.name)?t:"");return(0,a.jsxs)("div",{className:"h-[42px] rounded-xl px-3.5 text-sm p-4 flex items-center bg-button-ghost-active",children:[(0,a.jsx)($.y,{size:"xs",className:"me-[11px]"}),(0,a.jsx)("span",{children:l}),i&&(0,a.jsxs)("span",{className:"text-fg-secondary",children:[".",i]})]})}function e4(e){let{className:t}=e;return(0,a.jsxs)("div",{className:(0,u.cn)("flex flex-col",t),children:[(0,a.jsx)("div",{className:"px-4 pt-4",children:(0,a.jsx)(eR,{})}),(0,a.jsxs)("div",{className:"flex-1 overflow-hidden relative",children:[(0,a.jsx)(e2,{className:"h-full px-2"}),(0,a.jsx)(ev,{className:"m-2"})]})]})}var e6=s(5663),e5=s(33231),e8=s(91631),e7=s(10953),e9=s(5828);function te(e){let{className:t,buttonText:s,multiple:l=!0}=e,{t:i}=(0,j.Bd)("files"),n=(0,v.useRef)(null),r=(0,u.cn)("flex items-center @xs:flex-col @xs:items-start @xs:justify-between h-auto p-3 rounded-2xl min-w-32 bg-surface-l1 border-border-l1",t),o=(0,m.R)(e=>e.uploadAsset),{push:c}=(0,S.wK)(),f=(0,v.useCallback)(e=>c({page:"files",fileId:e}),[c]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d.$n,{variant:"outline",className:r,onClick:()=>{n.current&&n.current.click()},disabled:!1,children:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eC,{className:"w-6 h-6 stroke-[1.5] text-secondary"}),(0,a.jsx)("span",{children:s||i("file-upload-button.label","Upload Files")})]})}),(0,a.jsx)("input",{type:"file",ref:n,style:{display:"none"},onChange:e=>{e.target.files&&(Array.from(e.target.files).forEach(e=>{o(e,f)}),e.target.value="")},multiple:l})]})}let tt="w-6 h-6 text-secondary stroke-[1.5]",ts=(0,v.memo)(e=>{let{className:t}=e,{ENABLE_IMAGE_EDITOR_IN_FILES:s,ENABLE_XLSX_EDITING:l}=(0,V.h)(),{t:i}=(0,j.Bd)("files"),{push:n}=(0,S.wK)(),r=(0,eN.KR)(),o=(0,f.useStatsigClient)(),d=(0,m.R)(e=>e.createAsset),c=(0,v.useCallback)((e,t)=>{d(e,t),o.logEvent("files.create-file",e)},[d,o]),x=e=>n({page:"files",fileId:e});return(0,a.jsxs)("div",{className:"h-full relative",children:[(0,a.jsx)(e9.e,{className:"absolute top-4 left-4"}),(0,a.jsxs)(p.P.div,{initial:{opacity:0},animate:{opacity:1},className:(0,u.cn)("flex flex-col items-center justify-center h-full p-4 @container",t),children:[(0,a.jsx)(e7.$r,{className:"w-20 h-20 text-muted-foreground"}),(0,a.jsx)("p",{className:"mt-4 text-md text-muted-foreground text-center",children:i("empty.create-something-new","Create something new")}),(0,a.jsxs)("div",{className:"w-full max-w-xl gap-3 mt-6 overflow-wrap items-stretch flex flex-col @xs:items-center @xs:flex-row flex-wrap justify-center ",children:[(0,a.jsx)(ta,{icon:(0,a.jsx)(ej.py,{className:tt}),text:i("empty.document","Document"),onClick:()=>void c(r.markdown.newFileName,x)}),l&&(0,a.jsx)(ta,{icon:(0,v.createElement)(r.spreadsheet.Icon,{className:tt}),text:i("empty.spreadsheet","Spreadsheet"),onClick:()=>void c(r.spreadsheet.newFileName,x)}),(0,a.jsx)(ta,{icon:(0,a.jsx)(ej.fC,{className:tt}),text:i("empty.webpage","Webpage"),onClick:()=>void c(r.html.newFileName,x)}),(0,a.jsxs)(k.rI,{children:[(0,a.jsx)(k.ty,{asChild:!0,children:(0,a.jsx)(ta,{icon:(0,a.jsx)(ej.lo,{className:tt}),text:i("empty.code","Code")})}),(0,a.jsx)(k.SQ,{className:"min-w-36",side:"right",sideOffset:12,children:eN.cC.map(e=>(0,a.jsx)(tl,{fileTypeId:e,disableIcons:!0,onSelect:e=>void c(e,x)},e))})]}),(0,a.jsx)(ta,{icon:(0,a.jsx)(eI.A,{className:tt}),text:i("empty.game","Game"),onClick:()=>void c(r.html.newFileName,x)}),s&&(0,a.jsx)(ta,{icon:(0,a.jsx)(ej.XG,{className:tt}),text:i("empty.image","Image"),onClick:()=>{n({page:"files",fileId:null,emptyView:"image"})}}),(0,a.jsx)(te,{})]}),(0,a.jsx)(ev,{className:"m-4"})]})]})});function ta(e){let{icon:t,text:s,...l}=e;return(0,a.jsxs)(d.$n,{variant:"outline",className:"flex @xs:flex-col items-center justify-center @xs:items-start @xs:justify-between h-auto p-3 rounded-2xl min-w-32 @xs:bg-surface-l1 border-0  @xs:border-border-l1 @xs:border transition-none @xs:transition-colors",...l,children:[t,(0,a.jsx)("span",{children:s})]})}function tl(e){let{fileTypeId:t,onSelect:s,disableIcons:l}=e,{Icon:i,name:n,newFileName:r}=(0,eN.KR)()[t];return(0,a.jsxs)(k._2,{onSelect:()=>s(r),children:[l?null:(0,a.jsx)(i,{size:16,className:"me-2"}),n]})}var ti=s(4878),tn=s(43893),tr=s(44347),to=s(39489),td=s(82591),tc=s(72359),tu=s(28951),tm=s(94870);let tf=e=>{let{className:t}=e;return(0,a.jsx)(p.P.div,{initial:{opacity:0,filter:"blur(4px)"},animate:{opacity:1,filter:"blur(0px)"},transition:{ease:"easeInOut"},className:(0,u.cn)("h-full w-full flex items-center justify-center animate-pulse-lg",t),children:(0,a.jsx)(tm.A,{size:60,strokeWidth:1.3,className:"opacity-30 rotate-[-10deg]"})},"loader")},tx=e=>{let{selectedImage:t,isPeekingParent:s,isFinalImageLoaded:l,setIsFinalImageLoaded:i,isParentImageLoaded:n,setIsParentImageLoaded:r}=e,[o,d]=(0,v.useState)([]),[c,m]=(0,v.useState)(!0),f=(0,v.useMemo)(()=>"streaming"===t.state,[t.state]),x=(0,v.useMemo)(()=>!!(t.generatedImageHeight&&t.generatedImageWidth),[t.generatedImageHeight,t.generatedImageWidth]),h=(0,v.useMemo)(()=>t.generatedImageHeight&&t.generatedImageWidth?t.generatedImageWidth/t.generatedImageHeight:4/3,[t.generatedImageHeight,t.generatedImageWidth]);return(0,v.useEffect)(()=>{(f||!c)&&(null==t?void 0:t.progressMap)?d(t.progressMap):!f&&(null==t?void 0:t.url)?d(e=>[...e,{progress:1,imageUrl:t.url||""}]):d([])},[f,null==t?void 0:t.url,null==t?void 0:t.progressMap,c]),(0,v.useEffect)(()=>{f&&c&&m(!1),f||!l||c||m(!0)},[f,l,c]),(0,a.jsx)("figure",{className:(0,u.cn)("relative group/image w-full max-w-5xl 2xl:max-w-6xl overflow-hidden rounded-lg"),children:(0,a.jsx)(_.N,{mode:"wait",children:f||!c?x?(0,a.jsx)(p.P.div,{initial:{opacity:0,filter:"blur(4px)"},animate:{opacity:1,filter:"blur(0px)"},exit:{opacity:1,filter:"blur(0px)",transition:{delay:1.5}},transition:{ease:"easeInOut"},className:"h-full mx-auto",style:{aspectRatio:h,maxHeight:t.generatedImageHeight},children:(0,a.jsx)(tu.L,{status:"streaming",intermediateResults:o,isModerated:t.isModerated,aspectRatio:h})},"streaming-image"):(0,a.jsx)(tf,{}):(0,a.jsxs)("div",{className:"flex relative items-center justify-center w-full h-full",children:[t.url&&(0,a.jsxs)(a.Fragment,{children:[!l&&(0,a.jsx)(tf,{className:"absolute z-20 inset-0"}),(0,a.jsx)(p.P.img,{variants:{hidden:{opacity:0,filter:"blur(4px)"},visible:{opacity:1,filter:"blur(0px)"}},exit:"hidden",animate:t&&s||!l?"hidden":"visible",transition:{ease:"easeInOut"},src:t.url,alt:"active-image",className:"max-h-full aspect-auto rounded-lg",onLoad:()=>i(!0)},"finished-image")]}),(0,a.jsx)(_.N,{children:!f&&t&&s&&(0,a.jsxs)(p.P.div,{variants:{hidden:{opacity:0,filter:"blur(4px)"},visible:{opacity:1,filter:"blur(0px)"}},initial:"hidden",exit:"hidden",animate:"visible",transition:{ease:"easeInOut"},className:"absolute z-10 w-full h-full flex items-center overflow-hidden",children:[!n&&(0,a.jsx)(tf,{className:"absolute z-20 inset-0"}),(0,a.jsx)(p.P.img,{variants:{hidden:{opacity:0,filter:"blur(4px)"},visible:{opacity:1,filter:"blur(0px)"}},animate:n?"visible":"hidden",src:t.parentImageUrl,alt:"parent-image",className:"max-h-full aspect-auto mx-auto rounded-lg",onLoad:()=>r(!0)},"parent-image")]},"parent-image-container")})]})})})};var th=s(24734),tp=s(70888),tg=s(13884),tv=s(697),tj=s(95088),tb=s(82123),ty=s(59996);let tw=e=>{let{children:t,onUploadImage:s}=e,{t:l}=(0,j.Bd)("base"),n=(0,tp.x)(g.A("fetchUploadFile")),r=(0,tp.x)(g.A("removeByConversationId")),o=(0,i.aP)(g.A("conversationId")),c=(0,th.K)(),u=(0,v.useRef)(null),[m,f]=(0,v.useState)(!1),[x,h]=(0,v.useState)(!1),[b,y]=(0,v.useState)(!1),w=(0,v.useCallback)(()=>{var e;null==(e=u.current)||e.click()},[]),N=(0,v.useCallback)(async(e,t)=>{let a;if(1!==e.length)return void ec.oR.error(l("image-editor.one-upload-allowed","Only a single image file is allowed"));if(!["image/png","image/jpeg","image/jpg","image/webp"].includes(e[0].type))return void ec.oR.error(l("image-editor.images-only-allowed","Only image files are allowed"));h(!0);try{let t=n(e[0],o||"no_conversation_id");a=await t.metadataPromise}catch(e){c("image-editor-upload:uploadFile",e)}a instanceof Error&&c("image-editor-upload:uploadFile",a,l("image-editor.failed-to-upload","Failed to upload file")),h(!1),r(o||"no_conversation_id"),!a||a instanceof Error||s({image:a,type:t})},[l,n,o,s,r,c]),I=(0,v.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),x||f(!0)},[x]),k=(0,v.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),f(!1)},[]),C=(0,v.useCallback)(e=>{if(e.preventDefault(),e.stopPropagation(),f(!1),!x)return N(Array.from(e.dataTransfer.files),"upload")},[N,x]),E=(0,v.useCallback)(e=>{if(e.target.files)return N(Array.from(e.target.files),"upload").finally(()=>{u.current&&(u.current.value="")})},[N]),S=(0,v.useCallback)(async e=>N([e],"draw").finally(()=>{y(!1)}),[N]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(p.P.div,{initial:{opacity:0},animate:{opacity:1},onDragOver:I,onDragLeave:k,onDrop:C,className:"border resize transition-colors w-full h-full flex justify-center items-center border-border-l1 rounded-2xl p-8 mb-3 text-center ".concat(m&&!x&&"bg-surface-l1 border-border-l1"),children:(0,a.jsxs)("div",{className:"flex flex-col items-center gap-4 w-full",children:[(0,a.jsx)("div",{className:"p-4 rounded-full text-fg-secondary transition-colors bg-surface-l1",children:(0,a.jsx)(_.N,{mode:"popLayout",children:m&&!x?(0,a.jsx)(p.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,a.jsx)(tg.A,{className:"size-6"})},"files"):(0,a.jsx)(p.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,a.jsx)(tv.A,{className:"size-6"})},"image-plus")})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-primary",children:l("image-editor.empty.title","Ask Grok to create an image")}),(0,a.jsx)(_.N,{mode:"popLayout",children:x?(0,a.jsx)(p.P.p,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-sm text-fg-secondary whitespace-nowrap",children:l("image-editor.empty.uploading-image","Uploading image")},"uploading"):m?(0,a.jsx)(p.P.p,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-sm text-fg-secondary whitespace-nowrap",children:l("image-editor.empty.drop-image","Drop image here")},"dragging"):(0,a.jsx)(p.P.p,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-sm text-fg-secondary whitespace-nowrap",children:l("image-editor.empty.description","You can also upload an image or draw instead.")},"not-dragging")})]}),t,(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsxs)(d.$n,{variant:"outline",className:"text-fg-primary hover:bg-button-ghost-hover rounded-2xl transition-all py-2.5 px-4 h-auto *:hover:text-fg-primary *:hover:transition-colors",disabled:x,onClick:w,children:[x?(0,a.jsx)($.y,{size:"xxs"}):(0,a.jsx)(tj.A,{className:"size-4 text-fg-secondary"}),l("image-editor.empty.upload","Upload")]}),(0,a.jsxs)(d.$n,{variant:"outline",className:"text-fg-primary hover:bg-button-ghost-hover rounded-2xl transition-all py-2.5 px-4 h-auto *:hover:text-fg-primary *:hover:transition-colors",disabled:x,onClick:()=>{y(!0)},children:[(0,a.jsx)(tb.A,{className:"size-4 text-fg-secondary"}),l("image-editor.empty.draw","Draw")]})]}),(0,a.jsx)("input",{ref:u,className:"hidden",type:"file",accept:"image/png,image/jpeg,image/jpg,image/webp",onChange:E,multiple:!1,"data-testid":"file-input"})]})}),(0,a.jsx)(ty.A,{open:b,setOpen:y,onAttach:S})]})};var tN=s(23856),tI=s(12220);let tk=(0,z.A)("FileDown",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]]);var tC=s(47127);let tE=e=>{let{selectedImage:t,title:s,isSending:l=!1,onRegenerate:n,onClose:r}=e,{t:o}=(0,j.Bd)("base"),[c,u]=(0,v.useState)(!1),m=(0,i.aP)(e=>e.conversationId),f=(0,i.aP)(e=>e.lastMessageId),x=(0,v.useCallback)(()=>{var e;!c&&(null==t?void 0:t.url)&&(u(!0),(0,tI.G)(t.url,null==(e=t.url)?void 0:e.split("/").pop()).catch((0,B.HX)("image-editor:handleDownload")).finally(()=>u(!1)))},[c,t]);return(0,a.jsx)("header",{className:"flex justify-between w-full items-start h-10 gap-3  relative z-30 flex-shrink-0",children:(0,a.jsxs)(_.N,{mode:"popLayout",children:[s&&(0,a.jsx)(p.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},className:"w-full overflow-hidden min-w-0 hidden sm:block",children:s},JSON.stringify(s)),(0,a.jsxs)("div",{className:"flex gap-2 ml-auto shrink-0",children:[(null==t?void 0:t.state)&&["streaming","error","completed"].includes(t.state)&&(null==t?void 0:t.regenResponseId)&&(0,a.jsx)(p.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},children:(0,a.jsx)(d.gx,{size:"iconMd",variant:"ghost",rounded:!0,"aria-label":o("image-editor.regenerate","Regenerate Image"),tooltipContent:o("image-editor.regenerate","Regenerate Image"),tooltipContentProps:{side:"bottom"},asChild:!0,disabled:"streaming"===t.state||l,onClick:n,children:(0,a.jsx)(p.P.button,{whileTap:(null==t?void 0:t.state)==="streaming"||l?void 0:{scale:.9},children:(0,a.jsx)(ej.V$,{className:"size-5"})})})},"regenerate"),t&&(0,a.jsx)(p.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},children:(0,a.jsx)(d.gx,{variant:"ghost",size:"iconMd",rounded:!0,"aria-label":o("image-editor.download-image","Download Image"),tooltipContent:o("image-editor.download-image","Download Image"),tooltipContentProps:{side:"bottom"},disabled:"streaming"===t.state||!t.url||c,onClick:x,children:(0,a.jsx)(tC.p,{children:c?(0,a.jsx)($.y,{size:"xs"}):(0,a.jsx)(tk,{className:"size-5"})},c?"is-downloading":"download-icon")})},"download"),m&&f&&(0,a.jsx)(p.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},children:(0,a.jsx)(tN.w,{variant:"ghost",size:"iconMd",rounded:!0,conversationId:m,responseId:f,iconProps:{size:20}})},"share"),r&&(0,a.jsx)(d.$n,{"aria-label":o("iamge-editor.close","Close Image Editor"),variant:"ghostSecondary",size:"iconMd",rounded:!0,onClick:r,children:(0,a.jsx)(ej.uv,{size:20})})]})]})})},tS=e=>{let{images:t,selectedImageId:s,onSelect:l}=e,i=(0,v.useRef)(null),n=(0,v.useRef)(null),r=(0,v.useRef)(0),o=(e,t)=>{let s={left:t.scrollLeft,top:t.scrollTop,right:t.scrollLeft+t.clientWidth,bottom:t.scrollTop+t.clientHeight},a={left:e.offsetLeft,top:e.offsetTop,right:e.offsetLeft+e.offsetWidth,bottom:e.offsetTop+e.offsetHeight};return a.left>=s.left&&a.right<=s.right&&a.top>=s.top&&a.bottom<=s.bottom};return(0,v.useEffect)(()=>{if(t.length>0&&i.current&&s){let e=i.current,t=e.querySelector('[data-image-id="'.concat(s,'"]'));t&&!o(t,e)&&t.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})}},[t.length,s,t]),(0,v.useEffect)(()=>{let e=e=>{if(0===t.length||!s||document.activeElement&&("INPUT"===document.activeElement.tagName||"TEXTAREA"===document.activeElement.tagName||"DIV"===document.activeElement.tagName))return;let a=t.findIndex(e=>e.id===s);if(-1===a)return;let i=a;switch(e.key){case"ArrowLeft":case"ArrowUp":e.preventDefault(),i=a>0?a-1:t.length-1;break;case"ArrowRight":case"ArrowDown":e.preventDefault(),i=a<t.length-1?a+1:0;break;default:return}let o=Date.now();o-r.current>=150?(r.current=o,l(t[i])):(n.current&&clearTimeout(n.current),n.current=setTimeout(()=>{r.current=Date.now(),l(t[i])},150-(o-r.current)))};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e),n.current&&clearTimeout(n.current)}},[t,s,l]),(0,a.jsx)(p.P.aside,{ref:i,className:"flex @lg:flex-col @lg:max-h-full @lg:w-auto w-fit max-w-full h-auto overflow-auto items-center justify-start gap-2 z-30 px-4 py-1 @lg:px-1 @lg:py-4",variants:{visible:{opacity:1},hidden:{opacity:0}},initial:"hidden",animate:"visible",exit:"hidden",children:(0,a.jsx)(_.N,{mode:"popLayout",children:t.map(e=>(0,a.jsx)(p.P.button,{"data-image-id":e.id,className:(0,u.cn)("size-20 shrink-0 relative rounded-xl border bg-background p-1 pointer-events-auto",{"ring-primary ring-2":e.id===s}),onClick:()=>l(e),whileTap:e.id!==s?{scale:.95}:{},variants:{visible:{opacity:1},hidden:{opacity:0},selected:{scale:1.05,opacity:1,transition:{duration:.15}}},initial:"hidden",animate:e.id===s?"selected":"visible",exit:"hidden",children:(0,a.jsx)("div",{className:"relative h-full w-full overflow-hidden rounded-lg",children:(0,a.jsx)("figure",{className:"absolute -translate-x-1/2 left-1/2 h-full aspect-[4/3] pointer-events-none",children:(0,a.jsx)(tu.L,{isModerated:e.isModerated,status:"streaming"===e.state?"streaming":"finished",iconSize:24,intermediateResults:"streaming"===e.state?e.progressMap:[{progress:1,imageUrl:e.url}]})})})},e.id))})},"image-editor-option-nav")};var tA=s(30693),tz=s(4423),tR=s(43035),tM=s(34500);let tP=e=>{let{selectedImage:t,isSending:s,isStreaming:l,onSend:i}=e,{editImagePresets:n}=(0,tA.F)(),r=(0,q.Di)(),[o,c]=(0,v.useState)(null),[u,m]=(0,v.useState)(null),f=(0,v.useMemo)(()=>!t||l||s,[l,s,t]),x=(0,v.useCallback)(e=>{c(t=>t===e?null:e)},[c]),h=(0,v.useCallback)(e=>{if(t&&!l&&!s)return c(null),i(e.prompt,e.presetId)},[l,t,s,i]),g=(0,v.useCallback)(e=>{let t=document.querySelector('[data-preset-id="'.concat(e,'"]'));if(!t)return{};let s=t.getBoundingClientRect();return s.right+12+200>window.innerWidth?{left:s.left-200-12,top:s.top+(s.height-150)/2}:{left:s.right+12,top:s.top+(s.height-150)/2}},[]);return(0,v.useEffect)(()=>{if(!o||r)return void m(null);let e=()=>{let e=document.body.querySelector("[data-highlighted][data-preset-id]"),t=(null==e?void 0:e.getAttribute("data-preset-id"))||null;t&&m(t)};e();let t=new MutationObserver(e);return t.observe(document.body,{attributes:!0,attributeFilter:["data-highlighted"],subtree:!0}),()=>{t.disconnect()}},[o,r]),(0,a.jsx)("div",{className:"flex w-full xs:justify-center justify-start items-center overflow-x-auto xs:overflow-visible gap-2 xs:gap-3 relative z-30 no-scrollbar",children:n.map((e,t)=>(0,a.jsx)(p.P.div,{variants:{hidden:{opacity:0,y:10},visible:{opacity:1,y:0}},initial:"hidden",animate:"visible",transition:{duration:.15,ease:"easeInOut",delay:.06*t},className:"bg-surface-base rounded-full",children:r?(0,a.jsxs)(tM._s,{open:e.category===o,onOpenChange:t=>{t?c(e.category):c(null)},children:[(0,a.jsx)(tM.Uz,{disabled:f,asChild:!0,children:(0,a.jsx)(t_,{category:e,disabled:f})}),(0,a.jsxs)(tM.zj,{className:"max-h-[90dvh]",children:[(0,a.jsx)(tM.BE,{children:(0,a.jsxs)(tM.gk,{className:"flex items-center justify-center gap-2",children:[e.icon&&v.createElement(e.icon,{size:20,className:"text-secondary flex-shrink-0"}),e.label]})}),(0,a.jsx)("div",{className:"p-2 space-y-2 overflow-auto",children:e.presets.map(e=>(0,a.jsxs)(d.$n,{variant:"ghost",size:"lg",className:"w-full flex items-center justify-start gap-3 h-auto py-3",onClick:()=>h(e),children:[e.icon&&v.createElement(e.icon,{size:18,className:"text-secondary flex-shrink-0"}),(0,a.jsx)("span",{children:e.label})]},e.presetId))})]})]}):(0,a.jsxs)(k.rI,{open:e.category===o,onOpenChange:()=>x(e.category),children:[(0,a.jsx)(k.ty,{disabled:f,asChild:!0,children:(0,a.jsx)(t_,{category:e,disabled:f})}),(0,a.jsx)(k.SQ,{hideWhenDetached:!0,side:"top",sideOffset:8,className:"min-w-60 space-y-0.5",onMouseLeave:()=>{m(null)},onWheel:e=>e.stopPropagation(),onKeyDown:e=>e.stopPropagation(),children:e.presets.map(t=>(0,a.jsxs)(k._2,{"data-preset-id":t.presetId,className:"flex items-center gap-2",onClick:()=>h(t),children:[t.icon&&v.createElement(t.icon,{size:16,className:"text-secondary flex-shrink-0"}),t.label,u===t.presetId&&(0,tR.createPortal)((0,a.jsxs)(p.P.div,{layoutId:"preset-preview",className:"fixed w-[200px] h-[150px] bg-surface-l4 border border-border-l1 rounded-2xl shadow-lg z-50 pointer-events-none flex items-center justify-center p-1.5",style:g(t.presetId),children:[(0,a.jsx)(tf,{className:"absolute inset-0"}),t.previewUrl&&(0,a.jsx)(tz.default,{src:t.previewUrl,alt:t.presetId,width:200,height:150,priority:!r&&o===e.category,className:"w-full h-full object-cover rounded-xl relative z-10"})]}),document.body)]},t.presetId))})]})},e.category))})},t_=v.forwardRef((e,t)=>{let{category:s,disabled:l,...i}=e;return(0,a.jsxs)(d.$n,{ref:t,size:"md",variant:"filledSecondary",rounded:!0,className:(0,u.cn)(!l&&"*:hover:text-primary transition-all"),disabled:l,...i,children:[s.icon&&v.createElement(s.icon,{size:16,className:"flex-shrink-0 text-secondary transition-colors"}),(0,a.jsx)("span",{children:s.label})]})});var tT=s(71090),tD=s(63174),tB=s(30388);let tF=e=>{let{selectedImage:t,isSending:s,isStreaming:l,isWaitingForResponse:i,isAborting:n,inputValue:r,onInputValueChange:o,onSend:d,onAbort:c}=e,{t:m}=(0,j.Bd)("base"),f=(0,v.useRef)(null),x=(0,v.useRef)(null),h=(0,v.useMemo)(()=>l||s||i,[l,s,i]),g=(0,v.useMemo)(()=>!s&&!i&&!l&&!!r.trim(),[s,r,l,i]);(0,v.useEffect)(()=>{if(!h&&x.current){let e=setTimeout(()=>{var e;null==(e=x.current)||e.focus()},50);return()=>clearTimeout(e)}},[h]);let b=(0,v.useCallback)(e=>{var t;e.preventDefault(),!h&&r.trim()&&(d(r),null==(t=x.current)||t.focus())},[d,h,r]),y=(0,v.useCallback)(e=>{if(e.stopPropagation(),"Enter"===e.key&&!e.metaKey&&!e.ctrlKey&&!e.shiftKey&&!e.nativeEvent.isComposing){var t;e.preventDefault(),null==(t=f.current)||t.dispatchEvent(new Event("submit",{cancelable:!0,bubbles:!0}))}},[]);return(0,a.jsxs)("form",{className:(0,u.cn)("w-full rounded-[32px] p-3 bg-surface-l2 shadow shadow-input-border/10 flex gap-2 pl-5 items-end ring-1 ring-input-border ring-inset"),onSubmit:b,ref:f,children:[(0,a.jsx)(_.N,{children:h&&(0,a.jsx)(p.P.div,{initial:{opacity:0},animate:{opacity:1,transition:{duration:.1}},className:"pb-1.5 -ml-0.5",children:(0,a.jsx)(tB.d,{})},"loading-indicator")}),(0,a.jsx)(tD.A,{ref:x,className:(0,u.cn)("w-full @[480px]/input:px-3 bg-transparent focus:outline-none text-primary align-bottom resize-none pb-1.5 transition-all outline-transparent",h&&"animate-pulse"),onChange:e=>o(e.target.value),value:h?"":r,placeholder:h?m("image-editor.generating","Generating"):t?m("image-editor.describe-edits","Describe your edits"):m("image-editor.describe-image","Describe the image you want"),minRows:1,onKeyDown:y,disabled:h,name:"query",maxRows:5}),(0,a.jsx)("div",{className:(0,u.cn)("ml-auto flex flex-row items-end gap-1"),children:h?(0,a.jsx)(p.P.button,{whileTap:{scale:.95},initial:{scale:.95,opacity:1},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:.5,transition:{duration:.2}},className:(0,u.cn)("group flex flex-col justify-center rounded-full focus:outline-none focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring"),disabled:n,onClick:e=>{e.preventDefault(),c()},children:(0,a.jsx)("div",{className:(0,u.cn)("h-9","aspect-square flex flex-col items-center justify-center rounded-full","rounded-full ring-1 ring-inset","bg-primary text-background ring-button-outline-border"),children:(0,a.jsx)(tT.A,{size:20})})}):(0,a.jsx)(p.P.button,{initial:{opacity:.5},animate:{opacity:1,transition:{duration:.1}},whileHover:t?{scale:1.1}:void 0,whileTap:t?{scale:.95}:void 0,className:(0,u.cn)("group flex flex-col justify-center rounded-full focus:outline-none focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring"),type:"submit","aria-label":m("image-editor.submit","Submit"),disabled:!g,children:(0,a.jsx)("div",{className:(0,u.cn)("h-9 relative","aspect-square flex flex-col items-center justify-center","rounded-full ring-1 ring-inset duration-100","before:absolute before:inset-0 before:rounded-full before:bg-primary before:ring-0 before:transition-all duration-500",g?"bg-primary text-background ring-transparent before: before:[clip-path:circle(50%_at_50%_50%)]":"bg-button-secondary text-secondary before:[clip-path:circle(0%_at_50%_50%)] ring-0"),children:(0,a.jsx)(ej.Kp,{size:20,className:"relative"})})})})]})},tO=e=>{let{images:t,selectedImage:s,title:l,inputValue:i,queryBarPosition:n="bottom",onInputValueChange:r,hideHeader:o=!1,hideQueryBar:d=!1,isAborting:c=!1,isSending:m=!1,isStreaming:f=!1,isWaitingForResponse:x=!1,onImageSelect:h,onSendQuery:p,onRegenerate:g,onAbort:b,onImageUpload:y,onClose:w}=e,{t:N}=(0,j.Bd)("base"),[I,k]=(0,tc.Mj)("image-editor-first-open",!0),[C,E]=(0,v.useState)(!1),[S,A]=(0,v.useState)(!1),[z,R]=(0,v.useState)(!1),M=(0,v.useMemo)(()=>(0,a.jsx)(tx,{selectedImage:s,isPeekingParent:C,setIsPeekingParent:E,isParentImageLoaded:S,isFinalImageLoaded:z,setIsFinalImageLoaded:R,setIsParentImageLoaded:A}),[s,C,S,z]),P=(0,v.useMemo)(()=>"center"===n&&!f&&!s&&!x&&!d,[n,f,s,x,d]);return(0,v.useEffect)(()=>{if(null==s?void 0:s.url){R(!1);let e=new Image;e.onload=()=>R(!0),e.src=s.url}},[null==s?void 0:s.url]),(0,v.useEffect)(()=>{if(null==s?void 0:s.parentImageUrl){A(!1);let e=new Image;e.onload=()=>A(!0),e.src=null==s?void 0:s.parentImageUrl}},[null==s?void 0:s.parentImageUrl]),(0,v.useEffect)(()=>{I&&(k(!1),ec.oR.message((0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-fg-primary font-bold",children:N("image-editor-welcome.title","Welcome to Image Editor")}),(0,a.jsx)("p",{className:"text-fg-secondary",children:N("image-editor-welcome.description","A focused space for you to transform images with Grok to anything you can imagine.")})]}),{duration:7e3}))},[I,k,N]),(0,a.jsxs)("div",{className:"flex flex-col items-center justify-between w-full h-full relative @container",children:[(0,a.jsxs)("div",{className:(0,u.cn)("flex flex-col gap-8 w-full mb-6 sm:mb-10",{"sm:mb-0":o&&!s}),children:[!o&&(0,a.jsx)(tE,{selectedImage:s,title:l,isSending:m,onRegenerate:g||(()=>{}),onClose:w}),s&&t.length>1&&(0,a.jsxs)("div",{className:"w-full h-[88px] @lg:h-auto relative @lg:absolute @lg:w-auto @lg:right-0 @lg:bottom-0 @lg:top-14 grid place-items-center @lg:mx-0",children:[(0,a.jsx)("div",{className:"absolute inset-y-0 -right-3 bg-gradient-to-l w-8 @lg:bottom-auto @lg:right-0 @lg:left-0 @lg:w-full @lg:-top-3 @lg:h-8 @lg:bg-gradient-to-b from-surface-l1 via-surface-l1 dark:from-surface-inset dark:via-surface-inset to-transparent z-40"}),(0,a.jsx)("div",{className:"absolute inset-y-0 -left-3 bg-gradient-to-r w-8 @lg:top-auto  @lg:right-0 @lg:left-0 @lg:w-full @lg:-bottom-3 @lg:h-8 @lg:bg-gradient-to-t from-surface-l1 via-surface-l1 dark:from-surface-inset dark:via-surface-inset to-transparent z-40"}),t.length>1&&(0,a.jsx)(tS,{images:t,selectedImageId:s.id,onSelect:h||(()=>{})})]})]}),x||f&&!s?(0,a.jsx)(tf,{}):s?M:(0,a.jsx)("div",{className:"w-full h-full max-w-7xl",children:(0,a.jsx)(tw,{onUploadImage:y||(()=>{}),children:P&&(0,a.jsx)("div",{className:"w-full max-w-xl",children:(0,a.jsx)(tF,{selectedImage:s,isWaitingForResponse:x,isStreaming:f,isSending:m,isAborting:c,inputValue:i||"",onInputValueChange:r||(()=>{}),onSend:p||(()=>{}),onAbort:b||(()=>{})})})})}),!P&&(0,a.jsx)("footer",{className:"relative w-full max-w-2xl h-16 flex-shrink-0 mt-12 sm:mt-20",children:(0,a.jsxs)("div",{className:"absolute bottom-0 inset-x-0 flex flex-col gap-4",children:[!!s&&(0,a.jsx)(tP,{isStreaming:f,isSending:m,selectedImage:s,onSend:p||(()=>{})}),!d&&(0,a.jsx)(tF,{selectedImage:s,isWaitingForResponse:x,isSending:m,isStreaming:f,isAborting:c,inputValue:i||"",onInputValueChange:r||(()=>{}),onSend:p||(()=>{}),onAbort:b||(()=>{})})]})})]})};var tU=s(35501);let tL=()=>{let{push:e}=(0,S.wK)(),{t}=(0,j.Bd)("base"),{ASSET_SERVER_URL:s}=(0,to.v)(),l=(0,V.h)(),n=(0,f.useStatsigClient)(),r=(0,m.R)(e=>e.loadRecent),o=(0,i.aP)(g.A("streamedMessageId")),c=(0,i.aP)(g.A("conversationId")),u=(0,i.aP)(g.A("setConversationId")),x=(0,i.aP)(g.A("setStreamedMessageId")),h=(0,tn.A3)(g.A("byId")),p=(0,tn.A3)(e=>e.byId[null!=o?o:""]),[b,y]=(0,v.useState)(!1),[w,N]=(0,v.useState)(!1),[I,k]=(0,v.useState)(""),[C,E]=(0,v.useState)([]),[A,z]=(0,v.useState)(null),[R,M]=(0,v.useState)(!1),[P,_]=(0,v.useState)(!1),[T,D]=(0,v.useState)(!1),B=(0,v.useMemo)(()=>C.find(e=>e.id===A)||null,[C,A]),F=(0,v.useCallback)(e=>{let a=tn.A3.getState().byId[e.parentResponseId||""],l="streaming"===e.state;return Object.entries(e.streamingImageById||{}).map(i=>{let[n,r]=i,o=Object.keys(r).map(Number),d=r[Math.max(...o)];return{id:n,url:(0,ti.sU)(s,d.imageUrl),state:l?"streaming":"completed",isModerated:!1,title:(null==a?void 0:a.imageEditUri)?t("image-editor.edited-image","Edited image"):t("image-editor.generated-image","Generated image"),description:null==a?void 0:a.message,regenResponseId:null==a?void 0:a.responseId,progressMap:l?o.map(e=>({progress:e/100,imageUrl:(0,ti.sU)(s,r[e].imageUrl)})):void 0,generatedImageWidth:l?e.generatedImageWidth:void 0,generatedImageHeight:l?e.generatedImageHeight:void 0}})},[s,t]),O=(0,v.useCallback)(e=>{e.length&&E(t=>{if(t.find(e=>e.id.includes("optimistic-streaming-image"))){let a=t.filter(e=>!e.id.includes("optimistic-streaming-image")).concat(e);if(!a.some(e=>e.id===A)){var s;z((null==(s=a[a.length-1])?void 0:s.id)||null)}return a}{let s=t.map(t=>e.find(e=>e.id===t.id)||t),a=e.filter(e=>!s.some(t=>t.id===e.id));return[...s,...a]}})},[E,A]),U=(0,v.useCallback)(t=>{var s;let{image:a,type:l}=t;return"upload"===l?n.logEvent("image_editor_upload",void 0,{location:"empty-image-workbench"}):"draw"===l&&n.logEvent("image_editor_draw",void 0,{location:"empty-image-workbench"}),e({page:"files",fileId:null!=(s=a.fileMetadataId)?s:null,emptyView:"default"}),r()},[e,r,n]),L=(0,v.useCallback)(()=>{e({page:"files",fileId:null,emptyView:"default"})},[e]),W=(0,v.useCallback)(e=>{let t=tr.C$.getState(),s=i.aP.getState();"none"!==s.reasoningMode&&s.setReasoningMode("none");let a={message:e,toolOverrides:{imageGen:!0},enableRetries:l.ENABLE_AUTO_STREAM_RETRY};return n.logEvent("image_editor_generate",void 0,{location:"empty-image-workbench",message:e,messageLength:String(e.length)}),y(!0),_(!1),D(!0),k(""),s.establishNewConversation({...a,temporary:t.isIncognito,disableToolComposer:!0,toolOverrides:{imageGen:!0},ff:l})},[l,k,n]),G=(0,v.useCallback)(()=>{if(!c||!o)return;let e=tn.A3.getState();return N(!0),e.abortStream(c,o).then(()=>{u(void 0),x(void 0),y(!1),E([]),z(null),M(!1)}).finally(()=>{N(!1)})},[o,c,u,x]),H=(0,v.useCallback)(()=>{T&&(D(!1),ec.oR.error(t("image-editor.failed-to-generate","Failed to generate image"))),u(void 0),y(!1),N(!1),E([]),z(null),M(!1)},[t,u,T]);return(0,v.useEffect)(()=>{if(!P)if(p&&"streaming"===p.state){let e=F(p);if(!p.imageAttachmentCount||e.length||R)(null==e?void 0:e.length)&&(O(e),y(!1));else{let e=Array.from({length:p.imageAttachmentCount}).map((e,s)=>({id:"optimistic-streaming-image-".concat(s),url:"",state:"streaming",isModerated:!1,title:t("image-editor.generated-image","Generated image"),description:p.message,progressMap:[],generatedImageWidth:p.generatedImageWidth,generatedImageHeight:p.generatedImageHeight}));E(t=>[...t,...e]),z(e[0].id),M(!0)}}else if(p&&("error"===p.state||p.error))H();else{M(!1);let t=[];if(p&&"closed"===p.state){var s,a,l,i;t=F(p);let n=null==(i=p.streamingImageById)||null==(a=i[null==(l=Object.keys(p.streamingImageById||{}))?void 0:l[0]])||null==(s=a[100])?void 0:s.assetId;t.length>0&&!P&&n&&(_(!0),r().then(()=>(u(void 0),x(void 0),e({page:"files",fileId:n}))).catch(H))}O(t)}},[p,F,O,E,t,b,R,A,h,P,H,e,r,u,x]),(0,a.jsx)(e8.YZ,{direction:"horizontal",autoSaveId:"workbench",className:"bg-surface-l1 dark:bg-surface-inset",children:(0,a.jsx)(e8.Zk,{order:1,minSize:50,defaultSize:100,className:"flex flex-col max-h-[100vh] h-[100vh]",children:(0,a.jsxs)("div",{className:"flex flex-col h-full max-h-full",children:[(0,a.jsx)("div",{className:"h-12 min-h-12 flex items-center justify-end px-4",children:(0,a.jsx)(d.$n,{"aria-label":t("image-editor.close","Close Image Editor"),variant:"ghostSecondary",size:"iconMd",rounded:!0,onClick:L,children:(0,a.jsx)(ej.uv,{className:"size-5"})})}),(0,a.jsx)("div",{className:"flex-1 relative overflow-hidden",children:(0,a.jsx)("div",{className:"w-full max-w-full relative h-full max-h-full",children:(0,a.jsx)(td.t,{fallbackRender:()=>(0,a.jsx)(tU.f,{}),children:(0,a.jsx)("div",{className:"flex flex-col h-full max-h-full p-2 lg:p-6 pt-8 w-full bg-surface-l1 dark:bg-surface-inset",children:(0,a.jsx)(tO,{queryBarPosition:"center",isStreaming:!!p&&"streaming"===p.state,selectedImage:B,images:C,isWaitingForResponse:b,isAborting:w,inputValue:I,hideHeader:!0,onImageSelect:e=>z(e.id),onInputValueChange:k,onSendQuery:W,onImageUpload:U,onAbort:G,onClose:L})})})})})]})})})};var tW=s(15665),tG=s(77204),tH=s(97225),t$=s(1729),tK=s(52542),tV=s(51789),tq=s(3209),tX=s(26676),tZ=s(7658),tQ=s(3683);function tY(e){let{asset:t}=e,{t:s}=(0,j.Bd)("files"),l=(0,tQ.M)(e=>e.listStatus),i=(0,tQ.M)(e=>e.loadFirstPage);(0,v.useEffect)(()=>{"ready"!==l&&i()},[l,i]);let n=(0,tQ._)(),{add:r}=(0,tq.O)(),o=(0,v.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),r().catch((0,B.HX)("add-to-workspace-button:create-workspace"))},[r]);return(0,a.jsxs)(k.rI,{children:[(0,a.jsx)(k.ty,{asChild:!0,children:(0,a.jsx)(d.gx,{variant:"ghost",rounded:!0,size:"iconMd",tooltipContent:s("add-to-project-button.tooltip","Add to Project"),children:(0,a.jsx)(ej.XR,{size:17})})}),(0,a.jsxs)(k.SQ,{className:"w-[250px] p-2 rounded-3xl flex flex-col gap-0.5 z-[50]",sideOffset:0,children:[!(null==n?void 0:n.length)&&(0,a.jsx)(tV.C,{content:s("No projects yet","No projects yet"),ctaText:s("Create Project","Create Project"),onClickCta:o},"no-workspaces"),n.length&&(0,a.jsx)("div",{className:(0,u.cn)("py-1 pl-2 text-sm text-secondary font-semibold sticky top-0"),children:s("add-to-project-menu-item","Add to Project")}),n.map(e=>(0,a.jsx)(tJ,{workspaceId:e.workspaceId,asset:t},e.workspaceId))]})]},"add-to-workspace-button")}function tJ(e){var t;let{workspaceId:s,asset:l}=e,{client:i}=(0,f.useStatsigClient)(),n=(0,tQ.M)(e=>{var t;return null==(t=e.byId[s])?void 0:t.data}),{mutate:r,error:o}=(0,tZ.mT)(s);(0,th.Y)("attach-dropdown:attachAsset",o);let{data:c}=(0,tZ.UL)(s),m=null==c||null==(t=c.assets)?void 0:t.some(e=>e.assetId===l.assetId),x=(0,v.useCallback)(e=>{l.assetId&&(r({assetId:l.assetId}),i.logEvent("add_to_workspace",void 0,{location:"add-to-workspace-button",workspaceId:s,assetId:l.assetId}))},[r,l,i,s]);return(0,a.jsxs)(d.$n,{className:(0,u.cn)("group/conversation-item pl-2 pr-1 py-1 text-sm","w-full flex flex-row gap-2 text-primary","rounded-2xl"),variant:"ghost",onClick:x,disabled:m,children:[(0,a.jsx)(tX.n,{icon:null==n?void 0:n.icon,sizeClass:"size-4",rounded:!0,buttonSize:"iconXs",disabled:!0}),(0,a.jsx)("span",{className:(0,u.cn)("flex-1 select-none text-nowrap max-w-full overflow-hidden text-left"),style:{maskImage:X.uU,WebkitMaskImage:X.uU},children:null==n?void 0:n.name})]})}var t0=s(50672),t1=s(11875),t2=s(42143),t3=s(48756),t4=s(85255),t6=s(62454),t5=s(43791),t8=s(87549),t7=s(52371),t9=s(10636);function se(e){let{mode:t,setMode:s}=e,{t:l}=(0,j.Bd)("chat");return(0,a.jsx)(t7.tU,{className:"flex-1 flex-row justify-start flex no-a11y-check",defaultValue:"code",value:t,onValueChange:e=>s(e),children:(0,a.jsxs)(t7.j7,{children:[(0,a.jsxs)(t7.Xi,{className:"gap-1",value:"code","aria-label":l("Code","Code"),children:[(0,a.jsx)(t9.A,{className:"size-4"}),(0,a.jsx)("span",{className:"hidden md:inline",children:l("Code","Code")})]}),(0,a.jsx)(t7.Xi,{className:"gap-1",value:"preview","aria-label":l("Preview","Preview"),children:(0,a.jsx)("span",{className:"hidden md:inline",children:l("Preview","Preview")})})]})})}var st=s(47199);let ss=e=>{let{mimetype:t,content:s}=e;if("text/html"===t)return(0,a.jsx)(st.Z,{srcDoc:s,autofocus:!0})};var sa=s(8800);let sl=e=>{let{code:t,mimetype:s,consoleRef:a}=e,l=(0,v.useRef)([]),{t:i}=(0,j.Bd)(["chat"]),n=i("code-execution.done","Done"),r=(0,t$.I5)(s),{runCode:o,loading:d,result:c,codeExecutionAvailable:u}=(0,sa.P)(t,r);(0,v.useEffect)(()=>{var e;null==(e=a.current)||e.reset()},[a,t]);let m=(0,v.useCallback)(()=>{var e;null==(e=a.current)||e.reset(),l.current=[],o()},[a,o]);return(0,v.useEffect)(()=>{var e,t,s,i,r,o,d,u;if(!c)return;let{stdout:m,stderr:f,outputFiles:x,success:h}=c;m&&!l.current.includes(m)&&(null==(e=a.current)||e.open(),l.current.push(m),null==(t=a.current)||t.addMessage({type:"log",message:m})),f&&!l.current.includes(f)&&(null==(s=a.current)||s.open(),l.current.push(f),null==(i=a.current)||i.addMessage({type:"error",message:f,disableFixButton:!0}));let p=Object.values(x).join(",");x&&Object.values(x).length>0&&!l.current.includes(p)&&(null==(r=a.current)||r.open(),l.current.push(p),null==(o=a.current)||o.addMessage({type:"log",files:x})),h&&!l.current.includes(n)&&0===l.current.length&&(null==(d=a.current)||d.open(),l.current.push(n),null==(u=a.current)||u.addMessage({type:"system",message:n}))},[a,c,n]),{runCode:m,isCodeRunning:d,codeExecutionResult:c,isCodeExecutionAvailable:u()}},si=e=>{let{mimetype:t,isCodeExecutionAvailable:s}=e;return s?"run":["text/html"].includes(t)?"preview":"none"},sn={size:18,strokeWidth:2};var sr=s(87853),so=s(69473),sd=s(66408),sc=(0,s(70402).A)(function(e,t){return t instanceof e||null!=t&&(t.constructor===e||"Object"===e.name&&"object"==typeof t)});function su(e){return null!=e}var sm=s(4357),sf=s(49042),sx=s(48085);let sh={size:18,strokeWidth:2};var sp=s(1451),sg=s(71205),sv=s(63059),sj=s(52265);let sb=e=>{let{file:t,content:s}=e,{client:a}=(0,f.useStatsigClient)(),{ASSET_SERVER_URL:l}=(0,to.v)(),i=(0,ti.sU)(l,t.fileUri);return{handleDownload:(0,v.useCallback)(()=>{if(i||s)if(a.logEvent("file_content_download_click",void 0,{contentType:t.fileMimeType}),s){let e=new Blob([s],{type:t.fileMimeType});(0,sj.W)(e,t.fileName)}else i&&(0,sj.z)(i,t.fileName)},[a,i,s,t.fileName,t.fileMimeType])}},sy={size:18,strokeWidth:2};s(10479);var sw=s(61884),sN=s(8516),sI=s(47934);function sk(e){let{asset:t}=e,s=(0,r.B)(t),{t:l}=(0,j.Bd)("files"),{ASSET_SERVER_URL:i}=(0,to.v)(),{client:n}=(0,f.useStatsigClient)(),o=(0,v.useCallback)(()=>{n.logEvent("file_content_download_click",void 0,{contentType:"unknown"});let e=(0,ti.sU)(i,t.key);if(!e)return;let s=document.createElement("a");s.href=e,s.download="file",document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(e)},[n,i,t.key]),c=l("read-only-indicator-tooltip","Grok can't edit this type of file but can still answer questions about it");return(0,a.jsx)(t5.U,{editor:(0,a.jsx)(so.H,{hideEdit:!0,fileMetadata:s,onClose:()=>{},className:"border-none shadow-none max-w-none"}),assetId:t.assetId,conversationId:t.currentConversationId,editorHeader:(0,a.jsx)(t2.F,{asset:t}),headerButtons:[(0,a.jsx)(d.gx,{tooltipContent:l("Download to file","Download to file"),tooltipContentProps:{className:"text-xs"},tooltipProps:{delayDuration:300},onClick:o,rounded:!0,variant:"ghost",size:"iconMd","aria-label":l("Download to file","Download to file"),children:(0,a.jsx)(sg.A,{strokeWidth:2,size:20})},"download-button")],chat:(0,a.jsx)(sI.s,{asset:t}),chatHeader:(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,a.jsx)("div",{className:"text-secondary",children:l("files-tab-conversation-header","File Chat")}),(0,a.jsxs)(sw.m_,{children:[(0,a.jsx)(sw.k$,{asChild:!0,children:(0,a.jsx)("span",{"aria-label":c,children:(0,a.jsx)(sN.A,{className:"w-4 h-4"})})}),(0,a.jsx)(sw.ZI,{children:c})]})]})})}let sC={markdown:function(e){var t;let{asset:s}=e,l=(0,V.h)(),{t:i}=(0,j.Bd)("files"),[n,r]=(0,v.useState)(!1),{content:o,setContent:c,error:m,isEditing:f,refetch:x}=(0,t0.W)(s,n),{handleCopy:h,copyPressed:p,handleDownload:g,shareLoading:b,handleShare:y,sharePressed:w}=(0,t4.H)({assetId:s.assetId,content:null!=o?o:"",filename:null!=(t=s.name)?t:"file"}),{activeArtifact:N,isEditing:I,onSetActiveArtifact:k}=(0,t6.a)({content:null!=o?o:void 0});(0,v.useEffect)(()=>{r(I)},[I]);let C=(0,sf.l)({content:o,isEditable:!0,onUpdate:c});return null==o?(0,a.jsxs)("div",{className:"flex flex-col w-full h-full p-4",children:[(0,a.jsx)(eY.E,{className:"w-[30%] h-6"}),(0,a.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,a.jsx)(eY.E,{className:"w-24 h-6"}),(0,a.jsx)(eY.E,{className:"w-6 h-6"}),(0,a.jsx)(eY.E,{className:"w-6 h-6"}),(0,a.jsx)(eY.E,{className:"w-6 h-6"}),(0,a.jsx)(eY.E,{className:"w-6 h-6"}),(0,a.jsx)(eY.E,{className:"w-6 h-6"}),(0,a.jsx)(eY.E,{className:"w-6 h-6"})]}),(0,a.jsx)("div",{className:"flex flex-col gap-4 w-full h-full justify-center items-center py-[10%]",children:(0,a.jsxs)("div",{className:"flex flex-col h-full w-full max-w-3xl gap-2",children:[(0,a.jsx)(eY.E,{className:"w-full max-w-xl mb-2 h-8"}),(0,a.jsx)(eY.E,{className:"w-full max-w-3xl h-6"}),(0,a.jsx)(eY.E,{className:"w-full max-w-2xl h-6"}),(0,a.jsx)(eY.E,{className:"w-full max-w-xl h-6"}),(0,a.jsx)(eY.E,{className:"w-full max-w-3xl h-6"}),(0,a.jsx)(eY.E,{className:"w-full max-w-2xl h-6"}),(0,a.jsx)(eY.E,{className:"w-full max-w-3xl h-6"}),(0,a.jsx)(eY.E,{className:"w-full max-w-2xl h-6"}),(0,a.jsx)(eY.E,{className:"w-full max-w-3xl h-6"}),(0,a.jsx)(eY.E,{className:"w-full max-w-xl h-6"}),(0,a.jsx)(eY.E,{className:"w-full max-w-xl h-6"}),(0,a.jsx)(eY.E,{className:"w-full max-w-sm h-6"})]})})]}):m?(0,a.jsx)(tU.f,{onRetryRequested:x}):(0,a.jsx)(t5.U,{editor:(0,a.jsxs)("div",{className:(0,u.cn)("no-a11y-check h-full overflow-auto max-w-full relative prose bg-surface-l1 dark:bg-surface-inset","\n  [&_.tiptap_h1.is-editor-empty:first-child::before]:text-primary/20\n  [&_.tiptap_h1.is-editor-empty:first-child::before]:text-3xl\n  [&_.tiptap_h1.is-editor-empty:first-child::before]:font-bold\n  [&_.tiptap_h1.is-editor-empty:first-child::before]:content-[attr(data-placeholder)]\n  [&_.tiptap_h1.is-editor-empty:first-child::before]:float-left\n  [&_.tiptap_h1.is-editor-empty:first-child::before]:h-0\n  [&_.tiptap_h1.is-editor-empty:first-child::before]:pointer-events-none\n"),children:[C&&null!==o?(0,a.jsx)(sm.n,{editor:C,content:o,editable:!f,className:"max-w-3xl h-full justify-self-center"}):null,f?(0,a.jsx)("div",{className:"sticky overflow-visible bottom-4 start-0 w-full flex items-center justify-center",children:(0,a.jsxs)("div",{className:"flex items-center gap-2 text-primary bg-surface-l1 px-4 py-2 rounded-full h-10 border border-border",children:[(0,a.jsx)($.y,{size:"sm"}),(0,a.jsx)("span",{children:i("files.editing-by-model","Editing...")})]})}):null]}),assetId:s.assetId,conversationId:s.currentConversationId,editorHeader:(0,a.jsx)(t2.F,{asset:s}),editorSubheader:C?(0,a.jsx)(sx.n,{editable:!0,editor:C}):null,headerButtons:[(0,a.jsx)(d.gx,{tooltipContent:i("Copy Contents","Copy Contents"),tooltipContentProps:{className:"text-xs"},tooltipProps:{delayDuration:300},onClick:h,rounded:!0,variant:"ghost",size:"iconMd","aria-label":i("Copy Contents","Copy Contents"),children:(0,a.jsx)(tC.p,{children:p?(0,a.jsx)(eL.A,{size:16}):(0,a.jsx)(ej.Td,{size:18})},p?"copied":"copy")},"copy-button"),(0,a.jsx)(d.gx,{tooltipContent:i("Download to file","Download to file"),tooltipContentProps:{className:"text-xs"},tooltipProps:{delayDuration:300},onClick:g,rounded:!0,variant:"ghost",size:"iconMd","aria-label":i("Download to file","Download to file"),children:(0,a.jsx)(tk,{...sh,size:19})},"download-button"),l.ENABLE_FILE_SHARING?(0,a.jsx)(d.gx,{tooltipContent:i("Share file","Share file"),onClick:y,tooltipContentProps:{className:"text-xs"},variant:"ghost",size:"iconMd","aria-label":i("Share file","Share file"),rounded:!0,children:(0,a.jsx)(tC.p,{children:b?(0,a.jsx)($.y,{size:"xs"}):w?(0,a.jsx)(eL.A,{size:16}):(0,a.jsx)(ej.li,{...sh,size:20})},b?"share-loading":w?"shared":"share")},"share-button"):null],chat:(0,a.jsx)(t3.s,{asset:s,activeArtifact:N,onArtifactSelected:k})})},csv:sr.s1,spreadsheet:function(e){var t;let{asset:s}=e,{t:l}=(0,j.Bd)("files"),i=(0,V.h)(),n=(0,r.B)(s),{ASSET_SERVER_URL:o}=(0,to.v)(),c=(0,m.R)(e=>e.setAssetContent),u=(0,m.fh)(null!=(t=s.assetId)?t:"","binary"),f=(0,m.R)(e=>e.fetchBinaryContent);(0,v.useEffect)(()=>{null==u&&s.assetId&&f(s.assetId,o)},[o,s.assetId,u,f]);let x=(0,v.useCallback)(e=>{var t;c(null!=(t=s.assetId)?t:"",e)},[s.assetId,c]),{handleDownload:h}=sb({file:n,content:u});return s.assetId?(0,a.jsx)(t5.U,{editor:(0,a.jsx)("div",{className:"flex flex-col h-full overflow-hidden border-t border-border-l1",children:(0,a.jsx)(sv.bs,{id:s.assetId,initialState:{name:s.name||"Workbook"},content:u,readOnly:!i.ENABLE_XLSX_EDITING,children:void 0!==u?(0,a.jsx)(sp.y,{readOnly:!i.ENABLE_XLSX_EDITING,onContentUpdate:x}):null},s.assetId)}),assetId:s.assetId,conversationId:s.currentConversationId,editorHeader:(0,a.jsx)(t2.F,{asset:s}),headerButtons:[(0,a.jsx)(d.gx,{tooltipContent:l("Download to file","Download to file"),tooltipContentProps:{className:"text-xs"},tooltipProps:{delayDuration:300},onClick:h,rounded:!0,variant:"ghost",size:"iconMd","aria-label":l("Download to file","Download to file"),disabled:!u,children:(0,a.jsx)(sg.A,{...sy,size:20})},"download-button")],chat:(0,a.jsx)(t3.s,{asset:s})}):(0,a.jsx)(tU.f,{})},image:function(e){let{asset:t}=e,{t:s}=(0,j.Bd)("base"),{ASSET_SERVER_URL:l}=(0,to.v)(),n=(0,V.h)(),[o]=(0,tc.Mj)("files-tab-is-chat-open",!0),c=(0,f.useStatsigClient)(),{handleEditorOpen:u,consumeEditorTimeMs:x}=(0,sd.Q)(),{editImagePresets:h}=(0,tA.F)(),b=(0,m.R)(e=>e.loadRecent),y=(0,m.R)((0,e_.k)(e=>e.assetsById)),w=(0,m.R)((0,e_.k)(e=>e.listStatus)),N=(0,tn.A3)(g.A("byId")),I=(0,i.aP)(g.A("conversationId")),k=(0,i.aP)(g.A("streamedMessageId")),C=(0,i.aP)(g.A("queryByConversationId")),E=(0,i.aP)(g.A("idsetQueryByConversationId")),[S,A]=(0,v.useState)(!1),[z,R]=(0,v.useState)(!1),[M,P]=(0,v.useState)(!1),[T,D]=(0,v.useState)(!1),[F,O]=(0,v.useState)(null),[U,L]=(0,v.useState)(null),[W,G]=(0,v.useState)([]),[H,K]=(0,v.useState)(null),[q,X]=(0,v.useState)(null),Z=(0,v.useRef)(null),Q=(0,v.useMemo)(()=>(0,r.B)(t),[t]),Y=(0,v.useMemo)(()=>{if(!t.currentConversationId)return[];let e=[];return Object.values(y).map(e=>null==e?void 0:e.data).filter(su).forEach(s=>{var a;(null==(a=s.mimeType)?void 0:a.startsWith("image/"))&&s.sourceConversationId===t.currentConversationId&&e.push(s)}),e.sort((e,t)=>new Date(e.createTime||"").getTime()-new Date(t.createTime||"").getTime())},[t,y]),J=I||"no_conversation_id",ee=C[J],et=(0,v.useCallback)(e=>E(e,J),[J,E]),es=(0,v.useMemo)(()=>W.find(e=>e.id===U)||null,[W,U]),ea=(0,v.useMemo)(()=>{let e=Y.find(e=>e.assetId===F);return e||t},[t,F,Y]),el=(0,tn.A3)(e=>e.byId[null!=k?k:""]),ei=(0,v.useCallback)(e=>{tn.A3.getState().byId[e.parentResponseId||""];let t="streaming"===e.state;return Object.entries(e.streamingImageById||{}).map(s=>{let[a,i]=s,n=Object.keys(i).map(Number),r=i[Math.max(...n)];return{id:a,url:(0,ti.sU)(l,r.imageUrl),state:t?"streaming":"completed",isModerated:!1,responseId:e.responseId,progressMap:t?n.map(e=>({progress:e/100,imageUrl:(0,ti.sU)(l,i[e].imageUrl)})):void 0,generatedImageWidth:t?e.generatedImageWidth:void 0,generatedImageHeight:t?e.generatedImageHeight:void 0}})},[l]),en=(0,v.useCallback)(e=>{e.length&&G(t=>{if(t.find(e=>e.id.includes("optimistic-streaming-image"))){let a=t.filter(e=>!e.id.includes("optimistic-streaming-image")).concat(e);if(!a.some(e=>e.id===U)){var s;L((null==(s=a[a.length-1])?void 0:s.id)||null)}return a}{let s=t.map(t=>e.find(e=>e.id===t.id)||t),a=e.filter(e=>!s.some(t=>t.id===e.id));return[...s,...a]}})},[G,U]),er=(0,v.useCallback)(e=>{if(!es)return;let t=tn.A3.getState(),s=tr.C$.getState(),a=i.aP.getState(),l=a.lastMessageId?t.byId[a.lastMessageId]:void 0;if(a.lastMessageId&&!l)throw Error("Last message is missing");"none"!==a.reasoningMode&&a.setReasoningMode("none");let r={message:e,toolOverrides:{imageGen:!0},imageEditUri:es.url?es.url.replace(/^https?:\/\/[^/]+\/?/,""):void 0,enableRetries:n.ENABLE_AUTO_STREAM_RETRY};if(es.url){let t=h.flatMap(e=>e.presets).find(t=>t.prompt===e);c.logEvent("edit_image_start",(0,sd.r)(es.url),{queryType:t?"preset":"manual",location:"image-workbench",presetId:(null==t?void 0:t.presetId)||"",message:e,messageLength:String(e.length)})}return R(!0),et(""),a.conversationId?a.sendResponse({...r,parentResponseId:a.lastMessageId,conversationId:a.conversationId,webpageUrls:[],setOpimisticUserResponse:!0,setUserResponse:!0,disableToolComposer:!0,isFromGrokFiles:!0,fileAttachmentIds:[ea.assetId],ff:n}):a.establishNewConversation({...r,temporary:s.isIncognito,disableToolComposer:!0,isFromGrokFiles:!0,fileAttachmentIds:[ea.assetId],ff:n})},[es,n,et,ea.assetId,c,h]);(0,v.useCallback)(()=>{let e=N[(null==es?void 0:es.regenResponseId)||""];if(e)return er(e.message)},[es,N,er]);let eo=(0,v.useCallback)(()=>{if(!I||!k)return;let e=tn.A3.getState();return P(!0),e.abortStream(I,k).finally(()=>{P(!1)})},[k,I]),ed=(0,v.useCallback)(()=>{var e;!S&&(null==es?void 0:es.url)&&(A(!0),(0,tI.G)(es.url,null==(e=es.url)?void 0:e.split("/").pop()).catch((0,B.HX)("image-editor:handleDownload")).finally(()=>A(!1)))},[S,es]),ec=(0,v.useCallback)(()=>{Z.current&&n.ENABLE_IMAGE_EDITOR_IN_FILES&&(c.logEvent("image_editor_close",void 0,{timeInEditorMs:String(x()),location:"image-workbench"}),Z.current=null)},[x,c,n.ENABLE_IMAGE_EDITOR_IN_FILES]);(0,v.useEffect)(()=>{if(el&&"streaming"===el.state&&el.conversationId===I){let e=ei(el);if(!el.imageAttachmentCount||e.length||T)(null==e?void 0:e.length)&&(en(e),R(!1));else{let e=Array.from({length:el.imageAttachmentCount}).map((e,t)=>({id:"optimistic-streaming-image-".concat(t),url:"",state:"streaming",isModerated:!1,responseId:el.responseId,progressMap:[],generatedImageWidth:el.generatedImageWidth,generatedImageHeight:el.generatedImageHeight}));G(t=>[...t,...e]),L(e[0].id),D(!0)}}else{R(!1),D(!1);let e=[];el&&"closed"===el.state&&!el.error&&el.conversationId===I&&(e=ei(el),H!==el.responseId&&(K(el.responseId),b().catch((0,B.HX)("image-editor:loadRecent")))),el&&("error"===el.state||el.error)||!el?G(e=>{if(!e.find(e=>e.id.includes("optimistic-streaming-image")))return e;{let s=e.filter(e=>!e.id.includes("optimistic-streaming-image"));if(!s.some(e=>e.id===U)){var t;L((null==(t=s[s.length-1])?void 0:t.id)||null)}return s}}):en(e)}},[el,ei,en,G,s,z,T,N,U,b,H,t.assetId,Y,I]);let eu=(0,v.useCallback)(async()=>{let e=tn.A3.getState();if(t.currentConversationId){let s=[null==t?void 0:t.responseId,...Y.map(e=>null==e?void 0:e.responseId)].filter(sc(String)),a=await e.loadResponses(t.currentConversationId,s),i=a.find(e=>(null==e?void 0:e.responseId)===(null==t?void 0:t.responseId)),n=i?e.byId[i.parentResponseId||""]:void 0,o=(0,r.B)(t);return[{id:t.assetId||"",state:"completed",isModerated:!1,url:(0,ti.sU)(l,o.fileUri||""),responseId:t.responseId,parentImageUrl:(null==n?void 0:n.imageEditUri)?(0,ti.sU)(l,n.imageEditUri):void 0},...Y.sort((e,t)=>new Date(e.createTime||"").getTime()-new Date(t.createTime||"").getTime()).map(e=>{let t=(0,r.B)(e),s=a.find(t=>(null==t?void 0:t.responseId)===(null==e?void 0:e.responseId)),i=s?a.find(e=>(null==e?void 0:e.responseId)===(null==s?void 0:s.parentResponseId)):void 0;return{id:e.assetId||"",state:"completed",isModerated:!1,url:(0,ti.sU)(l,t.fileUri||""),responseId:e.responseId,parentImageUrl:(null==i?void 0:i.imageEditUri)?(0,ti.sU)(l,i.imageEditUri):void 0}})]}if(t.sourceConversationId){let s=[null==t?void 0:t.responseId].filter(sc(String)),a=await e.loadResponses(t.sourceConversationId,s),i=(0,r.B)(t),n=a.find(e=>(null==e?void 0:e.responseId)===(null==t?void 0:t.responseId)),o=n?a.find(e=>(null==e?void 0:e.responseId)===(null==n?void 0:n.parentResponseId)):void 0;return[{id:t.assetId||"",state:"completed",isModerated:!1,url:(0,ti.sU)(l,i.fileUri||""),responseId:t.responseId,parentImageUrl:(null==o?void 0:o.imageEditUri)?(0,ti.sU)(l,o.imageEditUri):void 0}]}{let e=(0,r.B)(t);return[{id:t.assetId||"",state:"completed",isModerated:!1,url:(0,ti.sU)(l,e.fileUri||""),responseId:t.responseId}]}},[l,t,Y]),em=(0,v.useCallback)(e=>{var t;if(W.some(t=>t.id===U&&t.responseId===e))return;let s=null==(t=W.find(t=>t.responseId===e))?void 0:t.id;s&&L(s)},[W,U]);return(0,v.useEffect)(()=>{t.assetId&&t.assetId!==q&&"ready"===w&&(Z.current&&Z.current!==t.assetId&&ec(),X(t.assetId),eu().then(e=>{G(e),L(t.assetId),K(null),D(!1),R(!1),P(!1),Z.current=t.assetId,u(),n.ENABLE_IMAGE_EDITOR_IN_FILES&&c.logEvent("image_editor_open",t.assetId,{location:"image-workbench"})}).catch((0,B.HX)("image-editor:getInitialImages")))},[t.assetId,w,q,eu,u,ec,c,n.ENABLE_IMAGE_EDITOR_IN_FILES]),(0,v.useEffect)(()=>{if(U&&U!==F){if(U===t.assetId||Y.some(e=>e.assetId===U))O(U);else if(null==es?void 0:es.responseId){var e,s,a;let t=N[(null==es?void 0:es.responseId)||""],l=null==t||null==(a=t.streamingImageById)||null==(s=a[U])||null==(e=s[100])?void 0:e.assetId;l&&O(l)}}},[U,F,t.assetId,Y,N,es]),(0,v.useEffect)(()=>()=>{ec()},[ec]),n.ENABLE_IMAGE_EDITOR_IN_FILES?(0,a.jsx)(t5.U,{editor:(0,a.jsx)("div",{className:"flex flex-col h-full max-h-full p-2 lg:p-6 pt-8 w-full",children:(0,a.jsx)(tO,{hideHeader:!0,hideQueryBar:o,isStreaming:el&&"streaming"===el.state,selectedImage:es,images:W,isWaitingForResponse:z||!es,isAborting:M,inputValue:ee,onInputValueChange:et,onImageSelect:e=>L(e.id),onSendQuery:er,onAbort:eo})}),assetId:t.assetId,disableClear:!0,conversationId:t.currentConversationId,editorHeader:(0,a.jsx)(_.N,{mode:"popLayout",children:(null==es?void 0:es.state)==="streaming"?(0,a.jsx)(p.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},className:"text-lg font-semibold text-primary animate-pulse",children:s("image-editor.generating","Generating")},"streaming-title"):(0,a.jsx)(p.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},className:"flex-grow",children:(0,a.jsx)(t2.F,{asset:ea,className:"text-lg font-semibold text-primary truncate min-w-0 overflow-hidden"})},el&&"streaming"===el.state?U:ea.assetId)}),headerButtons:[es&&(0,a.jsx)(d.gx,{variant:"ghost",size:"iconMd",rounded:!0,"aria-label":s("image-editor.download-image","Download Image"),tooltipContent:s("image-editor.download-image","Download Image"),tooltipContentProps:{side:"bottom"},disabled:"streaming"===es.state||!es.url||S,onClick:ed,children:(0,a.jsx)(tC.p,{children:S?(0,a.jsx)($.y,{size:"xs"}):(0,a.jsx)(tk,{className:"size-5"})},S?"is-downloading":"download-icon")},"download")],chat:(0,a.jsx)(t3.s,{asset:t,viewedAssetId:F||void 0,onResponseImagesOpen:em,responseImagesView:"status-card"},t.assetId)}):(0,a.jsx)("div",{className:"flex flex-col max-h-[100vh] h-[100vh]",children:(0,a.jsx)("div",{className:"flex items-center justify-center h-full bg-surface-base",children:(0,a.jsx)(so.H,{hideEdit:!0,fileMetadata:Q,onClose:()=>{},className:"border-none shadow-none max-w-none"})})})},code:function(e){var t,s,l;let{asset:i}=e,n=(0,V.h)(),{t:o}=(0,j.Bd)("files"),c=(0,f.useStatsigClient)(),[u,m]=(0,v.useState)(!1),{content:x,setContent:h,error:p,isEditing:g,refetch:b}=(0,t0.W)(i,u),y=(0,v.useRef)(null),w=(0,r.B)(i),{activeArtifact:N,isEditing:I,onSetActiveArtifact:k}=(0,t6.a)({content:null!=x?x:void 0});(0,v.useEffect)(()=>{m(I)},[I]);let{runCode:C,isCodeRunning:E,isCodeExecutionAvailable:S}=sl({code:null!=x?x:"",mimetype:null!=(t=w.fileMimeType)?t:"",consoleRef:y}),A=(0,v.useCallback)(()=>{C(),c.logEvent("files.workbench.run-code")},[C,c]),z=(0,v.useCallback)(e=>{h(null!=e?e:"")},[h]),R=si({content:null!=x?x:"",mimetype:w.fileMimeType,isCodeExecutionAvailable:S}),{handleCopy:M,copyPressed:P,handleDownload:_,handleShare:T,sharePressed:D,shareLoading:B}=(0,t4.H)({assetId:i.assetId,content:null!=x?x:"",filename:null!=(s=i.name)?s:"file"}),F=(0,t$.I5)(w.fileMimeType),[O,U]=(0,v.useState)("code"),L=(0,v.useCallback)(e=>{U(e),c.logEvent("files.workbench.set-mode",e)},[c]);return((0,v.useEffect)(()=>{U("code")},[i.assetId]),null==x)?(0,a.jsxs)("div",{className:"flex flex-col w-full h-full p-4",children:[(0,a.jsxs)("div",{className:"flex gap-2 items-center justify-between",children:[(0,a.jsx)(eY.E,{className:"w-[30%] h-6"}),(0,a.jsxs)("div",{className:"flex gap-6 me-4",children:[(0,a.jsx)(eY.E,{className:"w-6 h-6"}),(0,a.jsx)(eY.E,{className:"w-6 h-6"}),(0,a.jsx)(eY.E,{className:"w-6 h-6"}),(0,a.jsx)(eY.E,{className:"w-6 h-6"})]})]}),(0,a.jsxs)("div",{className:"flex mt-6 flex-col h-full w-full max-w-3xl gap-3",children:[(0,a.jsx)(eY.E,{className:"w-full max-w-xl h-5"}),(0,a.jsx)(eY.E,{className:"w-full max-w-3xl h-5"}),(0,a.jsx)(eY.E,{className:"w-full max-w-2xl h-5"}),(0,a.jsx)(eY.E,{className:"w-full max-w-xl h-5"}),(0,a.jsx)(eY.E,{className:"w-full max-w-3xl h-5"}),(0,a.jsx)(eY.E,{className:"w-full max-w-2xl h-5"}),(0,a.jsx)(eY.E,{className:"w-full max-w-3xl h-5"}),(0,a.jsx)(eY.E,{className:"w-full max-w-2xl h-5"}),(0,a.jsx)(eY.E,{className:"w-full max-w-3xl h-5"}),(0,a.jsx)(eY.E,{className:"w-full max-w-xl h-5"}),(0,a.jsx)(eY.E,{className:"w-full max-w-xl h-5"}),(0,a.jsx)(eY.E,{className:"w-full max-w-sm h-5"})]})]}):p?(0,a.jsx)(tU.f,{onRetryRequested:b}):(0,a.jsx)(t5.U,{editor:"code"===O?(0,a.jsxs)("div",{className:"flex flex-col h-full overflow-hidden bg-surface-inset",children:[(0,a.jsx)("div",{className:"relative flex-1 h-full overflow-hidden",children:(0,a.jsx)(t8.B,{editable:!0,onContentUpdate:z,isStreaming:g,value:null!=x?x:"",syntax:F})}),(0,a.jsx)(tK.C,{ref:y}),g?(0,a.jsx)("div",{className:"sticky overflow-visible bottom-4 start-0 w-full flex items-center justify-center",children:(0,a.jsxs)("div",{className:"flex items-center gap-2 text-primary bg-surface-l1 px-4 py-2 rounded-full h-10 border border-border",children:[(0,a.jsx)($.y,{size:"sm"}),(0,a.jsx)("span",{children:o("files.editing-by-model","Editing...")})]})}):null]}):(0,a.jsx)(ss,{mimetype:null!=(l=i.mimeType)?l:"unknown",content:null!=x?x:""}),chat:(0,a.jsx)(t3.s,{asset:i,activeArtifact:N,onArtifactSelected:k}),editorHeader:(0,a.jsx)(t2.F,{asset:i}),assetId:i.assetId,conversationId:i.currentConversationId,headerButtons:["preview"===R?(0,a.jsx)(se,{mode:O,setMode:L}):null,"run"===R?(0,a.jsx)("div",{className:"py-1",children:(0,a.jsxs)(d.$n,{variant:"outline",size:"sm",className:"rounded-full",onClick:A,disabled:E,children:[E?(0,a.jsx)($.y,{size:"xs"}):(0,a.jsx)(t1.A,{...sn,size:16}),o("code-execution.run","Run")]})}):null,(0,a.jsx)(tY,{asset:i},"add-to-workspace-button"),(0,a.jsx)(d.gx,{tooltipContent:o("Copy Contents","Copy Contents"),tooltipContentProps:{className:"text-xs"},tooltipProps:{delayDuration:300},onClick:M,rounded:!0,variant:"ghost",size:"iconMd","aria-label":o("Copy Contents","Copy Contents"),children:(0,a.jsx)(tC.p,{children:P?(0,a.jsx)(eL.A,{size:16}):(0,a.jsx)(ej.Td,{size:18})},P?"copied":"copy")},"copy-button"),(0,a.jsx)(d.gx,{tooltipContent:o("Download to file","Download to file"),tooltipContentProps:{className:"text-xs"},tooltipProps:{delayDuration:300},onClick:_,rounded:!0,variant:"ghost",size:"iconMd","aria-label":o("Download to file","Download to file"),children:(0,a.jsx)(tk,{...sn,size:19})},"download-button"),n.ENABLE_FILE_SHARING?(0,a.jsx)(d.gx,{tooltipContent:o("Share file","Share file"),onClick:T,tooltipContentProps:{className:"text-xs"},variant:"ghost",size:"iconMd","aria-label":o("Share file","Share file"),rounded:!0,children:(0,a.jsx)(tC.p,{children:B?(0,a.jsx)($.y,{size:"xs"}):D?(0,a.jsx)(eL.A,{size:16}):(0,a.jsx)(ej.li,{...sn,size:20})},B?"share-loading":D?"shared":"share")},"share-button"):null]})},unknown:sk},sE=e=>null===e.selection?{activeSheetId:e.activeSheet}:{selection:{type:"sheet",sheetId:e.activeSheet,range:(0,tG.T4)(e.selection)}};function sS(e){var t;let{rootAssetId:s}=e,{t:l}=(0,j.Bd)("files"),{setOpen:n}=(0,tH.cL)(),r=(0,m.R)((0,e_.k)(e=>e.fetchVersions)),o=(0,m.R)(e=>{var t;return null==(t=e.assetsById[s])?void 0:t.status}),d=(0,m.F7)(s),c=(0,tW.F$)();(0,v.useEffect)(function(){return c.updateState(e=>({...e,activeId:s})),()=>{c.updateState(e=>({...e,activeId:null}))}},[s,c]);let u=(0,i.aP)(g.A("setMetadata")),f=c.useState(e=>e.nodes[s]);if((0,v.useEffect)(function(){f&&"sheet"===f.type&&u(sE(f))},[f,u]),(0,v.useEffect)(()=>{r(s)},[s,r]),(0,v.useEffect)(()=>{n(!1)},[]),!d&&"success"===o)return(0,a.jsx)(tU.f,{title:l("file-not-found.title","File not found"),message:l("file-not-found.message","We couldn't find the document. Please verify the link you entered and try again. You can also browse for your files in the Files panel.")});if(!d&&"error"===o)return(0,a.jsx)(tU.f,{});if(!d)return(0,a.jsx)(eQ.P,{delayMs:500,children:(0,a.jsx)("div",{className:"flex w-full h-full justify-center items-center",children:(0,a.jsx)($.y,{})})});let x=null!=(t=sC[(0,eN.qW)(d)])?t:sk;return(0,a.jsx)(x,{asset:d})}function sA(){var e;let{client:t}=(0,f.useStatsigClient)(),{t:s}=(0,j.Bd)("files"),{ENABLE_FILES_PAGE:l,ENABLE_IMAGE_EDITOR_IN_FILES:i}=(0,V.h)(),{route:n,push:r}=(0,S.wK)(),o=(0,q.Di)(),d="files"===n.page&&null!=(e=n.fileId)?e:void 0,c=(0,m.R)(e=>{var t,s;return d?null==(s=e.assetsById[e.currentVersion[d]])||null==(t=s.data)?void 0:t.name:""});(0,v.useEffect)(()=>{t.logEvent("files.open",d)},[d,t]),(0,K.r)(c||s("files-page-title","Files"));let x=(0,v.useRef)(null),h=(0,m.R)(e=>e.isFileExplorerCollapsed),[p,g]=(0,v.useState)(!1);if((0,v.useEffect)(()=>{let e=x.current;if(e){if(h&&e.isExpanded()){e.collapse(),g(!0);let t=setTimeout(()=>{g(!1)},300);return()=>clearTimeout(t)}else if(!h&&e.isCollapsed()){e.expand(),g(!0);let t=setTimeout(()=>{g(!1)},300);return()=>clearTimeout(t)}}},[h]),(0,e5.v)(e6.Ib,e=>{e.preventDefault(),e.stopPropagation(),r({page:"main"}),t.logEvent("pressed_cmd_j",void 0)},[t,r]),!l||"files"!==n.page)return(0,a.jsx)(L.default,{});if(o)return(0,a.jsx)(U,{});let{fileId:b,emptyView:w}=n;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(e8.YZ,{autoSaveId:"files-page-layout",style:{height:"100vh"},direction:"horizontal",className:"w-full h-[100vh] overflow-hidden",tagName:"main",children:[(0,a.jsx)(e8.Zk,{minSize:20,defaultSize:20,order:0,collapsible:!0,ref:x,onCollapse:()=>m.R.getState().setIsFileExplorerCollapsed(!0),onExpand:()=>m.R.getState().setIsFileExplorerCollapsed(!1),className:(0,u.cn)(p?"transition-all duration-300":""),children:(0,a.jsx)(e4,{className:"h-full"})}),(0,a.jsx)(sz,{collapsed:m.R.getState().isFileExplorerCollapsed}),(0,a.jsx)(e8.Zk,{order:1,minSize:0,defaultSize:100,className:"relative",children:b?(0,a.jsx)(sS,{rootAssetId:b}):"image"===w&&i?(0,a.jsx)(tL,{}):(0,a.jsx)(ts,{})})]}),(0,a.jsx)(y.CommandMenu,{})]})}function sz(e){let{collapsed:t}=e;return(0,a.jsx)(e8.TW,{"data-collapsed":t,className:(0,u.cn)("border-l data-[collapsed=true]:border-l-0","border-border-l1","data-[resize-handle-state=hover]:border-border-l2 z-50")})}var sR=s(40945);function sM(){let{route:e,push:t}=(0,S.wK)(),{user:s}=(0,I.useSession)();(0,v.useEffect)(()=>i.aP.subscribe((a,l)=>{if(!a.conversationId||a.conversationId===l.conversationId||"chat"===e.page&&e.conversationId!==a.conversationId||"main"!==e.page)return;let i=tr.C$.getState().isIncognito||!s;t({page:"chat",conversationId:i?null:a.conversationId,temporary:i})}),[t,e,s]);let{ENABLE_FILES_PAGE:n}=(0,V.h)(),{route:r}=(0,S.wK)();switch((0,v.useEffect)(()=>{let e=(0,S.KQ)(r,window.location.origin),t=document.querySelector("head link[rel='canonical']");return t||((t=document.createElement("link")).rel="canonical",document.head.appendChild(t)),t.href=e,()=>{let e=document.querySelector("head link[rel='canonical']");e&&document.head.removeChild(e)}},[r]),r.page){case"main":case"chat":return(0,a.jsx)(l.A,{});case"workspace":return(0,a.jsx)(sR.w8,{workspaceId:r.workspaceId});case"workspaces":return(0,a.jsx)(sR.TP,{});case"files":if(n)return(0,a.jsx)(sA,{});return(0,a.jsx)(U,{});case"tasks":return(0,a.jsx)(ex,{});case"images":return"Page "+r.page;case"plans":return(0,a.jsx)(W.default,{});default:return(0,a.jsx)(L.default,{})}}},85255:(e,t,s)=>{"use strict";s.d(t,{H:()=>u});var a=s(42419),l=s(52265),i=s(77232),n=s(87891),r=s(20337),o=s(88382),d=s(65146),c=s(14908);let u=e=>{let{assetId:t,content:s,filename:u}=e,{client:m}=(0,r.useStatsigClient)(),f=(0,n.R)(e=>e.shareAsset),x=(0,n.R)(e=>e.cloneAsset),[h,p]=(0,o.useState)(!1),[g,v]=(0,o.useState)(!1),[j,b]=(0,o.useState)(!1),{t:y}=(0,d.Bd)("files"),w=(0,o.useCallback)(async()=>{m.logEvent("file_content_copy_click",void 0,{contentType:"text/markdown"}),s&&(await (0,a.L)(s),setTimeout(()=>{p(!1)},1e3),p(!0),c.oR.success(y("files.content.copied","Copied")))},[s,m,y]),N=(0,o.useCallback)(()=>{m.logEvent("file_content_download_click",void 0,{contentType:"text/markdown"});let e=new Blob([s],{type:"text/markdown"});(0,l.W)(e,u)},[m,s,u]);return{handleCopy:w,copyPressed:h,handleDownload:N,handleShare:(0,o.useCallback)(async()=>{if(m.logEvent("file_content_share_click",void 0,{contentType:"text/markdown"}),!t)return;v(!0);let e=!1;try{await f(t),e=!0}catch(e){c.oR.error(y("Failed to share file.","Failed to share file."))}finally{v(!1)}if(!e)return;setTimeout(()=>{b(!1)},1e3),b(!0);let s=window.location.origin+"/shared-file/"+t;(0,i.g)(s,y("Copied share link to clipboard.","Copied share link to clipboard."))},[m,t,f,y]),sharePressed:j,shareLoading:g,handleClone:(0,o.useCallback)(async()=>{if(m.logEvent("file_content_clone_click",void 0,{contentType:"text/markdown"}),!t)return;let{assetId:e}=await x(t);e&&(window.location.href="/files/?file=".concat(e))},[m,t,x])}}},87549:(e,t,s)=>{"use strict";s.d(t,{B:()=>o});var a=s(79342),l=s(16538),i=s(34323),n=s(16506),r=s(88382);let o=e=>{let{syntax:t,value:s,isStreaming:o,editable:d,autofocus:c,onContentUpdate:u}=e,m=(0,r.useRef)(void 0),[f,x]=(0,r.useState)(!1),h=(0,r.useRef)(null),{resolvedTheme:p}=(0,n.D)();(0,r.useEffect)(()=>{(0,l.q)()},[]);let g=(0,r.useCallback)((e,t)=>{t.isFlush||u(e)},[u]),v=(0,r.useCallback)(e=>{h.current=e,x(!0)},[]);(0,r.useEffect)(()=>{let e=h.current;if(f&&e&&d&&c){var t,s;let a={lineNumber:1,column:(null!=(s=null==(t=e.getModel())?void 0:t.getLineLength(1))?s:0)+1};e.setPosition(a),e.focus()}},[f,c]),(0,r.useEffect)(()=>{let e=h.current;if(!e||!l.x||!o)return;let t=e.getValue(),a=e.getModel();if(!a)return;if(!s.includes(t))return void e.setValue(s);let i=s.substring(t.length),n=a.getPositionAt(t.length);e.executeEdits("stream-update",[{range:new l.x.Range(n.lineNumber,n.column,n.lineNumber,n.column),forceMoveMarkers:!0,text:i}])},[f,s,o]);let j=(0,r.useCallback)(()=>{m.current&&m.current();let e=null===l.x||void 0===l.x?void 0:l.x.editor.getEditors()[0];if(e){var t;let s=e.getSelection();if(!s)return;if(null==(t=e.getModel())?void 0:t.getValueInRange(s)){let t=document.createElement("div"),a={getId:()=>"selected-text.widget",getDomNode:()=>t,getPosition:()=>l.x?{position:{lineNumber:s.endLineNumber,column:s.startColumn},preference:[l.x.editor.ContentWidgetPositionPreference.BELOW,l.x.editor.ContentWidgetPositionPreference.ABOVE]}:{position:{lineNumber:s.endLineNumber,column:s.startColumn},preference:[]}};e.addContentWidget(a),m.current=()=>e.removeContentWidget(a)}}},[]),b=(0,r.useMemo)(()=>({contextmenu:!1,suggestOnTriggerCharacters:!1,acceptSuggestionOnEnter:"off",lineNumbers:"on",readOnly:!d,quickSuggestions:!1,fontFamily:"var(--font-ibm-plex-mono)",fontSize:14,stickyScroll:{enabled:!1},wordBasedSuggestions:"off",wordWrap:"on",automaticLayout:!0,parameterHints:{enabled:!1},hover:{enabled:!1},minimap:{enabled:!1},scrollbar:{useShadows:!1},scrollBeyondLastLine:!1,padding:{bottom:30}}),[d]),y=(0,r.useCallback)(e=>{e.languages.register({id:"latex"}),e.languages.setMonarchTokensProvider("latex",{tokenizer:{root:[[/[\\][a-zA-Z]+/,"keyword"],[/\$[^$]*\$/,"string"],[/\\[\(\[][^{}]*\\[\)\]]/,"string"],[/%.*$/,"comment"],[/[{}]/,"delimiter"],[/\\(begin|end)\{[a-zA-Z]*\}/,"keyword"],[/[\[\]()]/,"delimiter"]]}})},[]);return(0,a.jsx)("div",{className:"w-full h-full max-h-full",onMouseUp:j,children:(0,a.jsx)(i.Ay,{height:"100%",width:"100%",onMount:v,value:o?void 0:s,language:t,onChange:g,beforeMount:y,theme:"dark"===p?"dark":"light",options:b})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[20936,51829,64713,28422,94150,4684,55701,37866,26294,77186,58895,18096,24657,98124,72781,52160,67303,66432,65146,53592,6615,33846,21572,8983,93136,93038,62320,78302,24823,49972,10953,92372,33689,40793,13504,1270,14987,47610,20204,77358],()=>t(70154)),_N_E=e.O()}]);